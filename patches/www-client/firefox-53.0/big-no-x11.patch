diff --git a/dom/base/nsDOMWindowUtils.cpp b/dom/base/nsDOMWindowUtils.cpp
index d0fa70a..78ca858 100644
--- a/dom/base/nsDOMWindowUtils.cpp
+++ b/dom/base/nsDOMWindowUtils.cpp
@@ -69,7 +69,7 @@
 
 #if defined(MOZ_X11) && defined(MOZ_WIDGET_GTK)
 #include <gdk/gdk.h>
-#include <gdk/gdkx.h>
+//#include <gdk/gdkx.h>
 #endif
 
 #include "Layers.h"
@@ -314,7 +314,7 @@ nsDOMWindowUtils::Redraw(uint32_t aCount, uint32_t *aDurationOut)
       for (uint32_t i = 0; i < aCount; i++)
         rootFrame->InvalidateFrame();
 
-#if defined(MOZ_X11) && defined(MOZ_WIDGET_GTK)
+#if defined(MOZ_X11_no) && defined(MOZ_WIDGET_GTK)
       XSync(GDK_DISPLAY_XDISPLAY(gdk_display_get_default()), False);
 #endif
 
diff --git a/dom/ipc/ContentChild.cpp b/dom/ipc/ContentChild.cpp
index 33f4a85..de211bd 100644
--- a/dom/ipc/ContentChild.cpp
+++ b/dom/ipc/ContentChild.cpp
@@ -166,7 +166,7 @@
 #include "mozilla/widget/AudioSession.h"
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "mozilla/X11Util.h"
 #endif
 
@@ -560,7 +560,7 @@ ContentChild::Init(MessageLoop* aIOLoop,
   }
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   // Do this after initializing GDK, or GDK will install its own handler.
   XRE_InstallX11ErrorHandler();
 #endif
@@ -587,7 +587,7 @@ ContentChild::Init(MessageLoop* aIOLoop,
   GetIPCChannel()->SetChannelFlags(MessageChannel::REQUIRE_A11Y_REENTRY);
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   // Send the parent our X socket to act as a proxy reference for our X
   // resources.
   int xSocketFd = ConnectionNumber(DefaultXDisplay());
diff --git a/dom/plugins/base/npapi.h b/dom/plugins/base/npapi.h
index 12ac635..2577699 100644
--- a/dom/plugins/base/npapi.h
+++ b/dom/plugins/base/npapi.h
@@ -43,7 +43,7 @@
 
 #if defined(XP_UNIX)
 #include <stdio.h>
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
 #include <X11/Xlib.h>
 #include <X11/Xutil.h>
 #include "X11UndefineNone.h"
@@ -243,7 +243,7 @@ typedef struct
 typedef struct
 {
   int32_t      type;
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
   Display*     display;
   Visual*      visual;
   Colormap     colormap;
@@ -566,7 +566,7 @@ typedef struct _NPEvent
   uintptr_t wParam;
   uintptr_t lParam;
 } NPEvent;
-#elif defined(XP_UNIX) && defined(MOZ_X11)
+#elif defined(XP_UNIX) && defined(MOZ_X11_no)
 typedef XEvent NPEvent;
 #else
 typedef void*  NPEvent;
@@ -580,7 +580,7 @@ typedef RgnHandle NPQDRegion;
 typedef CGPathRef NPCGRegion;
 #elif defined(XP_WIN)
 typedef HRGN NPRegion;
-#elif defined(XP_UNIX) && defined(MOZ_X11)
+#elif defined(XP_UNIX) && defined(MOZ_X11_no)
 typedef Region NPRegion;
 #elif defined(XP_SYMBIAN)
 typedef QRegion* NPRegion;
diff --git a/dom/plugins/base/nsNPAPIPlugin.cpp b/dom/plugins/base/nsNPAPIPlugin.cpp
index 429ebd6..2c2ad22 100644
--- a/dom/plugins/base/nsNPAPIPlugin.cpp
+++ b/dom/plugins/base/nsNPAPIPlugin.cpp
@@ -58,7 +58,7 @@
 // needed for nppdf plugin
 #if (MOZ_WIDGET_GTK)
 #include <gdk/gdk.h>
-#include <gdk/gdkx.h>
+//#include <gdk/gdkx.h>
 #if (MOZ_WIDGET_GTK == 2)
 #include "gtk2xtbin.h"
 #endif
@@ -85,7 +85,7 @@ using mozilla::PluginPRLibrary;
 using mozilla::plugins::PluginModuleChromeParent;
 using mozilla::plugins::PluginModuleContentParent;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "mozilla/X11Util.h"
 #endif
 
@@ -1728,7 +1728,7 @@ _getvalue(NPP npp, NPNVariable variable, void *result)
 
 #if defined(XP_UNIX) && !defined(XP_MACOSX)
   case NPNVxDisplay : {
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
     if (npp) {
       nsNPAPIPluginInstance *inst = (nsNPAPIPluginInstance *) npp->ndata;
       bool windowless = false;
diff --git a/dom/plugins/base/nsPluginInstanceOwner.cpp b/dom/plugins/base/nsPluginInstanceOwner.cpp
index 1e3118e..e9dbcdf 100644
--- a/dom/plugins/base/nsPluginInstanceOwner.cpp
+++ b/dom/plugins/base/nsPluginInstanceOwner.cpp
@@ -4,7 +4,7 @@
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <cairo-xlib.h>
 #include "gfxXlibSurface.h"
 /* X headers suck */
@@ -748,7 +748,7 @@ NS_IMETHODIMP nsPluginInstanceOwner::GetNetscapeWindow(void *value)
   }
 
   return NS_OK;
-#elif defined(MOZ_WIDGET_GTK) && defined(MOZ_X11)
+#elif defined(MOZ_WIDGET_GTK) && defined(MOZ_X11_no)
   // X11 window managers want the toplevel window for WM_TRANSIENT_FOR.
   nsIWidget* win = mPluginFrame->GetNearestWidget();
   if (!win)
@@ -2105,7 +2105,7 @@ nsPluginInstanceOwner::HandleEvent(nsIDOMEvent* aEvent)
   return NS_OK;
 }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 static unsigned int XInputEventState(const WidgetInputEvent& anEvent)
 {
   unsigned int state = 0;
@@ -2586,7 +2586,7 @@ nsEventStatus nsPluginInstanceOwner::ProcessEvent(const WidgetGUIEvent& anEvent)
   }
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   // this code supports windowless plugins
   nsIWidget* widget = anEvent.mWidget;
   XEvent pluginEvent = XEvent();
@@ -3061,7 +3061,7 @@ void nsPluginInstanceOwner::Paint(gfxContext* aContext,
 }
 #endif
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
 void nsPluginInstanceOwner::Paint(gfxContext* aContext,
                                   const gfxRect& aFrameRect,
                                   const gfxRect& aDirtyRect)
@@ -3206,7 +3206,7 @@ nsPluginInstanceOwner::Renderer::DrawWithXlib(cairo_surface_t* xsurface,
 
   NPSetWindowCallbackStruct* ws_info =
     static_cast<NPSetWindowCallbackStruct*>(mWindow->ws_info);
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   if (ws_info->visual != visual || ws_info->colormap != colormap) {
     ws_info->visual = visual;
     ws_info->colormap = colormap;
@@ -3425,7 +3425,7 @@ NS_IMETHODIMP nsPluginInstanceOwner::CreateWidget(void)
     // passing HDC till paint event when it is really
     // needed. Change spec?
     mPluginWindow->window = nullptr;
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // Fill in the display field.
     NPSetWindowCallbackStruct* ws_info =
     static_cast<NPSetWindowCallbackStruct*>(mPluginWindow->ws_info);
diff --git a/dom/plugins/base/nsPluginInstanceOwner.h b/dom/plugins/base/nsPluginInstanceOwner.h
index 589bcb0..66609b4 100644
--- a/dom/plugins/base/nsPluginInstanceOwner.h
+++ b/dom/plugins/base/nsPluginInstanceOwner.h
@@ -45,7 +45,7 @@ class PuppetWidget;
 
 using mozilla::widget::PuppetWidget;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "gfxXlibNativeRenderer.h"
 #endif
 
@@ -214,7 +214,7 @@ public:
     return mPluginWindow->type == NPWindowTypeDrawable &&
     (MatchPluginName("Shockwave Flash") ||
      MatchPluginName("Test Plug-in"));
-#elif defined(MOZ_X11) || defined(XP_MACOSX)
+#elif defined(MOZ_X11_no) || defined(XP_MACOSX)
     return true;
 #else
     return false;
@@ -393,7 +393,7 @@ private:
 
   int mLastMouseDownButtonType;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   class Renderer : public gfxXlibNativeRenderer
   {
   public:
diff --git a/dom/plugins/base/nsPluginNativeWindowGtk.cpp b/dom/plugins/base/nsPluginNativeWindowGtk.cpp
index bfb9510..33a6982 100644
--- a/dom/plugins/base/nsPluginNativeWindowGtk.cpp
+++ b/dom/plugins/base/nsPluginNativeWindowGtk.cpp
@@ -14,15 +14,15 @@
 #include "nsNPAPIPlugin.h"
 #include "npapi.h"
 #include <gtk/gtk.h>
-#include <gdk/gdkx.h>
+//#include <gdk/gdkx.h>
 #include <gdk/gdk.h>
 
 #if (GTK_MAJOR_VERSION == 3)
-#include <gtk/gtkx.h>
+//#include <gtk/gtkx.h>
 #else
 #include "gtk2xtbin.h"
 #endif
-#include "mozilla/X11Util.h"
+//#include "mozilla/X11Util.h"
 
 static void plug_added_cb(GtkWidget *widget, gpointer data);
 static gboolean plug_removed_cb   (GtkWidget *widget, gpointer data);
@@ -41,10 +41,10 @@ nsPluginNativeWindowGtk::nsPluginNativeWindowGtk() : nsPluginNativeWindow()
   type = NPWindowTypeWindow;
   mSocketWidget = 0;
   mWsInfo.type = 0;
-  mWsInfo.display = nullptr;
-  mWsInfo.visual = nullptr;
-  mWsInfo.colormap = 0;
-  mWsInfo.depth = 0;
+  //mWsInfo.display = nullptr;
+  //mWsInfo.visual = nullptr;
+  //mWsInfo.colormap = 0;
+  //mWsInfo.depth = 0;
 }
 
 nsPluginNativeWindowGtk::~nsPluginNativeWindowGtk() 
@@ -71,159 +71,11 @@ nsresult PLUG_DeletePluginNativeWindow(nsPluginNativeWindow * aPluginNativeWindo
 
 nsresult nsPluginNativeWindowGtk::CallSetWindow(RefPtr<nsNPAPIPluginInstance> &aPluginInstance)
 {
-  if (aPluginInstance) {
-    if (type == NPWindowTypeWindow &&
-        XRE_IsContentProcess()) {
-      // In this case, most of the initialization code here has already happened
-      // in the chrome process. The window we have in content is the XID of the
-      // socket widget we need to hand to plugins.
-      SetWindow((XID)window);
-	  } else if (type == NPWindowTypeWindow) {
-      if (!mSocketWidget) {
-        nsresult rv;
-
-        // The documentation on the types for many variables in NP(N|P)_GetValue
-        // is vague.  Often boolean values are NPBool (1 byte), but
-        // https://developer.mozilla.org/en/XEmbed_Extension_for_Mozilla_Plugins
-        // treats NPPVpluginNeedsXEmbed as PRBool (int), and
-        // on x86/32-bit, flash stores to this using |movl 0x1,&needsXEmbed|.
-        // thus we can't use NPBool for needsXEmbed, or the three bytes above
-        // it on the stack would get clobbered. so protect with the larger bool.
-        int needsXEmbed = 0;
-        rv = aPluginInstance->GetValueFromPlugin(NPPVpluginNeedsXEmbed, &needsXEmbed);
-        // If the call returned an error code make sure we still use our default value.
-        if (NS_FAILED(rv)) {
-          needsXEmbed = 0;
-        }
-#ifdef DEBUG
-        printf("nsPluginNativeWindowGtk: NPPVpluginNeedsXEmbed=%d\n", needsXEmbed);
-#endif
-
-        bool isOOPPlugin = aPluginInstance->GetPlugin()->GetLibrary()->IsOOP();
-        if (needsXEmbed || isOOPPlugin) {        
-          bool enableXtFocus = !needsXEmbed;
-          rv = CreateXEmbedWindow(enableXtFocus);
-        }
-        else {
-#if (MOZ_WIDGET_GTK == 2)
-          rv = CreateXtWindow();
-#else
-          return NS_ERROR_FAILURE;
-#endif
-        }
-
-        if (NS_FAILED(rv)) {
-          return NS_ERROR_FAILURE;
-        }
-      }
-
-      if (!mSocketWidget) {
-        return NS_ERROR_FAILURE;
-      }
-
-      // Make sure to resize and re-place the window if required.
-      SetAllocation();
-      // Need to reset "window" each time as nsPluginFrame::DidReflow sets it
-      // to the ancestor window.
-#if (MOZ_WIDGET_GTK == 2)
-      if (GTK_IS_XTBIN(mSocketWidget)) {
-        // Point the NPWindow structures window to the actual X window
-        SetWindow(GTK_XTBIN(mSocketWidget)->xtwindow);
-      }
-      else { // XEmbed or OOP&Xt
-        SetWindow(gtk_socket_get_id(GTK_SOCKET(mSocketWidget)));
-      }
-#else
-      // Gtk3 supports only OOP by GtkSocket
-      SetWindow(gtk_socket_get_id(GTK_SOCKET(mSocketWidget)));
-#endif
-
-#ifdef DEBUG
-      printf("nsPluginNativeWindowGtk: call SetWindow with xid=%p\n", (void *)window);
-#endif
-    } // NPWindowTypeWindow
-    aPluginInstance->SetWindow(this);
-  } else if (mPluginInstance) {
-    mPluginInstance->SetWindow(nullptr);
-  }
-
-  SetPluginInstance(aPluginInstance);
-  return NS_OK;
+  return NS_ERROR_FAILURE;
 }
 
 nsresult nsPluginNativeWindowGtk::CreateXEmbedWindow(bool aEnableXtFocus) {
-  NS_ASSERTION(!mSocketWidget,"Already created a socket widget!");
-  GdkDisplay *display = gdk_display_get_default();
-  GdkWindow *parent_win = gdk_x11_window_lookup_for_display(display, GetWindow());
-  mSocketWidget = gtk_socket_new();
-
-  //attach the socket to the container widget
-  gtk_widget_set_parent_window(mSocketWidget, parent_win);
-
-  // enable/disable focus event handlers,
-  // see plugin_window_filter_func() for details
-  g_object_set_data(G_OBJECT(mSocketWidget), "enable-xt-focus", (void *)aEnableXtFocus);
-
-  g_signal_connect(mSocketWidget, "plug_added",
-                   G_CALLBACK(plug_added_cb), nullptr);
-
-  // Make sure to handle the plug_removed signal.  If we don't the
-  // socket will automatically be destroyed when the plug is
-  // removed, which means we're destroying it more than once.
-  // SYNTAX ERROR.
-  g_signal_connect(mSocketWidget, "plug_removed",
-                   G_CALLBACK(plug_removed_cb), nullptr);
-
-  g_signal_connect(mSocketWidget, "unrealize",
-                   G_CALLBACK(socket_unrealize_cb), nullptr);
-
-  g_signal_connect(mSocketWidget, "destroy",
-                   G_CALLBACK(gtk_widget_destroyed), &mSocketWidget);
-
-  gpointer user_data = nullptr;
-  gdk_window_get_user_data(parent_win, &user_data);
-
-  GtkContainer *container = GTK_CONTAINER(user_data);
-  gtk_container_add(container, mSocketWidget);
-  gtk_widget_realize(mSocketWidget);
-
-  // The GtkSocket has a visible window, but the plugin's XEmbed plug will
-  // cover this window.  Normally GtkSockets let the X server paint their
-  // background and this would happen immediately (before the plug is
-  // created).  Setting the background to None prevents the server from
-  // painting this window, avoiding flicker.
-  // TODO GTK3
-#if (MOZ_WIDGET_GTK == 2)
-  gdk_window_set_back_pixmap(gtk_widget_get_window(mSocketWidget), nullptr, FALSE);
-#endif
-
-  // Resize before we show
-  SetAllocation();
-
-  gtk_widget_show(mSocketWidget);
-
-  gdk_flush();
-  SetWindow(gtk_socket_get_id(GTK_SOCKET(mSocketWidget)));
-
-  // Fill out the ws_info structure.
-  // (The windowless case is done in nsPluginFrame.cpp.)
-  GdkWindow *gdkWindow = gdk_x11_window_lookup_for_display(display, GetWindow());
-  if(!gdkWindow)
-    return NS_ERROR_FAILURE;
-
-  mWsInfo.display = GDK_WINDOW_XDISPLAY(gdkWindow);
-#if (MOZ_WIDGET_GTK == 2)
-  mWsInfo.colormap = GDK_COLORMAP_XCOLORMAP(gdk_drawable_get_colormap(gdkWindow));
-  GdkVisual* gdkVisual = gdk_drawable_get_visual(gdkWindow);
-  mWsInfo.depth = gdkVisual->depth;
-#else
-  mWsInfo.colormap = X11None;
-  GdkVisual* gdkVisual = gdk_window_get_visual(gdkWindow);
-  mWsInfo.depth = gdk_visual_get_depth(gdkVisual);
-#endif
-  mWsInfo.visual = GDK_VISUAL_XVISUAL(gdkVisual);
-    
-  return NS_OK;
+  return NS_ERROR_FAILURE;
 }
 
 void nsPluginNativeWindowGtk::SetAllocation() {
@@ -304,8 +156,6 @@ plug_added_cb(GtkWidget *socket, gpointer data)
   // receives the DestroyNotify event for the plug window, GDK releases its
   // reference to plugWindow.  This is typically the last reference and so the
   // weak ref callback triggers release of the socket.
-  GdkWindow* plugWindow = gtk_socket_get_plug_window(GTK_SOCKET(socket));
-  g_object_weak_ref(G_OBJECT(plugWindow), plug_window_finalize_cb, socket);
 }
 
 /* static */
@@ -319,38 +169,4 @@ plug_removed_cb (GtkWidget *widget, gpointer data)
 static void
 socket_unrealize_cb(GtkWidget *widget, gpointer data)
 {
-  // Unmap and reparent any child windows that GDK does not yet know about.
-  // (See bug 540114 comment 10.)
-  GdkWindow* socket_window =  gtk_widget_get_window(widget);
-  GdkDisplay* gdkDisplay = gdk_display_get_default();
-  Display* display = GDK_DISPLAY_XDISPLAY(gdkDisplay);
-
-  // Ignore X errors that may happen if windows get destroyed (possibly
-  // requested by the plugin) between XQueryTree and when we operate on them.
-  gdk_error_trap_push();
-
-  Window root, parent;
-  Window* children;
-  unsigned int nchildren;
-  if (!XQueryTree(display, gdk_x11_window_get_xid(socket_window),
-                  &root, &parent, &children, &nchildren))
-    return;
-
-  for (unsigned int i = 0; i < nchildren; ++i) {
-    Window child = children[i];
-    if (!gdk_x11_window_lookup_for_display(gdkDisplay, child)) {
-      // This window is not known to GDK.
-      XUnmapWindow(display, child);
-      XReparentWindow(display, child, DefaultRootWindow(display), 0, 0);
-    }
-  }
-
-  if (children) XFree(children);
-
-  mozilla::FinishX(display);
-#if (MOZ_WIDGET_GTK == 3)
-  gdk_error_trap_pop_ignored();
-#else
-  gdk_error_trap_pop();
-#endif
 }
diff --git a/dom/plugins/base/nsPluginNativeWindowGtk.h b/dom/plugins/base/nsPluginNativeWindowGtk.h
index 872d7f0..30cd67a 100644
--- a/dom/plugins/base/nsPluginNativeWindowGtk.h
+++ b/dom/plugins/base/nsPluginNativeWindowGtk.h
@@ -8,14 +8,14 @@
 #include "nsPluginNativeWindow.h"
 #include "npapi.h"
 #include <gtk/gtk.h>
-#include <gdk/gdkx.h>
+//#include <gdk/gdkx.h>
 #include <gdk/gdk.h>
 #if (GTK_MAJOR_VERSION == 3)
-#include <gtk/gtkx.h>
+//#include <gtk/gtkx.h>
 #else
 #include "gtk2xtbin.h"
 #endif
-#include "mozilla/X11Util.h"
+//#include "mozilla/X11Util.h"
 
 class nsPluginNativeWindowGtk : public nsPluginNativeWindow {
 public:
@@ -26,16 +26,8 @@ public:
   nsresult CreateXEmbedWindow(bool aEnableXtFocus);
   void SetAllocation();
 
-  XID GetWindow() const
-  {
-    return static_cast<XID>(reinterpret_cast<uintptr_t>(window));
-  }
 
 private:
-  void SetWindow(XID aWindow)
-  {
-    window = reinterpret_cast<void*>(static_cast<uintptr_t>(aWindow));
-  }
 
   NPSetWindowCallbackStruct mWsInfo;
   /**
diff --git a/dom/plugins/ipc/NPEventUnix.h b/dom/plugins/ipc/NPEventUnix.h
index 4cc9a54..fe0e295 100644
--- a/dom/plugins/ipc/NPEventUnix.h
+++ b/dom/plugins/ipc/NPEventUnix.h
@@ -9,7 +9,7 @@
 
 #include "npapi.h"
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "mozilla/X11Util.h"
 #endif
 
@@ -61,7 +61,7 @@ struct ParamTraits<mozilla::plugins::NPRemoteEvent>     // synonym for XEvent
             return false;
         }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
         SetXDisplay(aResult->event);
 #endif
         return true;
@@ -73,7 +73,7 @@ struct ParamTraits<mozilla::plugins::NPRemoteEvent>     // synonym for XEvent
         aLog->append(L"(XEvent)");
     }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 private:
     static void SetXDisplay(XEvent& ev)
     {
diff --git a/dom/plugins/ipc/PluginInstanceChild.cpp b/dom/plugins/ipc/PluginInstanceChild.cpp
index 1d7dc13..ffef92a 100644
--- a/dom/plugins/ipc/PluginInstanceChild.cpp
+++ b/dom/plugins/ipc/PluginInstanceChild.cpp
@@ -16,7 +16,7 @@
 #include "gfx2DGlue.h"
 #include "nsNPAPIPluginInstance.h"
 #include "mozilla/gfx/2D.h"
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "gfxXlibSurface.h"
 #endif
 #ifdef XP_WIN
@@ -50,7 +50,7 @@ using namespace std;
 #ifdef MOZ_WIDGET_GTK
 
 #include <gtk/gtk.h>
-#include <gdk/gdkx.h>
+//#include <gdk/gdkx.h>
 #include <gdk/gdk.h>
 #if (MOZ_WIDGET_GTK == 2)
 #include "gtk2xtbin.h"
@@ -198,7 +198,7 @@ PluginInstanceChild::PluginInstanceChild(const NPPluginFuncs* aPluginIface,
     mWindow.type = NPWindowTypeWindow;
     mData.ndata = (void*) this;
     mData.pdata = nullptr;
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
     mWindow.ws_info = &mWsInfo;
     memset(&mWsInfo, 0, sizeof(mWsInfo));
 #if (MOZ_WIDGET_GTK == 2)
@@ -383,7 +383,7 @@ PluginInstanceChild::NPN_GetValue(NPNVariable aVar,
 
     switch(aVar) {
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
     case NPNVToolkit:
         *((NPNToolkitType*)aValue) = NPNVGtk2;
         return NPERR_NO_ERROR;
@@ -453,7 +453,7 @@ PluginInstanceChild::NPN_GetValue(NPNVariable aVar,
             *static_cast<HWND*>(aValue) = mPluginWindowHWND;
             return NPERR_NO_ERROR;
         }
-#elif defined(MOZ_X11)
+#elif defined(MOZ_X11_no)
         NPError result;
         CallNPN_GetValue_NPNVnetscapeWindow(static_cast<XID*>(aValue), &result);
         return result;
@@ -734,7 +734,7 @@ PluginInstanceChild::AnswerNPP_GetValue_NPPVpluginNeedsXEmbed(
     AssertPluginThread();
     AutoStackHelper guard(this);
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // The documentation on the types for many variables in NP(N|P)_GetValue
     // is vague.  Often boolean values are NPBool (1 byte), but
     // https://developer.mozilla.org/en/XEmbed_Extension_for_Mozilla_Plugins
@@ -892,7 +892,7 @@ PluginInstanceChild::AnswerNPP_HandleEvent(const NPRemoteEvent& event,
     AssertPluginThread();
     AutoStackHelper guard(this);
 
-#if defined(MOZ_X11) && defined(DEBUG)
+#if defined(MOZ_X11_no) && defined(DEBUG)
     if (GraphicsExpose == event.event.type)
         PLUGIN_LOG_DEBUG(("  received drawable 0x%lx\n",
                           event.event.xgraphicsexpose.drawable));
@@ -950,7 +950,7 @@ PluginInstanceChild::AnswerNPP_HandleEvent(const NPRemoteEvent& event,
     }
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     if (GraphicsExpose == event.event.type) {
         // Make sure the X server completes the drawing before the parent
         // draws on top and destroys the Drawable.
@@ -1183,7 +1183,7 @@ PluginInstanceChild::RecvContentsScaleFactorChanged(const double& aContentsScale
 #endif
 }
 
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
 // Create a new window from NPWindow
 bool PluginInstanceChild::CreateWindow(const NPRemoteWindow& aWindow)
 { 
@@ -1281,7 +1281,7 @@ PluginInstanceChild::AnswerNPP_SetWindow(const NPRemoteWindow& aWindow)
     AssertPluginThread();
     AutoStackHelper guard(this);
 
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
     NS_ASSERTION(mWsInfo.display, "We should have a valid display!");
 
     // The minimum info is sent over IPC to allow this
@@ -1415,6 +1415,7 @@ PluginInstanceChild::AnswerNPP_SetWindow(const NPRemoteWindow& aWindow)
 
 #elif defined(ANDROID)
     // TODO: Need Android impl
+#elif defined(MOZ_WIDGET_GTK)
 #elif defined(MOZ_WIDGET_UIKIT)
     // Don't care
 #else
@@ -3256,7 +3257,7 @@ PluginInstanceChild::CreateOptSurface(void)
         (mIsTransparent && !mBackground) ? SurfaceFormat::A8R8G8B8_UINT32 :
                                            SurfaceFormat::X8R8G8B8_UINT32;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     Display* dpy = mWsInfo.display;
     Screen* screen = DefaultScreenOfDisplay(dpy);
     if (format == SurfaceFormat::X8R8G8B8_UINT32 &&
@@ -3316,7 +3317,7 @@ PluginInstanceChild::MaybeCreatePlatformHelperSurface(void)
         return false;
     }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     bool supportNonDefaultVisual = false;
     Screen* screen = DefaultScreenOfDisplay(mWsInfo.display);
     Visual* defaultVisual = DefaultVisualOfScreen(screen);
@@ -3475,11 +3476,11 @@ PluginInstanceChild::EnsureCurrentBuffer(void)
 void
 PluginInstanceChild::UpdateWindowAttributes(bool aForceSetWindow)
 {
-#if defined(MOZ_X11) || defined(XP_WIN)
+#if defined(MOZ_X11_no) || defined(XP_WIN)
     RefPtr<gfxASurface> curSurface = mHelperSurface ? mHelperSurface : mCurrentSurface;
 #endif // Only used within MOZ_X11 or XP_WIN blocks. Unused variable otherwise
     bool needWindowUpdate = aForceSetWindow;
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     Visual* visual = nullptr;
     Colormap colormap = 0;
     if (curSurface && curSurface->GetType() == gfxSurfaceType::Xlib) {
@@ -3575,7 +3576,7 @@ PluginInstanceChild::PaintRectToPlatformSurface(const nsIntRect& aRect,
     // We should not send an async surface if we're using direct rendering.
     MOZ_ASSERT(!IsUsingDirectDrawing());
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     {
         NS_ASSERTION(aSurface->GetType() == gfxSurfaceType::Xlib,
                      "Non supported platform surface type");
@@ -3632,7 +3633,7 @@ PluginInstanceChild::PaintRectToSurface(const nsIntRect& aRect,
     // Render using temporary X surface, with copy to image surface
     nsIntRect plPaintRect(aRect);
     RefPtr<gfxASurface> renderSurface = aSurface;
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     if (mIsTransparent && (GetQuirks() & QUIRK_FLASH_EXPOSE_COORD_TRANSLATION)) {
         // Work around a bug in Flash up to 10.1 d51 at least, where expose event
         // top left coordinates within the plugin-rect and not at the drawable
@@ -3981,7 +3982,7 @@ PluginInstanceChild::ShowPluginFrame()
     NPRect r = { (uint16_t)rect.y, (uint16_t)rect.x,
                  (uint16_t)rect.YMost(), (uint16_t)rect.XMost() };
     SurfaceDescriptor currSurf;
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     if (mCurrentSurface->GetType() == gfxSurfaceType::Xlib) {
         gfxXlibSurface *xsurf = static_cast<gfxXlibSurface*>(mCurrentSurface.get());
         currSurf = SurfaceDescriptorX11(xsurf);
@@ -4033,7 +4034,7 @@ PluginInstanceChild::ReadbackDifferenceRect(const nsIntRect& rect)
 
     // We can read safely from XSurface,SharedDIBSurface and Unsafe SharedMemory,
     // because PluginHost is not able to modify that surface
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
     if (mBackSurface->GetType() != gfxSurfaceType::Xlib &&
         !gfxSharedImageSurface::IsSharedImage(mBackSurface))
         return false;
@@ -4042,7 +4043,7 @@ PluginInstanceChild::ReadbackDifferenceRect(const nsIntRect& rect)
         return false;
 #endif
 
-#if defined(MOZ_X11) || defined(XP_WIN)
+#if defined(MOZ_X11_no) || defined(XP_WIN)
     if (mCurrentSurface->GetContentType() != mBackSurface->GetContentType())
         return false;
 
@@ -4167,7 +4168,7 @@ PluginInstanceChild::RecvUpdateBackground(const SurfaceDescriptor& aBackground,
     if (!mBackground) {
         // XXX refactor me
         switch (aBackground.type()) {
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
         case SurfaceDescriptor::TSurfaceDescriptorX11: {
             mBackground = aBackground.get_SurfaceDescriptorX11().OpenForeign();
             break;
@@ -4515,7 +4516,7 @@ PluginInstanceChild::Destroy()
       xt_client_xloop_destroy();
     }
 #endif
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
     DeleteWindow();
 #endif
 }
diff --git a/dom/plugins/ipc/PluginInstanceParent.cpp b/dom/plugins/ipc/PluginInstanceParent.cpp
index 14f00d3..e836906 100644
--- a/dom/plugins/ipc/PluginInstanceParent.cpp
+++ b/dom/plugins/ipc/PluginInstanceParent.cpp
@@ -28,7 +28,7 @@
 #include "nsPluginInstanceOwner.h"
 #include "nsFocusManager.h"
 #include "nsIDOMElement.h"
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "gfxXlibSurface.h"
 #endif
 #include "gfxContext.h"
@@ -193,7 +193,7 @@ PluginInstanceParent::ActorDestroy(ActorDestroyReason why)
         if (mImageContainer) {
             mImageContainer->ClearAllImages();
         }
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
         FinishX(DefaultXDisplay());
 #endif
     }
@@ -266,7 +266,7 @@ PluginInstanceParent::AnswerNPN_GetValue_NPNVnetscapeWindow(NativeWindowHandle*
 {
 #ifdef XP_WIN
     HWND id;
-#elif defined(MOZ_X11)
+#elif defined(MOZ_X11_no)
     XID id;
 #elif defined(XP_DARWIN)
     intptr_t id;
@@ -274,7 +274,7 @@ PluginInstanceParent::AnswerNPN_GetValue_NPNVnetscapeWindow(NativeWindowHandle*
     // TODO: Need Android impl
     int id;
 #else
-#warning Implement me
+    int id;
 #endif
 
     *result = mNPNIface->getvalue(mNPP, NPNVnetscapeWindow, &id);
@@ -482,7 +482,7 @@ PluginInstanceParent::AnswerNPN_SetValue_NPPVpluginDrawingModel(
         case NPDrawingModelAsyncWindowsDXGISurface:
             allowed = AllowDirectDXGISurfaceDrawing();
             break;
-#elif defined(MOZ_X11)
+#elif defined(MOZ_X11_no)
         case NPDrawingModelSyncX:
             allowed = true;
             break;
@@ -920,7 +920,7 @@ PluginInstanceParent::RecvShow(const NPRect& updatedRect,
         return IPC_OK();
     }
 #endif
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     else if (newSurface.type() == SurfaceDescriptor::TSurfaceDescriptorX11) {
         surface = newSurface.get_SurfaceDescriptorX11().OpenForeign();
     }
@@ -937,7 +937,7 @@ PluginInstanceParent::RecvShow(const NPRect& updatedRect,
         // This is the "old front buffer" we're about to hand back to
         // the plugin.  We might still have drawing operations
         // referencing it.
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
         if (mFrontSurface->GetType() == gfxSurfaceType::Xlib) {
             // Finish with the surface and XSync here to ensure the server has
             // finished operations on the surface before the plugin starts
@@ -1180,7 +1180,7 @@ PluginInstanceParent::EndUpdateBackground(const nsIntRect& aRect)
         ("[InstanceParent][%p] EndUpdateBackground for <x=%d,y=%d, w=%d,h=%d>",
          this, aRect.x, aRect.y, aRect.width, aRect.height));
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // Have to XSync here to avoid the plugin trying to draw with this
     // surface racing with its creation in the X server.  We also want
     // to avoid the plugin drawing onto stale pixels, then handing us
@@ -1237,7 +1237,7 @@ PluginInstanceParent::CreateBackground(const nsIntSize& aSize)
 
     // XXX refactor me
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
     Screen* screen = DefaultScreenOfDisplay(DefaultXDisplay());
     Visual* visual = DefaultVisualOfScreen(screen);
     mBackground = gfxXlibSurface::Create(screen, visual,
@@ -1282,7 +1282,7 @@ PluginInstanceParent::BackgroundDescriptor()
 
     // XXX refactor me
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     gfxXlibSurface* xsurf = static_cast<gfxXlibSurface*>(mBackground.get());
     return SurfaceDescriptorX11(xsurf);
 #endif
@@ -1403,7 +1403,7 @@ PluginInstanceParent::NPP_SetWindow(const NPWindow* aWindow)
     }
 #endif
 
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
     const NPSetWindowCallbackStruct* ws_info =
       static_cast<NPSetWindowCallbackStruct*>(aWindow->ws_info);
     window.visualID = ws_info->visual ? ws_info->visual->visualid : 0;
@@ -1440,7 +1440,7 @@ PluginInstanceParent::NPP_GetValue(NPPVariable aVariable,
         return NPERR_NO_ERROR;
     }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     case NPPVpluginNeedsXEmbed: {
         bool needsXEmbed;
         NPError rv;
@@ -1620,7 +1620,7 @@ PluginInstanceParent::NPP_HandleEvent(void* event)
     }
 #endif
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
     switch (npevent->type) {
     case GraphicsExpose:
         PLUGIN_LOG_DEBUG(("  schlepping drawable 0x%lx across the pipe\n",
diff --git a/dom/plugins/ipc/PluginMessageUtils.cpp b/dom/plugins/ipc/PluginMessageUtils.cpp
index 47653fe..60b3f20 100644
--- a/dom/plugins/ipc/PluginMessageUtils.cpp
+++ b/dom/plugins/ipc/PluginMessageUtils.cpp
@@ -50,7 +50,7 @@ namespace plugins {
 
 NPRemoteWindow::NPRemoteWindow() :
   window(0), x(0), y(0), width(0), height(0), type(NPWindowTypeDrawable)
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
   , visualID(0)
   , colormap(0)
 #endif /* XP_UNIX */
diff --git a/dom/plugins/ipc/PluginMessageUtils.h b/dom/plugins/ipc/PluginMessageUtils.h
index fd43473..bd32ed8 100644
--- a/dom/plugins/ipc/PluginMessageUtils.h
+++ b/dom/plugins/ipc/PluginMessageUtils.h
@@ -90,7 +90,7 @@ struct NPRemoteWindow
   uint32_t height;
   NPRect clipRect;
   NPWindowType type;
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
   VisualID visualID;
   Colormap colormap;
 #endif /* XP_UNIX */
@@ -112,10 +112,12 @@ struct NPAudioDeviceChangeDetailsIPC
 
 #ifdef XP_WIN
 typedef HWND NativeWindowHandle;
-#elif defined(MOZ_X11)
+#elif defined(MOZ_X11_no)
 typedef XID NativeWindowHandle;
 #elif defined(XP_DARWIN) || defined(ANDROID)
 typedef intptr_t NativeWindowHandle; // never actually used, will always be 0
+#elif defined(XP_UNIX)
+typedef intptr_t NativeWindowHandle;
 #else
 #error Need NativeWindowHandle for this platform
 #endif
@@ -360,7 +362,7 @@ struct ParamTraits<mozilla::plugins::NPRemoteWindow>
     WriteParam(aMsg, aParam.height);
     WriteParam(aMsg, aParam.clipRect);
     WriteParam(aMsg, aParam.type);
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
     aMsg->WriteULong(aParam.visualID);
     aMsg->WriteULong(aParam.colormap);
 #endif
@@ -385,7 +387,7 @@ struct ParamTraits<mozilla::plugins::NPRemoteWindow>
           ReadParam(aMsg, aIter, &type)))
       return false;
 
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
     unsigned long visualID;
     unsigned long colormap;
     if (!(aMsg->ReadULong(aIter, &visualID) &&
@@ -406,7 +408,7 @@ struct ParamTraits<mozilla::plugins::NPRemoteWindow>
     aResult->height = height;
     aResult->clipRect = clipRect;
     aResult->type = type;
-#if defined(MOZ_X11) && defined(XP_UNIX) && !defined(XP_MACOSX)
+#if defined(MOZ_X11_no) && defined(XP_UNIX) && !defined(XP_MACOSX)
     aResult->visualID = visualID;
     aResult->colormap = colormap;
 #endif
diff --git a/dom/plugins/ipc/PluginModuleChild.cpp b/dom/plugins/ipc/PluginModuleChild.cpp
index 3c76a6b..dc1015b 100644
--- a/dom/plugins/ipc/PluginModuleChild.cpp
+++ b/dom/plugins/ipc/PluginModuleChild.cpp
@@ -11,7 +11,7 @@
 
 #include "mozilla/ipc/MessageChannel.h"
 
-#ifdef MOZ_WIDGET_GTK
+#ifdef MOZ_WIDGET_GTK_no
 #include <gtk/gtk.h>
 #endif
 
@@ -23,7 +23,7 @@
 #include "nsPluginsDir.h"
 #include "nsXULAppAPI.h"
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 # include "nsX11ErrorHandler.h"
 # include "mozilla/X11Util.h"
 #endif
@@ -122,7 +122,7 @@ PluginModuleChild::PluginModuleChild(bool aIsChrome)
   , mInitializeFunc(0)
 #if defined(OS_WIN) || defined(OS_MACOSX)
   , mGetEntryPointsFunc(0)
-#elif defined(MOZ_WIDGET_GTK)
+#elif defined(MOZ_WIDGET_GTK_no)
   , mNestedLoopTimerId(0)
 #endif
 #ifdef OS_WIN
@@ -258,7 +258,7 @@ PluginModuleChild::InitForChrome(const std::string& aPluginFilename,
     // XXX quirks isn't initialized yet
     mAsyncRenderSupport = info.fSupportsAsyncRender;
 #endif
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
     NS_NAMED_LITERAL_CSTRING(flash10Head, "Shockwave Flash 10.");
     if (StringBeginsWith(nsDependentCString(info.fDescription), flash10Head)) {
         AddQuirk(QUIRK_FLASH_EXPOSE_COORD_TRANSLATION);
@@ -271,7 +271,7 @@ PluginModuleChild::InitForChrome(const std::string& aPluginFilename,
     mozilla::plugins::PluginUtilsOSX::SetProcessName(nameBuffer);
 #endif
     pluginFile.FreePluginInfo(info);
-#if defined(MOZ_X11) || defined(XP_MACOSX)
+#if defined(MOZ_X11_no) || defined(XP_MACOSX)
     if (!mLibrary)
 #endif
     {
@@ -319,7 +319,7 @@ PluginModuleChild::InitForChrome(const std::string& aPluginFilename,
     return true;
 }
 
-#if defined(MOZ_WIDGET_GTK)
+#if defined(MOZ_WIDGET_GTK_no)
 
 typedef void (*GObjectDisposeFn)(GObject*);
 typedef gboolean (*GtkWidgetScrollEventFn)(GtkWidget*, GdkEventScroll*);
@@ -545,6 +545,17 @@ PluginModuleChild::ExitedCxxStack()
     mNestedLoopTimerId = 0;
 }
 
+#else
+void
+PluginModuleChild::EnteredCxxStack()
+{
+}
+
+void
+PluginModuleChild::ExitedCxxStack()
+{
+}
+
 #endif
 
 mozilla::ipc::IPCResult
@@ -568,7 +579,7 @@ PluginModuleChild::ShouldContinueFromReplyTimeout()
 bool
 PluginModuleChild::InitGraphics()
 {
-#if defined(MOZ_WIDGET_GTK)
+#if defined(MOZ_WIDGET_GTK_no)
     // Work around plugins that don't interact well with GDK
     // client-side windows.
     PR_SetEnv("GDK_NATIVE_WINDOWS=1");
@@ -607,7 +618,7 @@ PluginModuleChild::InitGraphics()
 #else
     // may not be necessary on all platforms
 #endif
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // Do this after initializing GDK, or GDK will install its own handler.
     InstallX11ErrorHandler();
 #endif
@@ -617,7 +628,7 @@ PluginModuleChild::InitGraphics()
 void
 PluginModuleChild::DeinitGraphics()
 {
-#if defined(MOZ_X11) && defined(NS_FREE_PERMANENT_DATA)
+#if defined(MOZ_X11_no) && defined(NS_FREE_PERMANENT_DATA)
     // We free some data off of XDisplay close hooks, ensure they're
     // run.  Closing the display is pretty scary, so we only do it to
     // silence leak checkers.
@@ -1103,7 +1114,7 @@ _getvalue(NPP aNPP,
     switch (aVariable) {
         // Copied from nsNPAPIPlugin.cpp
         case NPNVToolkit:
-#if defined(MOZ_WIDGET_GTK)
+#if defined(MOZ_WIDGET_GTK_no)
             *static_cast<NPNToolkitType*>(aValue) = NPNVGtk2;
             return NPERR_NO_ERROR;
 #endif
@@ -1124,7 +1135,7 @@ _getvalue(NPP aNPP,
         case NPNVSupportsWindowless:
             *(NPBool*)aValue = PluginModuleChild::GetChrome()->Settings().supportsWindowless();
             return NPERR_NO_ERROR;
-#if defined(MOZ_WIDGET_GTK)
+#if defined(MOZ_WIDGET_GTK_no)
         case NPNVxDisplay: {
             if (aNPP) {
                 return InstCast(aNPP)->NPN_GetValue(aVariable, aValue);
@@ -1891,7 +1902,7 @@ PluginModuleChild::DoNP_Initialize(const PluginSettings& aSettings)
     SetEventHooks();
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // Send the parent our X socket to act as a proxy reference for our X
     // resources.
     int xSocketFd = ConnectionNumber(DefaultXDisplay());
diff --git a/dom/plugins/ipc/PluginModuleChild.h b/dom/plugins/ipc/PluginModuleChild.h
index 8611003..563b04b 100644
--- a/dom/plugins/ipc/PluginModuleChild.h
+++ b/dom/plugins/ipc/PluginModuleChild.h
@@ -11,6 +11,7 @@
 
 #include <string>
 #include <vector>
+#include <glib.h>
 
 #include "base/basictypes.h"
 
diff --git a/dom/plugins/ipc/moz.build b/dom/plugins/ipc/moz.build
index b569aeb..f4dab4a 100644
--- a/dom/plugins/ipc/moz.build
+++ b/dom/plugins/ipc/moz.build
@@ -137,7 +137,8 @@ if CONFIG['MOZ_WIDGET_TOOLKIT'] != 'gtk3':
     CXXFLAGS += CONFIG['TK_CFLAGS']
 else:
     # Force build against gtk+2 for struct offsets and such.
-    CXXFLAGS += CONFIG['MOZ_GTK2_CFLAGS']
+    CXXFLAGS += CONFIG['TK_CFLAGS']
+    #CXXFLAGS += CONFIG['MOZ_GTK2_CFLAGS']
 
 CXXFLAGS += CONFIG['MOZ_CAIRO_CFLAGS']
 
diff --git a/gfx/2d/BorrowedContext.h b/gfx/2d/BorrowedContext.h
index edb923b..148067a 100644
--- a/gfx/2d/BorrowedContext.h
+++ b/gfx/2d/BorrowedContext.h
@@ -8,7 +8,7 @@
 
 #include "2D.h"
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <X11/extensions/Xrender.h>
 #include <X11/Xlib.h>
 #include "X11UndefineNone.h"
@@ -75,7 +75,7 @@ private:
   DrawTarget *mDT;
 };
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 /* This is a helper class that let's you borrow an Xlib drawable from
  * a DrawTarget. This is used for drawing themed widgets.
  *
diff --git a/gfx/2d/DrawTargetCairo.cpp b/gfx/2d/DrawTargetCairo.cpp
index ad22a9a..4caaca2 100644
--- a/gfx/2d/DrawTargetCairo.cpp
+++ b/gfx/2d/DrawTargetCairo.cpp
@@ -2316,7 +2316,7 @@ BorrowedCairoContext::ReturnCairoContextToDrawTarget(DrawTarget* aDT,
   cairoDT->mContext = aCairo;
 }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 bool
 BorrowedXlibDrawable::Init(DrawTarget* aDT)
 {
diff --git a/gfx/angle/include/EGL/eglplatform.h b/gfx/angle/include/EGL/eglplatform.h
index 6d550da..2099e0d 100755
--- a/gfx/angle/include/EGL/eglplatform.h
+++ b/gfx/angle/include/EGL/eglplatform.h
@@ -105,6 +105,13 @@ typedef intptr_t EGLNativeDisplayType;
 typedef intptr_t EGLNativeWindowType;
 typedef intptr_t EGLNativePixmapType;
 
+//#elif defined(MESA_EGL_NO_X11_HEADERS)
+#elif defined(__unix__)
+
+typedef void            *EGLNativeDisplayType;
+typedef khronos_uintptr_t EGLNativePixmapType;
+typedef khronos_uintptr_t EGLNativeWindowType;
+
 #elif defined(__unix__)
 
 /* X11 (tentative)  */
diff --git a/gfx/gl/GLContextProvider.h b/gfx/gl/GLContextProvider.h
index 6e096c1..b6ea9b7 100644
--- a/gfx/gl/GLContextProvider.h
+++ b/gfx/gl/GLContextProvider.h
@@ -41,18 +41,20 @@ namespace gl {
   #define GL_CONTEXT_PROVIDER_DEFAULT GLContextProviderCGL
 #endif
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
   #define GL_CONTEXT_PROVIDER_NAME GLContextProviderGLX
   #include "GLContextProviderImpl.h"
   #undef GL_CONTEXT_PROVIDER_NAME
   #define GL_CONTEXT_PROVIDER_DEFAULT GLContextProviderGLX
 #endif
 
-#define GL_CONTEXT_PROVIDER_NAME GLContextProviderEGL
-#include "GLContextProviderImpl.h"
-#undef GL_CONTEXT_PROVIDER_NAME
-#ifndef GL_CONTEXT_PROVIDER_DEFAULT
-  #define GL_CONTEXT_PROVIDER_DEFAULT GLContextProviderEGL
+#ifndef MOZ_GL_PROVIDER
+  #define GL_CONTEXT_PROVIDER_NAME GLContextProviderEGL
+  #include "GLContextProviderImpl.h"
+  #undef GL_CONTEXT_PROVIDER_NAME
+  #ifndef GL_CONTEXT_PROVIDER_DEFAULT
+    #define GL_CONTEXT_PROVIDER_DEFAULT GLContextProviderEGL
+  #endif
 #endif
 
 #if defined(MOZ_WIDGET_UIKIT)
diff --git a/gfx/gl/GLContextProviderEGL.cpp b/gfx/gl/GLContextProviderEGL.cpp
index edd5678..57862b7 100644
--- a/gfx/gl/GLContextProviderEGL.cpp
+++ b/gfx/gl/GLContextProviderEGL.cpp
@@ -3,7 +3,7 @@
  * License, v. 2.0. If a copy of the MPL was not distributed with this
  * file, You can obtain one at http://mozilla.org/MPL/2.0/. */
 
-#if defined(MOZ_WIDGET_GTK)
+#if defined(MOZ_WIDGET_GTK_no)
     #include <gdk/gdkx.h>
     // we're using default display for now
     #define GET_NATIVE_WINDOW(aWidget) ((EGLNativeWindowType)GDK_WINDOW_XID((GdkWindow*)aWidget->GetNativeData(NS_NATIVE_WINDOW)))
diff --git a/gfx/gl/GLLibraryEGL.h b/gfx/gl/GLLibraryEGL.h
index fa6ea74..1cbabff 100644
--- a/gfx/gl/GLLibraryEGL.h
+++ b/gfx/gl/GLLibraryEGL.h
@@ -5,7 +5,7 @@
 #ifndef GLLIBRARYEGL_H_
 #define GLLIBRARYEGL_H_
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
 #include "mozilla/X11Util.h"
 #endif
 
@@ -46,7 +46,7 @@
     #endif
 #endif
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
 #define EGL_DEFAULT_DISPLAY  ((EGLNativeDisplayType)mozilla::DefaultXDisplay())
 #else
 #define EGL_DEFAULT_DISPLAY  ((EGLNativeDisplayType)0)
diff --git a/gfx/gl/moz.build b/gfx/gl/moz.build
index 6f43a49..a882cee 100644
--- a/gfx/gl/moz.build
+++ b/gfx/gl/moz.build
@@ -13,10 +13,7 @@ elif CONFIG['MOZ_WIDGET_TOOLKIT'] == 'cocoa':
 elif CONFIG['MOZ_WIDGET_TOOLKIT'] == 'uikit':
     gl_provider = 'EAGL'
 elif 'gtk' in CONFIG['MOZ_WIDGET_TOOLKIT']:
-    if CONFIG['MOZ_EGL_XRENDER_COMPOSITE']:
-        gl_provider = 'EGL'
-    else:
-        gl_provider = 'GLX'
+    gl_provider = 'EGL'
 elif CONFIG['MOZ_WIDGET_TOOLKIT'] == 'android':
     gl_provider = 'EGL'
 
diff --git a/gfx/ipc/GPUProcessManager.cpp b/gfx/ipc/GPUProcessManager.cpp
index 4ef83ba..d5341fc 100644
--- a/gfx/ipc/GPUProcessManager.cpp
+++ b/gfx/ipc/GPUProcessManager.cpp
@@ -19,7 +19,7 @@
 #include "mozilla/layers/LayerTreeOwnerTracker.h"
 #include "mozilla/layers/RemoteCompositorSession.h"
 #include "mozilla/widget/PlatformWidgetTypes.h"
-#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING
+#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING_no
 # include "mozilla/widget/CompositorWidgetChild.h"
 #endif
 #include "nsBaseWidget.h"
@@ -578,7 +578,7 @@ GPUProcessManager::CreateRemoteSession(nsBaseWidget* aWidget,
                                        bool aUseExternalSurfaceSize,
                                        const gfx::IntSize& aSurfaceSize)
 {
-#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING
+#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING_no
   ipc::Endpoint<PCompositorBridgeParent> parentPipe;
   ipc::Endpoint<PCompositorBridgeChild> childPipe;
 
diff --git a/gfx/layers/client/TextureClient.cpp b/gfx/layers/client/TextureClient.cpp
index 1e61c5a..80ccf8e 100644
--- a/gfx/layers/client/TextureClient.cpp
+++ b/gfx/layers/client/TextureClient.cpp
@@ -41,7 +41,7 @@
 #include "gfxWindowsPlatform.h"
 #include "gfx2DGlue.h"
 #endif
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "mozilla/layers/TextureClientX11.h"
 #ifdef GL_PROVIDER_GLX
 #include "GLXLibrary.h"
@@ -1059,7 +1059,7 @@ TextureClient::CreateForDrawing(TextureForwarder* aAllocator,
   }
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   gfxSurfaceType type =
     gfxPlatform::GetPlatform()->ScreenReferenceSurface()->GetType();
 
diff --git a/gfx/layers/composite/TextureHost.cpp b/gfx/layers/composite/TextureHost.cpp
index 5f1e1cf..c7d0763 100644
--- a/gfx/layers/composite/TextureHost.cpp
+++ b/gfx/layers/composite/TextureHost.cpp
@@ -35,7 +35,7 @@
 #include "../d3d11/CompositorD3D11.h"
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "mozilla/layers/X11TextureHost.h"
 #endif
 
@@ -208,7 +208,7 @@ TextureHost::Create(const SurfaceDescriptor& aDesc,
         return CreateTextureHostBasic(aDesc, aDeallocator, aFlags);
       }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     case SurfaceDescriptor::TSurfaceDescriptorX11: {
       const SurfaceDescriptorX11& desc = aDesc.get_SurfaceDescriptorX11();
       return MakeAndAddRef<X11TextureHost>(aFlags, desc);
diff --git a/gfx/layers/ipc/CompositorBridgeChild.cpp b/gfx/layers/ipc/CompositorBridgeChild.cpp
index 78d26c0..df3e4d1 100644
--- a/gfx/layers/ipc/CompositorBridgeChild.cpp
+++ b/gfx/layers/ipc/CompositorBridgeChild.cpp
@@ -40,7 +40,7 @@
 #include "WinUtils.h"
 #endif
 #include "mozilla/widget/CompositorWidget.h"
-#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING
+#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING_no
 # include "mozilla/widget/CompositorWidgetChild.h"
 #endif
 #include "VsyncSource.h"
@@ -1086,7 +1086,7 @@ CompositorBridgeChild::AllocPCompositorWidgetChild(const CompositorWidgetInitDat
 bool
 CompositorBridgeChild::DeallocPCompositorWidgetChild(PCompositorWidgetChild* aActor)
 {
-#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING
+#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING_no
   delete aActor;
   return true;
 #else
diff --git a/gfx/layers/ipc/CompositorBridgeParent.cpp b/gfx/layers/ipc/CompositorBridgeParent.cpp
index ea8e3ec..468646e 100644
--- a/gfx/layers/ipc/CompositorBridgeParent.cpp
+++ b/gfx/layers/ipc/CompositorBridgeParent.cpp
@@ -54,7 +54,7 @@
 #include "mozilla/media/MediaSystemResourceService.h" // for MediaSystemResourceService
 #include "mozilla/mozalloc.h"           // for operator new, etc
 #include "mozilla/Telemetry.h"
-#ifdef MOZ_WIDGET_GTK
+#ifdef MOZ_WIDGET_GTK_no
 #include "basic/X11BasicCompositor.h" // for X11BasicCompositor
 #endif
 #include "nsCOMPtr.h"                   // for already_AddRefed
@@ -83,7 +83,7 @@
 #include "VsyncSource.h"
 #endif
 #include "mozilla/widget/CompositorWidget.h"
-#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING
+#ifdef MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING_no
 # include "mozilla/widget/CompositorWidgetParent.h"
 #endif
 
@@ -1354,7 +1354,7 @@ CompositorBridgeParent::NewCompositor(const nsTArray<LayersBackend>& aBackendHin
                                      mEGLSurfaceSize.height,
                                      mUseExternalSurfaceSize);
     } else if (aBackendHints[i] == LayersBackend::LAYERS_BASIC) {
-#ifdef MOZ_WIDGET_GTK
+#ifdef MOZ_WIDGET_GTK_no
       if (gfxVars::UseXRender()) {
         compositor = new X11BasicCompositor(this, mWidget);
       } else
@@ -1655,7 +1655,7 @@ CompositorBridgeParent::PostInsertVsyncProfilerMarker(TimeStamp aVsyncTimestamp)
 widget::PCompositorWidgetParent*
 CompositorBridgeParent::AllocPCompositorWidgetParent(const CompositorWidgetInitData& aInitData)
 {
-#if defined(MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING)
+#if defined(MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING_no)
   if (mWidget) {
     // Should not create two widgets on the same compositor.
     return nullptr;
@@ -1676,7 +1676,7 @@ CompositorBridgeParent::AllocPCompositorWidgetParent(const CompositorWidgetInitD
 bool
 CompositorBridgeParent::DeallocPCompositorWidgetParent(PCompositorWidgetParent* aActor)
 {
-#if defined(MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING)
+#if defined(MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING_no)
   static_cast<widget::CompositorWidgetParent*>(aActor)->Release();
   return true;
 #else
diff --git a/gfx/layers/ipc/ShadowLayerUtils.h b/gfx/layers/ipc/ShadowLayerUtils.h
index 257cee8..c1393b2 100644
--- a/gfx/layers/ipc/ShadowLayerUtils.h
+++ b/gfx/layers/ipc/ShadowLayerUtils.h
@@ -17,7 +17,7 @@
 #define MOZ_HAVE_PLATFORM_SPECIFIC_LAYER_BUFFERS
 #endif
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
 # include "mozilla/layers/ShadowLayerUtilsX11.h"
 #else
 namespace mozilla { namespace layers {
diff --git a/gfx/layers/moz.build b/gfx/layers/moz.build
index 79b2932..b34e919 100644
--- a/gfx/layers/moz.build
+++ b/gfx/layers/moz.build
@@ -201,7 +201,7 @@ EXPORTS.mozilla.layers += [
     'TransactionIdAllocator.h',
 ]
 
-if CONFIG['MOZ_X11']:
+if CONFIG['MOZ_X11_no']:
     EXPORTS.mozilla.layers += [
         'basic/TextureClientX11.h',
         'basic/X11TextureSourceBasic.h',
diff --git a/gfx/src/moz.build b/gfx/src/moz.build
index 3678eee..dc48470 100644
--- a/gfx/src/moz.build
+++ b/gfx/src/moz.build
@@ -51,7 +51,7 @@ EXPORTS.mozilla.gfx += [
     'TiledRegion.h',
 ]
 
-if CONFIG['MOZ_X11']:
+if CONFIG['MOZ_X11_no']:
     EXPORTS.mozilla += ['X11Util.h']
     SOURCES += [
         'X11Util.cpp',
diff --git a/gfx/thebes/gfxASurface.cpp b/gfx/thebes/gfxASurface.cpp
index 33a6353..6ff968a 100644
--- a/gfx/thebes/gfxASurface.cpp
+++ b/gfx/thebes/gfxASurface.cpp
@@ -29,7 +29,7 @@
 #include "gfxWindowsSurface.h"
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "gfxXlibSurface.h"
 #endif
 
@@ -160,7 +160,7 @@ gfxASurface::Wrap (cairo_surface_t *csurf, const IntSize& aSize)
         result = new gfxWindowsSurface(csurf);
     }
 #endif
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     else if (stype == CAIRO_SURFACE_TYPE_XLIB) {
         result = new gfxXlibSurface(csurf);
     }
diff --git a/gfx/thebes/gfxDrawable.cpp b/gfx/thebes/gfxDrawable.cpp
index cf6c2d8..61cbe44 100644
--- a/gfx/thebes/gfxDrawable.cpp
+++ b/gfx/thebes/gfxDrawable.cpp
@@ -8,8 +8,8 @@
 #include "gfxContext.h"
 #include "gfxPlatform.h"
 #include "gfx2DGlue.h"
-#ifdef MOZ_X11
 #include "cairo.h"
+#ifdef MOZ_X11_no
 #include "gfxXlibSurface.h"
 #endif
 #include "mozilla/gfx/Logging.h"
diff --git a/gfx/thebes/gfxFcPlatformFontList.cpp b/gfx/thebes/gfxFcPlatformFontList.cpp
index 1947115..bda52a6 100644
--- a/gfx/thebes/gfxFcPlatformFontList.cpp
+++ b/gfx/thebes/gfxFcPlatformFontList.cpp
@@ -33,7 +33,7 @@
 #include "gfxPlatformGtk.h"
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "mozilla/X11Util.h"
 #endif
 
@@ -719,7 +719,7 @@ gfxFontconfigFontEntry::CreateScaledFont(FcPattern* aRenderPattern,
 static void ApplyGdkScreenFontOptions(FcPattern *aPattern);
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 static bool
 GetXftInt(Display* aDisplay, const char* aName, int* aResult)
 {
@@ -770,7 +770,7 @@ PreparePattern(FcPattern* aPattern, bool aIsPrinterFont)
 #ifdef MOZ_WIDGET_GTK
         ApplyGdkScreenFontOptions(aPattern);
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
         FcValue value;
         int lcdfilter;
         if (FcPatternGet(aPattern, FC_LCD_FILTER, 0, &value) == FcResultNoMatch) {
diff --git a/gfx/thebes/gfxGdkNativeRenderer.cpp b/gfx/thebes/gfxGdkNativeRenderer.cpp
index f8964ad..4b27491 100644
--- a/gfx/thebes/gfxGdkNativeRenderer.cpp
+++ b/gfx/thebes/gfxGdkNativeRenderer.cpp
@@ -7,7 +7,7 @@
 #include "gfxContext.h"
 #include "gfxPlatformGtk.h"
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <gdk/gdkx.h>
 #include "cairo-xlib.h"
 #include "gfxXlibSurface.h"
diff --git a/gfx/thebes/gfxGdkNativeRenderer.h b/gfx/thebes/gfxGdkNativeRenderer.h
index d95b1fe..4c465d6 100644
--- a/gfx/thebes/gfxGdkNativeRenderer.h
+++ b/gfx/thebes/gfxGdkNativeRenderer.h
@@ -8,7 +8,7 @@
 
 #include <gdk/gdk.h>
 #include "nsSize.h"
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "gfxXlibNativeRenderer.h"
 #endif
 
@@ -21,7 +21,7 @@ class gfxContext;
  * to all Thebes transformations, clipping etc.
  */
 class gfxGdkNativeRenderer
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     : private gfxXlibNativeRenderer
 #endif
 {
@@ -46,7 +46,7 @@ public:
         // will be set and there is no dependence on what the existing pixels
         // in the drawable are set to.
         DRAW_IS_OPAQUE =
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
             gfxXlibNativeRenderer::DRAW_IS_OPAQUE
 #else
             0x1
@@ -54,7 +54,7 @@ public:
         // If set, then numClipRects can be zero or one.
         // If not set, then numClipRects will be zero.
         , DRAW_SUPPORTS_CLIP_RECT =
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
             gfxXlibNativeRenderer::DRAW_SUPPORTS_CLIP_RECT
 #else
             0x2
@@ -73,7 +73,7 @@ public:
 #endif
 
 private:
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // for gfxXlibNativeRenderer:
     virtual nsresult DrawWithXlib(cairo_surface_t* surface,
                                   nsIntPoint offset,
diff --git a/gfx/thebes/gfxPlatformGtk.cpp b/gfx/thebes/gfxPlatformGtk.cpp
index 8be91c9..815b5f2 100644
--- a/gfx/thebes/gfxPlatformGtk.cpp
+++ b/gfx/thebes/gfxPlatformGtk.cpp
@@ -36,11 +36,11 @@
 
 #include "gfxImageSurface.h"
 #ifdef MOZ_X11
-#include <gdk/gdkx.h>
-#include "gfxXlibSurface.h"
-#include "cairo-xlib.h"
+//#include <gdk/gdkx.h>
+//#include "gfxXlibSurface.h"
+//#include "cairo-xlib.h"
 #include "mozilla/Preferences.h"
-#include "mozilla/X11Util.h"
+//#include "mozilla/X11Util.h"
 
 #ifdef GL_PROVIDER_GLX
 #include "GLContextProvider.h"
@@ -86,7 +86,7 @@ gfxPlatformGtk::gfxPlatformGtk()
 
     mMaxGenericSubstitutions = UNINITIALIZED_VALUE;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     if (XRE_IsParentProcess()) {
       if (GDK_IS_X11_DISPLAY(gdk_display_get_default()) &&
           mozilla::Preferences::GetBool("gfx.xrender.enabled"))
@@ -106,12 +106,7 @@ gfxPlatformGtk::gfxPlatformGtk()
                      contentMask, BackendType::CAIRO);
 
 #ifdef MOZ_X11
-    if (GDK_IS_X11_DISPLAY(gdk_display_get_default())) {
-      mCompositorDisplay = XOpenDisplay(nullptr);
-      MOZ_ASSERT(mCompositorDisplay, "Failed to create compositor display!");
-    } else {
       mCompositorDisplay = nullptr;
-    }
 #endif // MOZ_X11
 }
 
@@ -123,7 +118,7 @@ gfxPlatformGtk::~gfxPlatformGtk()
         gfxPangoFontGroup::Shutdown();
     }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     if (mCompositorDisplay) {
       XCloseDisplay(mCompositorDisplay);
     }
@@ -133,9 +128,9 @@ gfxPlatformGtk::~gfxPlatformGtk()
 void
 gfxPlatformGtk::FlushContentDrawing()
 {
-    if (gfxVars::UseXRender()) {
-        XFlush(DefaultXDisplay());
-    }
+//    if (gfxVars::UseXRender()) {
+//        XFlush(DefaultXDisplay());
+//    }
 }
 
 already_AddRefed<gfxASurface>
@@ -156,24 +151,12 @@ gfxPlatformGtk::CreateOffscreenSurface(const IntSize& aSize,
     if (gdkScreen) {
         // When forcing PaintedLayers to use image surfaces for content,
         // force creation of gfxImageSurface surfaces.
-        if (gfxVars::UseXRender() && !UseImageOffscreenSurfaces()) {
-            Screen *screen = gdk_x11_screen_get_xscreen(gdkScreen);
-            XRenderPictFormat* xrenderFormat =
-                gfxXlibSurface::FindRenderFormat(DisplayOfScreen(screen),
-                                                 aFormat);
-
-            if (xrenderFormat) {
-                newSurface = gfxXlibSurface::Create(screen, xrenderFormat,
-                                                    aSize);
-            }
-        } else {
             // We're not going to use XRender, so we don't need to
             // search for a render format
             newSurface = new gfxImageSurface(aSize, aFormat);
             // The gfxImageSurface ctor zeroes this for us, no need to
             // waste time clearing again
             needsClear = false;
-        }
     }
 #endif
 
@@ -472,7 +455,7 @@ gfxPlatformGtk::GetPlatformCMSOutputProfile(void *&mem, size_t &size)
     mem = nullptr;
     size = 0;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     GdkDisplay *display = gdk_display_get_default();
     if (!GDK_IS_X11_DISPLAY(display))
         return;
@@ -625,7 +608,7 @@ gfxPlatformGtk::GetGdkDrawable(cairo_surface_t *target)
     if (result)
         return result;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     if (cairo_surface_get_type(target) != CAIRO_SURFACE_TYPE_XLIB)
         return nullptr;
 
@@ -905,5 +888,5 @@ gfxPlatformGtk::CreateHardwareVsyncSource()
   }
   return gfxPlatform::CreateHardwareVsyncSource();
 }
-
 #endif
+
diff --git a/gfx/thebes/moz.build b/gfx/thebes/moz.build
index ad6ea00..45b88ef 100644
--- a/gfx/thebes/moz.build
+++ b/gfx/thebes/moz.build
@@ -115,7 +115,7 @@ elif 'gtk' in CONFIG['MOZ_WIDGET_TOOLKIT']:
         'PrintTargetPS.cpp',
     ]
 
-    if CONFIG['MOZ_X11']:
+    if CONFIG['MOZ_X11_no']:
         EXPORTS += [
             'gfxXlibNativeRenderer.h',
             'gfxXlibSurface.h',
diff --git a/layout/generic/nsPluginFrame.cpp b/layout/generic/nsPluginFrame.cpp
index ac987b6..0a2bf77 100644
--- a/layout/generic/nsPluginFrame.cpp
+++ b/layout/generic/nsPluginFrame.cpp
@@ -74,7 +74,7 @@
 #include "mozilla/gfx/QuartzSupport.h"
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "mozilla/X11Util.h"
 using mozilla::DefaultXDisplay;
 #endif
diff --git a/media/webrtc/trunk/webrtc/modules/desktop_capture/desktop_capture_options.cc b/media/webrtc/trunk/webrtc/modules/desktop_capture/desktop_capture_options.cc
index b7f123b..eacd634 100644
--- a/media/webrtc/trunk/webrtc/modules/desktop_capture/desktop_capture_options.cc
+++ b/media/webrtc/trunk/webrtc/modules/desktop_capture/desktop_capture_options.cc
@@ -30,7 +30,7 @@ DesktopCaptureOptions::~DesktopCaptureOptions() {}
 // static
 DesktopCaptureOptions DesktopCaptureOptions::CreateDefault() {
   DesktopCaptureOptions result;
-#if defined(USE_X11)
+#if defined(USE_X11_no)
   result.set_x_display(SharedXDisplay::CreateDefault());
 #endif
 #if defined(WEBRTC_MAC) && !defined(WEBRTC_IOS)
diff --git a/media/webrtc/trunk/webrtc/modules/desktop_capture/desktop_capture_options.h b/media/webrtc/trunk/webrtc/modules/desktop_capture/desktop_capture_options.h
index 68bb588..b9286cb 100644
--- a/media/webrtc/trunk/webrtc/modules/desktop_capture/desktop_capture_options.h
+++ b/media/webrtc/trunk/webrtc/modules/desktop_capture/desktop_capture_options.h
@@ -13,7 +13,7 @@
 #include "webrtc/base/constructormagic.h"
 #include "webrtc/base/scoped_ref_ptr.h"
 
-#if defined(USE_X11)
+#if defined(USE_X11_no)
 #include "webrtc/modules/desktop_capture/x11/shared_x_display.h"
 #endif
 
@@ -37,7 +37,7 @@ class DesktopCaptureOptions {
   // X11 connection failed (e.g. DISPLAY isn't set).
   static DesktopCaptureOptions CreateDefault();
 
-#if defined(USE_X11)
+#if defined(USE_X11_no)
   SharedXDisplay* x_display() const { return x_display_; }
   void set_x_display(rtc::scoped_refptr<SharedXDisplay> x_display) {
     x_display_ = x_display;
@@ -86,7 +86,7 @@ class DesktopCaptureOptions {
 #endif
 
  private:
-#if defined(USE_X11)
+#if defined(USE_X11_no)
   rtc::scoped_refptr<SharedXDisplay> x_display_;
 #endif
 
diff --git a/old-configure b/old-configure
index feafdb3..2bf04b4 100644
--- a/old-configure
+++ b/old-configure
@@ -1896,64 +1896,13 @@ else
   fi
 fi
 
-for ac_declaration in \
-   ''\
-   '#include <stdlib.h>' \
-   'extern "C" void std::exit (int) throw (); using std::exit;' \
-   'extern "C" void std::exit (int); using std::exit;' \
-   'extern "C" void exit (int) throw ();' \
-   'extern "C" void exit (int);' \
-   'void exit (int);'
-do
-  cat > conftest.$ac_ext <<EOF
-#line 1910 "configure"
-#include "confdefs.h"
-#include <stdlib.h>
-$ac_declaration
-int main() {
-exit (42);
-; return 0; }
-EOF
-if { (eval echo configure:1918: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  :
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  continue
-fi
-rm -f conftest*
-  cat > conftest.$ac_ext <<EOF
-#line 1928 "configure"
-#include "confdefs.h"
-$ac_declaration
-int main() {
-exit (42);
-; return 0; }
-EOF
-if { (eval echo configure:1935: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  rm -rf conftest*
-  break
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-fi
-rm -f conftest*
-done
-if test -n "$ac_declaration"; then
-  echo '#ifdef __cplusplus' >>confdefs.h
-  echo $ac_declaration      >>confdefs.h
-  echo '#endif'             >>confdefs.h
-fi
-
-
 
 for ac_prog in "${TOOLCHAIN_PREFIX}ranlib"
 do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1957: checking for $ac_word" >&5
+echo "configure:1906: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -1988,7 +1937,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1992: checking for $ac_word" >&5
+echo "configure:1941: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_AR'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2023,7 +1972,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2027: checking for $ac_word" >&5
+echo "configure:1976: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_AS'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2058,7 +2007,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2062: checking for $ac_word" >&5
+echo "configure:2011: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_LIPO'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2093,7 +2042,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2097: checking for $ac_word" >&5
+echo "configure:2046: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_STRIP'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2128,7 +2077,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2132: checking for $ac_word" >&5
+echo "configure:2081: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_WINDRES'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2163,7 +2112,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2167: checking for $ac_word" >&5
+echo "configure:2116: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_OTOOL'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2198,7 +2147,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2202: checking for $ac_word" >&5
+echo "configure:2151: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_OBJCOPY'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2234,7 +2183,7 @@ else
     # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2238: checking for $ac_word" >&5
+echo "configure:2187: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2264,7 +2213,7 @@ if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2268: checking for $ac_word" >&5
+echo "configure:2217: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2315,7 +2264,7 @@ fi
       # Extract the first word of "cl", so it can be a program name with args.
 set dummy cl; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2319: checking for $ac_word" >&5
+echo "configure:2268: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2347,7 +2296,7 @@ fi
 fi
 
 echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works""... $ac_c" 1>&6
-echo "configure:2351: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
+echo "configure:2300: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
 
 ac_ext=c
 # CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
@@ -2358,12 +2307,12 @@ cross_compiling=$ac_cv_prog_cc_cross
 
 cat > conftest.$ac_ext << EOF
 
-#line 2362 "configure"
+#line 2311 "configure"
 #include "confdefs.h"
 
 main(){return(0);}
 EOF
-if { (eval echo configure:2367: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2316: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   ac_cv_prog_cc_works=yes
   # If we can't run a trivial program, we are probably using a cross compiler.
   if (./conftest; exit) 2>/dev/null; then
@@ -2389,12 +2338,12 @@ if test $ac_cv_prog_cc_works = no; then
   { echo "configure: error: installation or configuration problem: C compiler cannot create executables." 1>&2; echo "configure: error: installation or configuration problem: C compiler cannot create executables." 1>&5; exit 1; }
 fi
 echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler""... $ac_c" 1>&6
-echo "configure:2393: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
+echo "configure:2342: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
 echo "$ac_t""$ac_cv_prog_cc_cross" 1>&6
 cross_compiling=$ac_cv_prog_cc_cross
 
 echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
-echo "configure:2398: checking whether we are using GNU C" >&5
+echo "configure:2347: checking whether we are using GNU C" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2403,7 +2352,7 @@ else
   yes;
 #endif
 EOF
-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:2407: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
+if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:2356: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
   ac_cv_prog_gcc=yes
 else
   ac_cv_prog_gcc=no
@@ -2422,7 +2371,7 @@ ac_test_CFLAGS="${CFLAGS+set}"
 ac_save_CFLAGS="$CFLAGS"
 CFLAGS=
 echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
-echo "configure:2426: checking whether ${CC-cc} accepts -g" >&5
+echo "configure:2375: checking whether ${CC-cc} accepts -g" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_cc_g'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2463,7 +2412,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2467: checking for $ac_word" >&5
+echo "configure:2416: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_CXX'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2495,7 +2444,7 @@ test -n "$CXX" || CXX="gcc"
 
 
 echo $ac_n "checking whether the C++ compiler ($CXX $CXXFLAGS $LDFLAGS) works""... $ac_c" 1>&6
-echo "configure:2499: checking whether the C++ compiler ($CXX $CXXFLAGS $LDFLAGS) works" >&5
+echo "configure:2448: checking whether the C++ compiler ($CXX $CXXFLAGS $LDFLAGS) works" >&5
 
 ac_ext=C
 # CXXFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
@@ -2506,12 +2455,12 @@ cross_compiling=$ac_cv_prog_cxx_cross
 
 cat > conftest.$ac_ext << EOF
 
-#line 2510 "configure"
+#line 2459 "configure"
 #include "confdefs.h"
 
 int main(){return(0);}
 EOF
-if { (eval echo configure:2515: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:2464: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   ac_cv_prog_cxx_works=yes
   # If we can't run a trivial program, we are probably using a cross compiler.
   if (./conftest; exit) 2>/dev/null; then
@@ -2537,12 +2486,12 @@ if test $ac_cv_prog_cxx_works = no; then
   { echo "configure: error: installation or configuration problem: C++ compiler cannot create executables." 1>&2; echo "configure: error: installation or configuration problem: C++ compiler cannot create executables." 1>&5; exit 1; }
 fi
 echo $ac_n "checking whether the C++ compiler ($CXX $CXXFLAGS $LDFLAGS) is a cross-compiler""... $ac_c" 1>&6
-echo "configure:2541: checking whether the C++ compiler ($CXX $CXXFLAGS $LDFLAGS) is a cross-compiler" >&5
+echo "configure:2490: checking whether the C++ compiler ($CXX $CXXFLAGS $LDFLAGS) is a cross-compiler" >&5
 echo "$ac_t""$ac_cv_prog_cxx_cross" 1>&6
 cross_compiling=$ac_cv_prog_cxx_cross
 
 echo $ac_n "checking whether we are using GNU C++""... $ac_c" 1>&6
-echo "configure:2546: checking whether we are using GNU C++" >&5
+echo "configure:2495: checking whether we are using GNU C++" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_gxx'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2551,7 +2500,7 @@ else
   yes;
 #endif
 EOF
-if { ac_try='${CXX-g++} -E conftest.C'; { (eval echo configure:2555: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
+if { ac_try='${CXX-g++} -E conftest.C'; { (eval echo configure:2504: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
   ac_cv_prog_gxx=yes
 else
   ac_cv_prog_gxx=no
@@ -2570,7 +2519,7 @@ ac_test_CXXFLAGS="${CXXFLAGS+set}"
 ac_save_CXXFLAGS="$CXXFLAGS"
 CXXFLAGS=
 echo $ac_n "checking whether ${CXX-g++} accepts -g""... $ac_c" 1>&6
-echo "configure:2574: checking whether ${CXX-g++} accepts -g" >&5
+echo "configure:2523: checking whether ${CXX-g++} accepts -g" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_cxx_g'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2601,61 +2550,10 @@ else
   fi
 fi
 
-for ac_declaration in \
-   ''\
-   '#include <stdlib.h>' \
-   'extern "C" void std::exit (int) throw (); using std::exit;' \
-   'extern "C" void std::exit (int); using std::exit;' \
-   'extern "C" void exit (int) throw ();' \
-   'extern "C" void exit (int);' \
-   'void exit (int);'
-do
-  cat > conftest.$ac_ext <<EOF
-#line 2615 "configure"
-#include "confdefs.h"
-#include <stdlib.h>
-$ac_declaration
-int main() {
-exit (42);
-; return 0; }
-EOF
-if { (eval echo configure:2623: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  :
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  continue
-fi
-rm -f conftest*
-  cat > conftest.$ac_ext <<EOF
-#line 2633 "configure"
-#include "confdefs.h"
-$ac_declaration
-int main() {
-exit (42);
-; return 0; }
-EOF
-if { (eval echo configure:2640: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  rm -rf conftest*
-  break
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-fi
-rm -f conftest*
-done
-if test -n "$ac_declaration"; then
-  echo '#ifdef __cplusplus' >>confdefs.h
-  echo $ac_declaration      >>confdefs.h
-  echo '#endif'             >>confdefs.h
-fi
-
-
     # Extract the first word of "ranlib", so it can be a program name with args.
 set dummy ranlib; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2659: checking for $ac_word" >&5
+echo "configure:2557: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2687,7 +2585,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2691: checking for $ac_word" >&5
+echo "configure:2589: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_AS'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2741,7 +2639,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2745: checking for $ac_word" >&5
+echo "configure:2643: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_AR'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2776,7 +2674,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2780: checking for $ac_word" >&5
+echo "configure:2678: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_STRIP'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2811,7 +2709,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2815: checking for $ac_word" >&5
+echo "configure:2713: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_WINDRES'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2846,7 +2744,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2850: checking for $ac_word" >&5
+echo "configure:2748: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_OTOOL'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2948,7 +2846,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:2952: checking for $ac_word" >&5
+echo "configure:2850: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_MIDL'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -2990,14 +2888,14 @@ ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$a
 cross_compiling=$ac_cv_prog_cc_cross
 
         cat > conftest.$ac_ext <<EOF
-#line 2994 "configure"
+#line 2892 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 int main() {
  printf("Hello World\n"); 
 ; return 0; }
 EOF
-if { (eval echo configure:3001: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2899: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
@@ -3015,14 +2913,14 @@ ac_link='${CXX-g++} -o conftest${ac_exeext} $CXXFLAGS $CPPFLAGS $LDFLAGS conftes
 cross_compiling=$ac_cv_prog_cxx_cross
 
         cat > conftest.$ac_ext <<EOF
-#line 3019 "configure"
+#line 2917 "configure"
 #include "confdefs.h"
 #include <new.h>
 int main() {
  unsigned *test = new unsigned(42); 
 ; return 0; }
 EOF
-if { (eval echo configure:3026: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2924: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
@@ -3076,12 +2974,12 @@ EOF
 
                ac_safe=`echo "dia2.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for dia2.h""... $ac_c" 1>&6
-echo "configure:3080: checking for dia2.h" >&5
+echo "configure:2978: checking for dia2.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 3085 "configure"
+#line 2983 "configure"
 #include "confdefs.h"
 
 #include <dia2.h>
@@ -3089,7 +2987,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:3093: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:2991: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -3189,7 +3087,7 @@ EOF
         unset _MSVC_VER_FILTER
 
         echo $ac_n "checking for overridable _RAISE""... $ac_c" 1>&6
-echo "configure:3193: checking for overridable _RAISE" >&5
+echo "configure:3091: checking for overridable _RAISE" >&5
 if eval "test \"`echo '$''{'ac_cv_have__RAISE'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3205,7 +3103,7 @@ cross_compiling=$ac_cv_prog_cxx_cross
                 _SAVE_CXXFLAGS="$CXXFLAGS"
                 CXXFLAGS="${CXXFLAGS} -D_HAS_EXCEPTIONS=0"
                 cat > conftest.$ac_ext <<EOF
-#line 3209 "configure"
+#line 3107 "configure"
 #include "confdefs.h"
 #include <xstddef>
                                 #undef _RAISE
@@ -3216,7 +3114,7 @@ int main() {
 std::vector<int> v; return v.at(1);
 ; return 0; }
 EOF
-if { (eval echo configure:3220: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3118: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_have__RAISE="no"
 else
@@ -3262,9 +3160,9 @@ EOF
         _W32API_MAJOR_VERSION=`echo $W32API_VERSION | $AWK -F\. '{ print $1 }'`
         _W32API_MINOR_VERSION=`echo $W32API_VERSION | $AWK -F\. '{ print $2 }'`
         echo $ac_n "checking for w32api version >= $W32API_VERSION""... $ac_c" 1>&6
-echo "configure:3266: checking for w32api version >= $W32API_VERSION" >&5
+echo "configure:3164: checking for w32api version >= $W32API_VERSION" >&5
         cat > conftest.$ac_ext <<EOF
-#line 3268 "configure"
+#line 3166 "configure"
 #include "confdefs.h"
 #include <w32api.h>
 int main() {
@@ -3276,7 +3174,7 @@ int main() {
             
 ; return 0; }
 EOF
-if { (eval echo configure:3280: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3178: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
    res=yes 
 else
@@ -3292,7 +3190,7 @@ rm -f conftest*
         fi
         # Check windres version
         echo $ac_n "checking for windres version >= $WINDRES_VERSION""... $ac_c" 1>&6
-echo "configure:3296: checking for windres version >= $WINDRES_VERSION" >&5
+echo "configure:3194: checking for windres version >= $WINDRES_VERSION" >&5
         _WINDRES_VERSION=`${WINDRES} --version 2>&1 | grep -i windres 2>/dev/null | $AWK '{ print $3 }'`
         echo "$ac_t""$_WINDRES_VERSION" 1>&6
         _WINDRES_MAJOR_VERSION=`echo $_WINDRES_VERSION | $AWK -F\. '{ print $1 }'`
@@ -3316,7 +3214,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:3320: checking for $ac_word" >&5
+echo "configure:3218: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_MIDL'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -3503,7 +3401,7 @@ tools are selected during the Xcode/Developer Tools installation." 1>&5; exit 1;
 
   
   echo $ac_n "checking for valid compiler/Mac OS X SDK combination""... $ac_c" 1>&6
-echo "configure:3507: checking for valid compiler/Mac OS X SDK combination" >&5
+echo "configure:3405: checking for valid compiler/Mac OS X SDK combination" >&5
   ac_ext=C
 # CXXFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
 ac_cpp='$CXXCPP $CPPFLAGS'
@@ -3512,14 +3410,14 @@ ac_link='${CXX-g++} -o conftest${ac_exeext} $CXXFLAGS $CPPFLAGS $LDFLAGS conftes
 cross_compiling=$ac_cv_prog_cxx_cross
 
   cat > conftest.$ac_ext <<EOF
-#line 3516 "configure"
+#line 3414 "configure"
 #include "confdefs.h"
 #include <new>
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:3523: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:3421: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   result=yes
 else
@@ -3550,7 +3448,7 @@ fi
 # Uses ac_ vars as temps to allow command line to override cache and checks.
 # --without-x overrides everything else, but does not touch the cache.
 echo $ac_n "checking for X""... $ac_c" 1>&6
-echo "configure:3554: checking for X" >&5
+echo "configure:3452: checking for X" >&5
 
 # Check whether --with-x or --without-x was given.
 if test "${with_x+set}" = set; then
@@ -3612,12 +3510,12 @@ if test "$ac_x_includes" = NO; then
 
   # First, try using that file with no special directory specified.
 cat > conftest.$ac_ext <<EOF
-#line 3616 "configure"
+#line 3514 "configure"
 #include "confdefs.h"
 #include <$x_direct_test_include>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:3621: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:3519: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -3686,14 +3584,14 @@ if test "$ac_x_libraries" = NO; then
   ac_save_LIBS="$LIBS"
   LIBS="-l$x_direct_test_library $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3690 "configure"
+#line 3588 "configure"
 #include "confdefs.h"
 
 int main() {
 ${x_direct_test_function}()
 ; return 0; }
 EOF
-if { (eval echo configure:3697: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3595: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LIBS="$ac_save_LIBS"
 # We can link X programs with no special library path.
@@ -3802,17 +3700,17 @@ else
     case "`(uname -sr) 2>/dev/null`" in
     "SunOS 5"*)
       echo $ac_n "checking whether -R must be followed by a space""... $ac_c" 1>&6
-echo "configure:3806: checking whether -R must be followed by a space" >&5
+echo "configure:3704: checking whether -R must be followed by a space" >&5
       ac_xsave_LIBS="$LIBS"; LIBS="$LIBS -R$x_libraries"
       cat > conftest.$ac_ext <<EOF
-#line 3809 "configure"
+#line 3707 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:3816: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3714: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_R_nospace=yes
 else
@@ -3828,14 +3726,14 @@ rm -f conftest*
       else
 	LIBS="$ac_xsave_LIBS -R $x_libraries"
 	cat > conftest.$ac_ext <<EOF
-#line 3832 "configure"
+#line 3730 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:3839: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3737: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_R_space=yes
 else
@@ -3867,7 +3765,7 @@ rm -f conftest*
     # libraries were built with DECnet support.  And karl@cs.umb.edu says
     # the Alpha needs dnet_stub (dnet does not exist).
     echo $ac_n "checking for dnet_ntoa in -ldnet""... $ac_c" 1>&6
-echo "configure:3871: checking for dnet_ntoa in -ldnet" >&5
+echo "configure:3769: checking for dnet_ntoa in -ldnet" >&5
 ac_lib_var=`echo dnet'_'dnet_ntoa | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -3875,7 +3773,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-ldnet  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3879 "configure"
+#line 3777 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -3886,7 +3784,7 @@ int main() {
 dnet_ntoa()
 ; return 0; }
 EOF
-if { (eval echo configure:3890: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3788: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -3908,7 +3806,7 @@ fi
 
     if test $ac_cv_lib_dnet_dnet_ntoa = no; then
       echo $ac_n "checking for dnet_ntoa in -ldnet_stub""... $ac_c" 1>&6
-echo "configure:3912: checking for dnet_ntoa in -ldnet_stub" >&5
+echo "configure:3810: checking for dnet_ntoa in -ldnet_stub" >&5
 ac_lib_var=`echo dnet_stub'_'dnet_ntoa | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -3916,7 +3814,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-ldnet_stub  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 3920 "configure"
+#line 3818 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -3927,7 +3825,7 @@ int main() {
 dnet_ntoa()
 ; return 0; }
 EOF
-if { (eval echo configure:3931: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3829: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -3956,12 +3854,12 @@ fi
     # The nsl library prevents programs from opening the X display
     # on Irix 5.2, according to dickey@clark.net.
     echo $ac_n "checking for gethostbyname""... $ac_c" 1>&6
-echo "configure:3960: checking for gethostbyname" >&5
+echo "configure:3858: checking for gethostbyname" >&5
 if eval "test \"`echo '$''{'ac_cv_func_gethostbyname'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 3965 "configure"
+#line 3863 "configure"
 #define gethostbyname innocuous_gethostbyname
 #include "confdefs.h"
 #undef gethostbyname
@@ -3988,7 +3886,7 @@ gethostbyname();
 
 ; return 0; }
 EOF
-if { (eval echo configure:3992: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3890: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_gethostbyname=yes"
 else
@@ -4009,7 +3907,7 @@ fi
 
     if test $ac_cv_func_gethostbyname = no; then
       echo $ac_n "checking for gethostbyname in -lnsl""... $ac_c" 1>&6
-echo "configure:4013: checking for gethostbyname in -lnsl" >&5
+echo "configure:3911: checking for gethostbyname in -lnsl" >&5
 ac_lib_var=`echo nsl'_'gethostbyname | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -4017,7 +3915,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lnsl  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 4021 "configure"
+#line 3919 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -4028,7 +3926,7 @@ int main() {
 gethostbyname()
 ; return 0; }
 EOF
-if { (eval echo configure:4032: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3930: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -4058,12 +3956,12 @@ fi
     # -lsocket must be given before -lnsl if both are needed.
     # We assume that if connect needs -lnsl, so does gethostbyname.
     echo $ac_n "checking for connect""... $ac_c" 1>&6
-echo "configure:4062: checking for connect" >&5
+echo "configure:3960: checking for connect" >&5
 if eval "test \"`echo '$''{'ac_cv_func_connect'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4067 "configure"
+#line 3965 "configure"
 #define connect innocuous_connect
 #include "confdefs.h"
 #undef connect
@@ -4090,7 +3988,7 @@ connect();
 
 ; return 0; }
 EOF
-if { (eval echo configure:4094: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:3992: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_connect=yes"
 else
@@ -4111,7 +4009,7 @@ fi
 
     if test $ac_cv_func_connect = no; then
       echo $ac_n "checking for connect in -lsocket""... $ac_c" 1>&6
-echo "configure:4115: checking for connect in -lsocket" >&5
+echo "configure:4013: checking for connect in -lsocket" >&5
 ac_lib_var=`echo socket'_'connect | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -4119,7 +4017,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lsocket $X_EXTRA_LIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 4123 "configure"
+#line 4021 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -4130,7 +4028,7 @@ int main() {
 connect()
 ; return 0; }
 EOF
-if { (eval echo configure:4134: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4032: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -4154,12 +4052,12 @@ fi
 
     # gomez@mi.uni-erlangen.de says -lposix is necessary on A/UX.
     echo $ac_n "checking for remove""... $ac_c" 1>&6
-echo "configure:4158: checking for remove" >&5
+echo "configure:4056: checking for remove" >&5
 if eval "test \"`echo '$''{'ac_cv_func_remove'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4163 "configure"
+#line 4061 "configure"
 #define remove innocuous_remove
 #include "confdefs.h"
 #undef remove
@@ -4186,7 +4084,7 @@ remove();
 
 ; return 0; }
 EOF
-if { (eval echo configure:4190: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4088: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_remove=yes"
 else
@@ -4207,7 +4105,7 @@ fi
 
     if test $ac_cv_func_remove = no; then
       echo $ac_n "checking for remove in -lposix""... $ac_c" 1>&6
-echo "configure:4211: checking for remove in -lposix" >&5
+echo "configure:4109: checking for remove in -lposix" >&5
 ac_lib_var=`echo posix'_'remove | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -4215,7 +4113,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lposix  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 4219 "configure"
+#line 4117 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -4226,7 +4124,7 @@ int main() {
 remove()
 ; return 0; }
 EOF
-if { (eval echo configure:4230: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4128: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -4250,12 +4148,12 @@ fi
 
     # BSDI BSD/OS 2.1 needs -lipc for XOpenDisplay.
     echo $ac_n "checking for shmat""... $ac_c" 1>&6
-echo "configure:4254: checking for shmat" >&5
+echo "configure:4152: checking for shmat" >&5
 if eval "test \"`echo '$''{'ac_cv_func_shmat'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 4259 "configure"
+#line 4157 "configure"
 #define shmat innocuous_shmat
 #include "confdefs.h"
 #undef shmat
@@ -4282,7 +4180,7 @@ shmat();
 
 ; return 0; }
 EOF
-if { (eval echo configure:4286: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4184: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_shmat=yes"
 else
@@ -4303,7 +4201,7 @@ fi
 
     if test $ac_cv_func_shmat = no; then
       echo $ac_n "checking for shmat in -lipc""... $ac_c" 1>&6
-echo "configure:4307: checking for shmat in -lipc" >&5
+echo "configure:4205: checking for shmat in -lipc" >&5
 ac_lib_var=`echo ipc'_'shmat | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -4311,7 +4209,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lipc  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 4315 "configure"
+#line 4213 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -4322,7 +4220,7 @@ int main() {
 shmat()
 ; return 0; }
 EOF
-if { (eval echo configure:4326: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4224: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -4355,7 +4253,7 @@ fi
   # libraries we check for below, so use a different variable.
   #  --interran@uluru.Stanford.EDU, kb@cs.umb.edu.
   echo $ac_n "checking for IceConnectionNumber in -lICE""... $ac_c" 1>&6
-echo "configure:4359: checking for IceConnectionNumber in -lICE" >&5
+echo "configure:4257: checking for IceConnectionNumber in -lICE" >&5
 ac_lib_var=`echo ICE'_'IceConnectionNumber | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -4363,7 +4261,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lICE $X_EXTRA_LIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 4367 "configure"
+#line 4265 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -4374,7 +4272,7 @@ int main() {
 IceConnectionNumber()
 ; return 0; }
 EOF
-if { (eval echo configure:4378: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4276: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -4533,14 +4431,14 @@ no)
     _SAVE_CFLAGS="$CFLAGS"
     CFLAGS="$arch_flag"
     cat > conftest.$ac_ext <<EOF
-#line 4537 "configure"
+#line 4435 "configure"
 #include "confdefs.h"
 
 int main() {
 return sizeof(__thumb2__);
 ; return 0; }
 EOF
-if { (eval echo configure:4544: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4442: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   MOZ_THUMB2=1
 else
@@ -4623,16 +4521,16 @@ if test -n "$align_flag"; then
   _SAVE_CFLAGS="$CFLAGS"
   CFLAGS="$CFLAGS $align_flag"
   echo $ac_n "checking whether alignment flag ($align_flag) is supported""... $ac_c" 1>&6
-echo "configure:4627: checking whether alignment flag ($align_flag) is supported" >&5
+echo "configure:4525: checking whether alignment flag ($align_flag) is supported" >&5
   cat > conftest.$ac_ext <<EOF
-#line 4629 "configure"
+#line 4527 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:4636: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4534: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
@@ -4649,16 +4547,16 @@ if test -n "$all_flags"; then
     _SAVE_CFLAGS="$CFLAGS"
     CFLAGS="$all_flags"
     echo $ac_n "checking whether the chosen combination of compiler flags ($all_flags) works""... $ac_c" 1>&6
-echo "configure:4653: checking whether the chosen combination of compiler flags ($all_flags) works" >&5
+echo "configure:4551: checking whether the chosen combination of compiler flags ($all_flags) works" >&5
     cat > conftest.$ac_ext <<EOF
-#line 4655 "configure"
+#line 4553 "configure"
 #include "confdefs.h"
 
 int main() {
 return 0;
 ; return 0; }
 EOF
-if { (eval echo configure:4662: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:4560: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 else
@@ -4682,18 +4580,18 @@ fi
 if test "$CPU_ARCH" = "arm"; then
   NEON_FLAGS="-mfpu=neon"
   echo $ac_n "checking for ARM SIMD support in compiler""... $ac_c" 1>&6
-echo "configure:4686: checking for ARM SIMD support in compiler" >&5
+echo "configure:4584: checking for ARM SIMD support in compiler" >&5
   # We try to link so that this also fails when
   # building with LTO.
   cat > conftest.$ac_ext <<EOF
-#line 4690 "configure"
+#line 4588 "configure"
 #include "confdefs.h"
 
 int main() {
 asm("uqadd8 r1, r1, r2");
 ; return 0; }
 EOF
-if { (eval echo configure:4697: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4595: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   result="yes"
 else
@@ -4716,23 +4614,23 @@ EOF
   fi
 
   echo $ac_n "checking ARM version support in compiler""... $ac_c" 1>&6
-echo "configure:4720: checking ARM version support in compiler" >&5
+echo "configure:4618: checking ARM version support in compiler" >&5
     ARM_ARCH=`${CC-cc} ${CFLAGS} -dM -E - < /dev/null | sed -n 's/.*__ARM_ARCH_\([0-9][0-9]*\).*/\1/p'`
   echo "$ac_t"""$ARM_ARCH"" 1>&6
 
   echo $ac_n "checking for ARM NEON support in compiler""... $ac_c" 1>&6
-echo "configure:4725: checking for ARM NEON support in compiler" >&5
+echo "configure:4623: checking for ARM NEON support in compiler" >&5
   # We try to link so that this also fails when
   # building with LTO.
   cat > conftest.$ac_ext <<EOF
-#line 4729 "configure"
+#line 4627 "configure"
 #include "confdefs.h"
 
 int main() {
 asm(".fpu neon\n vadd.i8 d0, d0, d0");
 ; return 0; }
 EOF
-if { (eval echo configure:4736: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:4634: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   result="yes"
 else
@@ -4911,7 +4809,7 @@ if test -n "$MOZ_ASAN"; then
          # Extract the first word of "$MOZ_CLANG_RT_ASAN_LIB", so it can be a program name with args.
 set dummy $MOZ_CLANG_RT_ASAN_LIB; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:4915: checking for $ac_word" >&5
+echo "configure:4813: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_MOZ_CLANG_RT_ASAN_LIB_PATH'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -4981,7 +4879,7 @@ EOF
      # Extract the first word of "llvm-symbolizer", so it can be a program name with args.
 set dummy llvm-symbolizer; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:4985: checking for $ac_word" >&5
+echo "configure:4883: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_LLVM_SYMBOLIZER'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -5058,7 +4956,7 @@ EOF
      # Extract the first word of "llvm-symbolizer", so it can be a program name with args.
 set dummy llvm-symbolizer; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:5062: checking for $ac_word" >&5
+echo "configure:4960: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_LLVM_SYMBOLIZER'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -5135,7 +5033,7 @@ EOF
      # Extract the first word of "llvm-symbolizer", so it can be a program name with args.
 set dummy llvm-symbolizer; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:5139: checking for $ac_word" >&5
+echo "configure:5037: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_LLVM_SYMBOLIZER'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -5206,14 +5104,14 @@ fi
 
 
 cat > conftest.$ac_ext <<EOF
-#line 5210 "configure"
+#line 5108 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5217: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5115: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   :
 else
   echo "configure: failed program was:" >&5
@@ -5240,18 +5138,18 @@ if test "$GNU_CC"; then
     DSO_PIC_CFLAGS='-fPIC'
     ASFLAGS="$ASFLAGS -fPIC"
     echo $ac_n "checking for --noexecstack option to as""... $ac_c" 1>&6
-echo "configure:5244: checking for --noexecstack option to as" >&5
+echo "configure:5142: checking for --noexecstack option to as" >&5
     _SAVE_CFLAGS=$CFLAGS
     CFLAGS="$CFLAGS -Wa,--noexecstack"
     cat > conftest.$ac_ext <<EOF
-#line 5248 "configure"
+#line 5146 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5255: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5153: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
                      ASFLAGS="$ASFLAGS -Wa,--noexecstack"
@@ -5264,18 +5162,18 @@ fi
 rm -f conftest*
     CFLAGS=$_SAVE_CFLAGS
     echo $ac_n "checking for -z noexecstack option to ld""... $ac_c" 1>&6
-echo "configure:5268: checking for -z noexecstack option to ld" >&5
+echo "configure:5166: checking for -z noexecstack option to ld" >&5
     _SAVE_LDFLAGS=$LDFLAGS
     LDFLAGS="$LDFLAGS -Wl,-z,noexecstack"
     cat > conftest.$ac_ext <<EOF
-#line 5272 "configure"
+#line 5170 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5279: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5177: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 else
@@ -5288,18 +5186,18 @@ fi
 rm -f conftest*
 
     echo $ac_n "checking for -z text option to ld""... $ac_c" 1>&6
-echo "configure:5292: checking for -z text option to ld" >&5
+echo "configure:5190: checking for -z text option to ld" >&5
     _SAVE_LDFLAGS=$LDFLAGS
     LDFLAGS="$LDFLAGS -Wl,-z,text"
     cat > conftest.$ac_ext <<EOF
-#line 5296 "configure"
+#line 5194 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5303: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5201: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
                   NSPR_LDFLAGS="$NSPR_LDFLAGS -Wl,-z,text"
@@ -5312,45 +5210,20 @@ else
 fi
 rm -f conftest*
 
-    echo $ac_n "checking for --build-id option to ld""... $ac_c" 1>&6
-echo "configure:5317: checking for --build-id option to ld" >&5
-    _SAVE_LDFLAGS=$LDFLAGS
-    LDFLAGS="$LDFLAGS -Wl,--build-id"
-    cat > conftest.$ac_ext <<EOF
-#line 5321 "configure"
-#include "confdefs.h"
-
-int main() {
-
-; return 0; }
-EOF
-if { (eval echo configure:5328: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  rm -rf conftest*
-  echo "$ac_t""yes" 1>&6
-                  NSPR_LDFLAGS="$NSPR_LDFLAGS -Wl,--build-id"
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  rm -rf conftest*
-  echo "$ac_t""no" 1>&6
-                  LDFLAGS=$_SAVE_LDFLAGS
-fi
-rm -f conftest*
-
-    echo $ac_n "checking for --ignore-unresolved-symbol option to ld""... $ac_c" 1>&6
-echo "configure:5342: checking for --ignore-unresolved-symbol option to ld" >&5
+     echo $ac_n "checking for --ignore-unresolved-symbol option to ld""... $ac_c" 1>&6
+echo "configure:5215: checking for --ignore-unresolved-symbol option to ld" >&5
     HAVE_LINKER_SUPPORT_IGNORE_UNRESOLVED=
     _SAVE_LDFLAGS=$LDFLAGS
     LDFLAGS="$LDFLAGS -Wl,--ignore-unresolved-symbol,environ"
     cat > conftest.$ac_ext <<EOF
-#line 5347 "configure"
+#line 5220 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5354: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5227: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
                   HAVE_LINKER_SUPPORT_IGNORE_UNRESOLVED=1
@@ -5365,19 +5238,19 @@ rm -f conftest*
 
     # Check for -mssse3 on $CC
     echo $ac_n "checking if toolchain supports -mssse3 option""... $ac_c" 1>&6
-echo "configure:5369: checking if toolchain supports -mssse3 option" >&5
+echo "configure:5242: checking if toolchain supports -mssse3 option" >&5
     HAVE_TOOLCHAIN_SUPPORT_MSSSE3=
     _SAVE_CFLAGS=$CFLAGS
     CFLAGS="$CFLAGS -mssse3"
     cat > conftest.$ac_ext <<EOF
-#line 5374 "configure"
+#line 5247 "configure"
 #include "confdefs.h"
 asm ("pmaddubsw %xmm2,%xmm3");
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5381: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5254: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
                      HAVE_TOOLCHAIN_SUPPORT_MSSSE3=1
@@ -5392,19 +5265,19 @@ rm -f conftest*
 
     # Check for -msse4.1 on $CC
     echo $ac_n "checking if toolchain supports -msse4.1 option""... $ac_c" 1>&6
-echo "configure:5396: checking if toolchain supports -msse4.1 option" >&5
+echo "configure:5269: checking if toolchain supports -msse4.1 option" >&5
     HAVE_TOOLCHAIN_SUPPORT_MSSE4_1=
     _SAVE_CFLAGS=$CFLAGS
     CFLAGS="$CFLAGS -msse4.1"
     cat > conftest.$ac_ext <<EOF
-#line 5401 "configure"
+#line 5274 "configure"
 #include "confdefs.h"
 asm ("pmulld %xmm6,%xmm0");
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5408: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5281: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
                      HAVE_TOOLCHAIN_SUPPORT_MSSE4_1=1
@@ -5420,16 +5293,16 @@ rm -f conftest*
     case "${CPU_ARCH}" in
     x86 | x86_64)
       echo $ac_n "checking for x86 AVX2 asm support in compiler""... $ac_c" 1>&6
-echo "configure:5424: checking for x86 AVX2 asm support in compiler" >&5
+echo "configure:5297: checking for x86 AVX2 asm support in compiler" >&5
       cat > conftest.$ac_ext <<EOF
-#line 5426 "configure"
+#line 5299 "configure"
 #include "confdefs.h"
 
 int main() {
 asm volatile ("vpermq      \$0xd8,%ymm0,%ymm0 \n");
 ; return 0; }
 EOF
-if { (eval echo configure:5433: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5306: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   result="yes"
 else
@@ -5447,19 +5320,19 @@ rm -f conftest*
 
     ppc*)
       echo $ac_n "checking whether we can enable AltiVec support""... $ac_c" 1>&6
-echo "configure:5451: checking whether we can enable AltiVec support" >&5
+echo "configure:5324: checking whether we can enable AltiVec support" >&5
       HAVE_ALTIVEC=
       _SAVE_CFLAGS=$CFLAGS
       CFLAGS="$CFLAGS -maltivec"
       cat > conftest.$ac_ext <<EOF
-#line 5456 "configure"
+#line 5329 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5463: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5336: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
                        HAVE_ALTIVEC=1
@@ -5525,12 +5398,12 @@ fi
 if test -n "$MOZ_VALGRIND"; then
        ac_safe=`echo "valgrind/valgrind.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for valgrind/valgrind.h""... $ac_c" 1>&6
-echo "configure:5529: checking for valgrind/valgrind.h" >&5
+echo "configure:5402: checking for valgrind/valgrind.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 5534 "configure"
+#line 5407 "configure"
 #include "confdefs.h"
 
 #include <valgrind/valgrind.h>
@@ -5538,7 +5411,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5542: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5415: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -5696,12 +5569,12 @@ case "$target" in
     STRIP_FLAGS="$STRIP_FLAGS -x -S"
     # Ensure that if we're targeting iOS an SDK was provided.
     echo $ac_n "checking for iOS target""... $ac_c" 1>&6
-echo "configure:5700: checking for iOS target" >&5
+echo "configure:5573: checking for iOS target" >&5
 if eval "test \"`echo '$''{'ac_cv_ios_target'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 5705 "configure"
+#line 5578 "configure"
 #include "confdefs.h"
 #include <TargetConditionals.h>
 #if !(TARGET_OS_IPHONE || TARGET_IPHONE_SIMULATOR)
@@ -5711,7 +5584,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:5715: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:5588: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_ios_target="yes"
 else
@@ -5742,18 +5615,18 @@ echo "$ac_t""$ac_cv_ios_target" 1>&6
         echo "Skipping -dead_strip because DTrace is enabled. See bug 403132."
     else
                 echo $ac_n "checking for -dead_strip option to ld""... $ac_c" 1>&6
-echo "configure:5746: checking for -dead_strip option to ld" >&5
+echo "configure:5619: checking for -dead_strip option to ld" >&5
         _SAVE_LDFLAGS=$LDFLAGS
         LDFLAGS="$LDFLAGS -Wl,-dead_strip"
         cat > conftest.$ac_ext <<EOF
-#line 5750 "configure"
+#line 5623 "configure"
 #include "confdefs.h"
 
 int main() {
 return 0;
 ; return 0; }
 EOF
-if { (eval echo configure:5757: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:5630: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   _HAVE_DEAD_STRIP=1
 else
@@ -6140,7 +6013,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:6144: checking for $ac_word" >&5
+echo "configure:6017: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_XZ'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -6218,18 +6091,18 @@ fi
 if test -n "$MOZ_DEBUG"; then
     if test -n "$COMPILE_ENVIRONMENT"; then
         echo $ac_n "checking for valid debug flags""... $ac_c" 1>&6
-echo "configure:6222: checking for valid debug flags" >&5
+echo "configure:6095: checking for valid debug flags" >&5
         _SAVE_CFLAGS=$CFLAGS
         CFLAGS="$CFLAGS $MOZ_DEBUG_FLAGS"
         cat > conftest.$ac_ext <<EOF
-#line 6226 "configure"
+#line 6099 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 int main() {
 printf("Hello World\n");
 ; return 0; }
 EOF
-if { (eval echo configure:6233: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6106: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   _results=yes
 else
@@ -6277,18 +6150,18 @@ fi
 if test -n "$MOZ_DEBUG"; then
     if test -n "$COMPILE_ENVIRONMENT"; then
         echo $ac_n "checking for valid debug flags""... $ac_c" 1>&6
-echo "configure:6281: checking for valid debug flags" >&5
+echo "configure:6154: checking for valid debug flags" >&5
         _SAVE_CFLAGS=$CFLAGS
         CFLAGS="$CFLAGS $MOZ_DEBUG_FLAGS"
         cat > conftest.$ac_ext <<EOF
-#line 6285 "configure"
+#line 6158 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 int main() {
 printf("Hello World\n");
 ; return 0; }
 EOF
-if { (eval echo configure:6292: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6165: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   _results=yes
 else
@@ -6437,7 +6310,7 @@ fi
 
 if test "$GNU_CC" -a "$GCC_USE_GNU_LD" -a -z "$MOZ_DISABLE_ICF" -a -z "$DEVELOPER_OPTIONS"; then
     echo $ac_n "checking whether the linker supports Identical Code Folding""... $ac_c" 1>&6
-echo "configure:6441: checking whether the linker supports Identical Code Folding" >&5
+echo "configure:6314: checking whether the linker supports Identical Code Folding" >&5
 if eval "test \"`echo '$''{'LD_SUPPORTS_ICF'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -6446,7 +6319,7 @@ else
               'int main() {return foo() - bar();}' > conftest.${ac_ext}
         # If the linker supports ICF, foo and bar symbols will have
         # the same address
-        if { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS -Wl,--icf=safe -ffunction-sections conftest.${ac_ext} $LIBS 1>&2'; { (eval echo configure:6450: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
+        if { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS -Wl,--icf=safe -ffunction-sections conftest.${ac_ext} $LIBS 1>&2'; { (eval echo configure:6323: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
            test -s conftest${ac_exeext} &&
            objdump -t conftest${ac_exeext} | awk '{a[$6] = $1} END {if (a["foo"] && (a["foo"] != a["bar"])) { exit 1 }}'; then
             LD_SUPPORTS_ICF=yes
@@ -6461,14 +6334,14 @@ echo "$ac_t""$LD_SUPPORTS_ICF" 1>&6
         _SAVE_LDFLAGS="$LDFLAGS -Wl,--icf=safe"
         LDFLAGS="$LDFLAGS -Wl,--icf=safe -Wl,--print-icf-sections"
         cat > conftest.$ac_ext <<EOF
-#line 6465 "configure"
+#line 6338 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:6472: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6345: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   LD_PRINT_ICF_SECTIONS=-Wl,--print-icf-sections
 else
@@ -6487,15 +6360,15 @@ fi
 if test "$GNU_CC" -a "$GCC_USE_GNU_LD" -a -z "$DEVELOPER_OPTIONS"; then
     if test -n "$MOZ_DEBUG_FLAGS"; then
                 echo $ac_n "checking whether removing dead symbols breaks debugging""... $ac_c" 1>&6
-echo "configure:6491: checking whether removing dead symbols breaks debugging" >&5
+echo "configure:6364: checking whether removing dead symbols breaks debugging" >&5
 if eval "test \"`echo '$''{'GC_SECTIONS_BREAKS_DEBUG_RANGES'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   echo 'int foo() {return 42;}' \
                   'int bar() {return 1;}' \
                   'int main() {return foo();}' > conftest.${ac_ext}
-            if { ac_try='${CC-cc} -o conftest.${ac_objext} $CFLAGS $MOZ_DEBUG_FLAGS -c conftest.${ac_ext} 1>&2'; { (eval echo configure:6498: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
-                { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS $MOZ_DEBUG_FLAGS -Wl,--gc-sections conftest.${ac_objext} $LIBS 1>&2'; { (eval echo configure:6499: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
+            if { ac_try='${CC-cc} -o conftest.${ac_objext} $CFLAGS $MOZ_DEBUG_FLAGS -c conftest.${ac_ext} 1>&2'; { (eval echo configure:6371: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
+                { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS $MOZ_DEBUG_FLAGS -Wl,--gc-sections conftest.${ac_objext} $LIBS 1>&2'; { (eval echo configure:6372: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
                 test -s conftest${ac_exeext} -a -s conftest.${ac_objext}; then
                  if test "`$PYTHON -m mozbuild.configure.check_debug_ranges conftest.${ac_objext} conftest.${ac_ext}`" = \
                          "`$PYTHON -m mozbuild.configure.check_debug_ranges conftest${ac_exeext} conftest.${ac_ext}`"; then
@@ -6546,18 +6419,20 @@ fi
 
 if test "$GNU_CC" -a -n "$MOZ_PIE"; then
     echo $ac_n "checking for PIE support""... $ac_c" 1>&6
-echo "configure:6550: checking for PIE support" >&5
+echo "configure:6423: checking for PIE support" >&5
+    _SAVE_CFLAGS=$CFLAGS
+    CFLAGS="$CFLAGS -fPIC"
     _SAVE_LDFLAGS=$LDFLAGS
     LDFLAGS="$LDFLAGS -pie"
     cat > conftest.$ac_ext <<EOF
-#line 6554 "configure"
+#line 6429 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:6561: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6436: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
                   MOZ_PROGRAM_LDFLAGS="$MOZ_PROGRAM_LDFLAGS -pie"
@@ -6570,6 +6445,7 @@ else
 fi
 rm -f conftest*
     LDFLAGS=$_SAVE_LDFLAGS
+    CFLAGS=$_SAVE_CFLAGS
 fi
 
 
@@ -6587,12 +6463,12 @@ fi # COMPILE_ENVIRONMENT
 
 if test -z "$SKIP_COMPILER_CHECKS"; then
 echo $ac_n "checking for working const""... $ac_c" 1>&6
-echo "configure:6591: checking for working const" >&5
+echo "configure:6467: checking for working const" >&5
 if eval "test \"`echo '$''{'ac_cv_c_const'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6596 "configure"
+#line 6472 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -6641,7 +6517,7 @@ ccp = (char const *const *) p;
 
 ; return 0; }
 EOF
-if { (eval echo configure:6645: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6521: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_c_const=yes
 else
@@ -6667,12 +6543,12 @@ fi
 
 
 echo $ac_n "checking for mode_t""... $ac_c" 1>&6
-echo "configure:6671: checking for mode_t" >&5
+echo "configure:6547: checking for mode_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_mode_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6676 "configure"
+#line 6552 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -6705,12 +6581,12 @@ fi
 
 
 echo $ac_n "checking for off_t""... $ac_c" 1>&6
-echo "configure:6709: checking for off_t" >&5
+echo "configure:6585: checking for off_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_off_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6714 "configure"
+#line 6590 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -6743,12 +6619,12 @@ fi
 
 
 echo $ac_n "checking for pid_t""... $ac_c" 1>&6
-echo "configure:6747: checking for pid_t" >&5
+echo "configure:6623: checking for pid_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_pid_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6752 "configure"
+#line 6628 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -6781,12 +6657,12 @@ fi
 
 
 echo $ac_n "checking for size_t""... $ac_c" 1>&6
-echo "configure:6785: checking for size_t" >&5
+echo "configure:6661: checking for size_t" >&5
 if eval "test \"`echo '$''{'ac_cv_type_size_t'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6790 "configure"
+#line 6666 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #if STDC_HEADERS
@@ -6849,12 +6725,12 @@ cross_compiling=$ac_cv_prog_cxx_cross
 
 if test "$GNU_CXX"; then
     echo $ac_n "checking whether 64-bits std::atomic requires -latomic""... $ac_c" 1>&6
-echo "configure:6853: checking whether 64-bits std::atomic requires -latomic" >&5
+echo "configure:6729: checking whether 64-bits std::atomic requires -latomic" >&5
 if eval "test \"`echo '$''{'ac_cv_needs_atomic'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6858 "configure"
+#line 6734 "configure"
 #include "confdefs.h"
 #include <cstdint>
              #include <atomic>
@@ -6862,7 +6738,7 @@ int main() {
  std::atomic<uint64_t> foo; foo = 1; 
 ; return 0; }
 EOF
-if { (eval echo configure:6866: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6742: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_needs_atomic=no
 else
@@ -6872,7 +6748,7 @@ else
   _SAVE_LIBS="$LIBS"
             LIBS="$LIBS -latomic"
             cat > conftest.$ac_ext <<EOF
-#line 6876 "configure"
+#line 6752 "configure"
 #include "confdefs.h"
 #include <cstdint>
                  #include <atomic>
@@ -6880,7 +6756,7 @@ int main() {
  std::atomic<uint64_t> foo; foo = 1; 
 ; return 0; }
 EOF
-if { (eval echo configure:6884: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6760: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_needs_atomic=yes
 else
@@ -6936,12 +6812,12 @@ for ac_hdr in dirent.h sys/ndir.h sys/dir.h ndir.h
 do
 ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for $ac_hdr that defines DIR""... $ac_c" 1>&6
-echo "configure:6940: checking for $ac_hdr that defines DIR" >&5
+echo "configure:6816: checking for $ac_hdr that defines DIR" >&5
 if eval "test \"`echo '$''{'ac_cv_header_dirent_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 6945 "configure"
+#line 6821 "configure"
 #include "confdefs.h"
 #include <sys/types.h>
 #include <$ac_hdr>
@@ -6949,7 +6825,7 @@ int main() {
 DIR *dirp = 0;
 ; return 0; }
 EOF
-if { (eval echo configure:6953: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6829: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_dirent_$ac_safe=yes"
 else
@@ -6977,7 +6853,7 @@ done
 # Two versions of opendir et al. are in -ldir and -lx on SCO Xenix.
 if test $ac_header_dirent = dirent.h; then
 echo $ac_n "checking for opendir in -ldir""... $ac_c" 1>&6
-echo "configure:6981: checking for opendir in -ldir" >&5
+echo "configure:6857: checking for opendir in -ldir" >&5
 ac_lib_var=`echo dir'_'opendir | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -6985,7 +6861,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-ldir  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 6989 "configure"
+#line 6865 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -6996,7 +6872,7 @@ int main() {
 opendir()
 ; return 0; }
 EOF
-if { (eval echo configure:7000: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6876: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7018,7 +6894,7 @@ fi
 
 else
 echo $ac_n "checking for opendir in -lx""... $ac_c" 1>&6
-echo "configure:7022: checking for opendir in -lx" >&5
+echo "configure:6898: checking for opendir in -lx" >&5
 ac_lib_var=`echo x'_'opendir | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7026,7 +6902,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lx  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7030 "configure"
+#line 6906 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7037,7 +6913,7 @@ int main() {
 opendir()
 ; return 0; }
 EOF
-if { (eval echo configure:7041: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:6917: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7067,12 +6943,12 @@ bitrig*|dragonfly*|freebsd*|openbsd*)
 esac
 
 echo $ac_n "checking for sockaddr_in.sin_len""... $ac_c" 1>&6
-echo "configure:7071: checking for sockaddr_in.sin_len" >&5
+echo "configure:6947: checking for sockaddr_in.sin_len" >&5
 if eval "test \"`echo '$''{'ac_cv_sockaddr_in_sin_len'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7076 "configure"
+#line 6952 "configure"
 #include "confdefs.h"
 #ifdef HAVE_SYS_TYPES_H
                                     #include <sys/types.h>
@@ -7084,7 +6960,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:7088: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:6964: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_sockaddr_in_sin_len=true
 else
@@ -7115,12 +6991,12 @@ EOF
 fi
 
 echo $ac_n "checking for sockaddr_in6.sin6_len""... $ac_c" 1>&6
-echo "configure:7119: checking for sockaddr_in6.sin6_len" >&5
+echo "configure:6995: checking for sockaddr_in6.sin6_len" >&5
 if eval "test \"`echo '$''{'ac_cv_sockaddr_in6_sin6_len'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7124 "configure"
+#line 7000 "configure"
 #include "confdefs.h"
 #ifdef HAVE_SYS_TYPES_H
                                 #include <sys/types.h>
@@ -7132,7 +7008,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:7136: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:7012: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_sockaddr_in6_sin6_len=true
 else
@@ -7156,12 +7032,12 @@ EOF
 fi
 
 echo $ac_n "checking for sockaddr.sa_len""... $ac_c" 1>&6
-echo "configure:7160: checking for sockaddr.sa_len" >&5
+echo "configure:7036: checking for sockaddr.sa_len" >&5
 if eval "test \"`echo '$''{'ac_cv_sockaddr_sa_len'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7165 "configure"
+#line 7041 "configure"
 #include "confdefs.h"
 #ifdef HAVE_SYS_TYPES_H
                                 #include <sys/types.h>
@@ -7173,7 +7049,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:7177: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:7053: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_sockaddr_sa_len=true
 else
@@ -7211,12 +7087,12 @@ fi
 if test "x$enable_dtrace" = "xyes"; then
      ac_safe=`echo "sys/sdt.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for sys/sdt.h""... $ac_c" 1>&6
-echo "configure:7215: checking for sys/sdt.h" >&5
+echo "configure:7091: checking for sys/sdt.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 7220 "configure"
+#line 7096 "configure"
 #include "confdefs.h"
 
 #include <sys/sdt.h>
@@ -7224,7 +7100,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:7228: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:7104: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -7259,7 +7135,7 @@ fi
 
 
 echo $ac_n "checking for gethostbyname_r in -lc_r""... $ac_c" 1>&6
-echo "configure:7263: checking for gethostbyname_r in -lc_r" >&5
+echo "configure:7139: checking for gethostbyname_r in -lc_r" >&5
 ac_lib_var=`echo c_r'_'gethostbyname_r | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7267,7 +7143,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lc_r  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7271 "configure"
+#line 7147 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7278,7 +7154,7 @@ int main() {
 gethostbyname_r()
 ; return 0; }
 EOF
-if { (eval echo configure:7282: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7158: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7315,14 +7191,14 @@ case $target in
 *)
     
 echo $ac_n "checking for library containing dlopen""... $ac_c" 1>&6
-echo "configure:7319: checking for library containing dlopen" >&5
+echo "configure:7195: checking for library containing dlopen" >&5
 if eval "test \"`echo '$''{'ac_cv_search_dlopen'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   ac_func_search_save_LIBS="$LIBS"
 ac_cv_search_dlopen="no"
 cat > conftest.$ac_ext <<EOF
-#line 7326 "configure"
+#line 7202 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7333,7 +7209,7 @@ int main() {
 dlopen()
 ; return 0; }
 EOF
-if { (eval echo configure:7337: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7213: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_search_dlopen="none required"
 else
@@ -7344,7 +7220,7 @@ rm -f conftest*
 test "$ac_cv_search_dlopen" = "no" && for i in dl; do
 LIBS="-l$i  $ac_func_search_save_LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7348 "configure"
+#line 7224 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7355,7 +7231,7 @@ int main() {
 dlopen()
 ; return 0; }
 EOF
-if { (eval echo configure:7359: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7235: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_search_dlopen="-l$i"
 break
@@ -7373,12 +7249,12 @@ if test "$ac_cv_search_dlopen" != "no"; then
   test "$ac_cv_search_dlopen" = "none required" || LIBS="$ac_cv_search_dlopen $LIBS"
      ac_safe=`echo "dlfcn.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for dlfcn.h""... $ac_c" 1>&6
-echo "configure:7377: checking for dlfcn.h" >&5
+echo "configure:7253: checking for dlfcn.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 7382 "configure"
+#line 7258 "configure"
 #include "confdefs.h"
 
 #include <dlfcn.h>
@@ -7386,7 +7262,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:7390: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:7266: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -7423,12 +7299,12 @@ CFLAGS="$CFLAGS -D_GNU_SOURCE"
 for ac_func in dladdr memmem
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:7427: checking for $ac_func" >&5
+echo "configure:7303: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 7432 "configure"
+#line 7308 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -7455,7 +7331,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:7459: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7335: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -7486,7 +7362,7 @@ CFLAGS="$_SAVE_CFLAGS"
 
 if test ! "$GNU_CXX"; then
     echo $ac_n "checking for demangle in -lC""... $ac_c" 1>&6
-echo "configure:7490: checking for demangle in -lC" >&5
+echo "configure:7366: checking for demangle in -lC" >&5
 ac_lib_var=`echo C'_'demangle | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7494,7 +7370,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lC  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7498 "configure"
+#line 7374 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7505,7 +7381,7 @@ int main() {
 demangle()
 ; return 0; }
 EOF
-if { (eval echo configure:7509: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7385: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7538,7 +7414,7 @@ fi
 fi
 
 echo $ac_n "checking for socket in -lsocket""... $ac_c" 1>&6
-echo "configure:7542: checking for socket in -lsocket" >&5
+echo "configure:7418: checking for socket in -lsocket" >&5
 ac_lib_var=`echo socket'_'socket | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7546,7 +7422,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lsocket  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7550 "configure"
+#line 7426 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7557,7 +7433,7 @@ int main() {
 socket()
 ; return 0; }
 EOF
-if { (eval echo configure:7561: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7437: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7603,7 +7479,7 @@ EOF
     _SAVE_LIBS="$LIBS"
     LDFLAGS="$XLDFLAGS $LDFLAGS"
     echo $ac_n "checking for XDrawLines in -lX11""... $ac_c" 1>&6
-echo "configure:7607: checking for XDrawLines in -lX11" >&5
+echo "configure:7483: checking for XDrawLines in -lX11" >&5
 ac_lib_var=`echo X11'_'XDrawLines | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7611,7 +7487,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lX11 $XLIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7615 "configure"
+#line 7491 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7622,7 +7498,7 @@ int main() {
 XDrawLines()
 ; return 0; }
 EOF
-if { (eval echo configure:7626: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7502: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7644,7 +7520,7 @@ MISSING_X="$MISSING_X -lX11"
 fi
 
     echo $ac_n "checking for XextAddDisplay in -lXext""... $ac_c" 1>&6
-echo "configure:7648: checking for XextAddDisplay in -lXext" >&5
+echo "configure:7524: checking for XextAddDisplay in -lXext" >&5
 ac_lib_var=`echo Xext'_'XextAddDisplay | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7652,7 +7528,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXext $XLIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7656 "configure"
+#line 7532 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7663,7 +7539,7 @@ int main() {
 XextAddDisplay()
 ; return 0; }
 EOF
-if { (eval echo configure:7667: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7543: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7686,7 +7562,7 @@ fi
 
 
     echo $ac_n "checking for XtFree in -lXt""... $ac_c" 1>&6
-echo "configure:7690: checking for XtFree in -lXt" >&5
+echo "configure:7566: checking for XtFree in -lXt" >&5
 ac_lib_var=`echo Xt'_'XtFree | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7694,7 +7570,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXt  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7698 "configure"
+#line 7574 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7705,7 +7581,7 @@ int main() {
 XtFree()
 ; return 0; }
 EOF
-if { (eval echo configure:7709: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7585: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7726,7 +7602,7 @@ else
 
         unset ac_cv_lib_Xt_XtFree
         echo $ac_n "checking for IceFlush in -lICE""... $ac_c" 1>&6
-echo "configure:7730: checking for IceFlush in -lICE" >&5
+echo "configure:7606: checking for IceFlush in -lICE" >&5
 ac_lib_var=`echo ICE'_'IceFlush | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7734,7 +7610,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lICE $XT_LIBS $XLIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7738 "configure"
+#line 7614 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7745,7 +7621,7 @@ int main() {
 IceFlush()
 ; return 0; }
 EOF
-if { (eval echo configure:7749: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7625: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7766,7 +7642,7 @@ else
 fi
 
         echo $ac_n "checking for SmcCloseConnection in -lSM""... $ac_c" 1>&6
-echo "configure:7770: checking for SmcCloseConnection in -lSM" >&5
+echo "configure:7646: checking for SmcCloseConnection in -lSM" >&5
 ac_lib_var=`echo SM'_'SmcCloseConnection | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7774,7 +7650,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lSM $XT_LIBS $XLIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7778 "configure"
+#line 7654 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7785,7 +7661,7 @@ int main() {
 SmcCloseConnection()
 ; return 0; }
 EOF
-if { (eval echo configure:7789: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7665: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7806,7 +7682,7 @@ else
 fi
 
         echo $ac_n "checking for XtFree in -lXt""... $ac_c" 1>&6
-echo "configure:7810: checking for XtFree in -lXt" >&5
+echo "configure:7686: checking for XtFree in -lXt" >&5
 ac_lib_var=`echo Xt'_'XtFree | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7814,7 +7690,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXt $X_PRE_LIBS $XT_LIBS $XLIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7818 "configure"
+#line 7694 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7825,7 +7701,7 @@ int main() {
 XtFree()
 ; return 0; }
 EOF
-if { (eval echo configure:7829: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7705: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7851,7 +7727,7 @@ fi
 
 
                 echo $ac_n "checking for xcb_connect in -lxcb""... $ac_c" 1>&6
-echo "configure:7855: checking for xcb_connect in -lxcb" >&5
+echo "configure:7731: checking for xcb_connect in -lxcb" >&5
 ac_lib_var=`echo xcb'_'xcb_connect | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7859,7 +7735,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lxcb $XLIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7863 "configure"
+#line 7739 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7870,7 +7746,7 @@ int main() {
 xcb_connect()
 ; return 0; }
 EOF
-if { (eval echo configure:7874: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7750: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7892,7 +7768,7 @@ MISSING_X="$MISSING_X -lxcb"
 fi
 
     echo $ac_n "checking for xcb_shm_query_version in -lxcb-shm""... $ac_c" 1>&6
-echo "configure:7896: checking for xcb_shm_query_version in -lxcb-shm" >&5
+echo "configure:7772: checking for xcb_shm_query_version in -lxcb-shm" >&5
 ac_lib_var=`echo xcb-shm'_'xcb_shm_query_version | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7900,7 +7776,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lxcb-shm $XLIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7904 "configure"
+#line 7780 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7911,7 +7787,7 @@ int main() {
 xcb_shm_query_version()
 ; return 0; }
 EOF
-if { (eval echo configure:7915: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7791: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7933,7 +7809,7 @@ MISSING_X="$MISSING_X -lxcb-shm"
 fi
 
     echo $ac_n "checking for XGetXCBConnection in -lX11-xcb""... $ac_c" 1>&6
-echo "configure:7937: checking for XGetXCBConnection in -lX11-xcb" >&5
+echo "configure:7813: checking for XGetXCBConnection in -lX11-xcb" >&5
 ac_lib_var=`echo X11-xcb'_'XGetXCBConnection | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -7941,7 +7817,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lX11-xcb $XLIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 7945 "configure"
+#line 7821 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -7952,7 +7828,7 @@ int main() {
 XGetXCBConnection()
 ; return 0; }
 EOF
-if { (eval echo configure:7956: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7832: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -7976,12 +7852,12 @@ fi
 
                    ac_safe=`echo "X11/extensions/scrnsaver.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for X11/extensions/scrnsaver.h""... $ac_c" 1>&6
-echo "configure:7980: checking for X11/extensions/scrnsaver.h" >&5
+echo "configure:7856: checking for X11/extensions/scrnsaver.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 7985 "configure"
+#line 7861 "configure"
 #include "confdefs.h"
 
 #include <X11/extensions/scrnsaver.h>
@@ -7989,7 +7865,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:7993: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:7869: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -8004,7 +7880,7 @@ fi
   if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
     echo "$ac_t""yes" 1>&6
     echo $ac_n "checking for XScreenSaverQueryInfo in -lXss""... $ac_c" 1>&6
-echo "configure:8008: checking for XScreenSaverQueryInfo in -lXss" >&5
+echo "configure:7884: checking for XScreenSaverQueryInfo in -lXss" >&5
 ac_lib_var=`echo Xss'_'XScreenSaverQueryInfo | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -8012,7 +7888,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lXss $XEXT_LIBS $XLIBS $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8016 "configure"
+#line 7892 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -8023,7 +7899,7 @@ int main() {
 XScreenSaverQueryInfo()
 ; return 0; }
 EOF
-if { (eval echo configure:8027: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7903: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8073,7 +7949,7 @@ darwin*)
     ;;
 *)
     echo $ac_n "checking for pthread_create in -lpthreads""... $ac_c" 1>&6
-echo "configure:8077: checking for pthread_create in -lpthreads" >&5
+echo "configure:7953: checking for pthread_create in -lpthreads" >&5
 ac_lib_var=`echo pthreads'_'pthread_create | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -8081,7 +7957,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lpthreads  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8085 "configure"
+#line 7961 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -8092,7 +7968,7 @@ int main() {
 pthread_create()
 ; return 0; }
 EOF
-if { (eval echo configure:8096: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:7972: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8111,7 +7987,7 @@ if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
 else
   echo "$ac_t""no" 1>&6
 echo $ac_n "checking for pthread_create in -lpthread""... $ac_c" 1>&6
-echo "configure:8115: checking for pthread_create in -lpthread" >&5
+echo "configure:7991: checking for pthread_create in -lpthread" >&5
 ac_lib_var=`echo pthread'_'pthread_create | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -8119,7 +7995,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lpthread  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8123 "configure"
+#line 7999 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -8130,7 +8006,7 @@ int main() {
 pthread_create()
 ; return 0; }
 EOF
-if { (eval echo configure:8134: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8010: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8149,7 +8025,7 @@ if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
 else
   echo "$ac_t""no" 1>&6
 echo $ac_n "checking for pthread_create in -lc_r""... $ac_c" 1>&6
-echo "configure:8153: checking for pthread_create in -lc_r" >&5
+echo "configure:8029: checking for pthread_create in -lc_r" >&5
 ac_lib_var=`echo c_r'_'pthread_create | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -8157,7 +8033,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lc_r  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8161 "configure"
+#line 8037 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -8168,7 +8044,7 @@ int main() {
 pthread_create()
 ; return 0; }
 EOF
-if { (eval echo configure:8172: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8048: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8187,7 +8063,7 @@ if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
 else
   echo "$ac_t""no" 1>&6
 echo $ac_n "checking for pthread_create in -lc""... $ac_c" 1>&6
-echo "configure:8191: checking for pthread_create in -lc" >&5
+echo "configure:8067: checking for pthread_create in -lc" >&5
 ac_lib_var=`echo c'_'pthread_create | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -8195,7 +8071,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lc  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8199 "configure"
+#line 8075 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -8206,7 +8082,7 @@ int main() {
 pthread_create()
 ; return 0; }
 EOF
-if { (eval echo configure:8210: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8086: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8261,7 +8137,7 @@ then
                 rm -f conftest*
     ac_cv_have_dash_pthread=no
     echo $ac_n "checking whether ${CC-cc} accepts -pthread""... $ac_c" 1>&6
-echo "configure:8265: checking whether ${CC-cc} accepts -pthread" >&5
+echo "configure:8141: checking whether ${CC-cc} accepts -pthread" >&5
     echo 'int main() { return 0; }' | cat > conftest.c
     ${CC-cc} -pthread -o conftest conftest.c > conftest.out 2>&1
     if test $? -eq 0; then
@@ -8284,7 +8160,7 @@ echo "configure:8265: checking whether ${CC-cc} accepts -pthread" >&5
                 ac_cv_have_dash_pthreads=no
     if test "$ac_cv_have_dash_pthread" = "no"; then
         echo $ac_n "checking whether ${CC-cc} accepts -pthreads""... $ac_c" 1>&6
-echo "configure:8288: checking whether ${CC-cc} accepts -pthreads" >&5
+echo "configure:8164: checking whether ${CC-cc} accepts -pthreads" >&5
         echo 'int main() { return 0; }' | cat > conftest.c
         ${CC-cc} -pthreads -o conftest conftest.c > conftest.out 2>&1
         if test $? -eq 0; then
@@ -8356,12 +8232,12 @@ EOF
   do
        ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:8360: checking for $ac_hdr" >&5
+echo "configure:8236: checking for $ac_hdr" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 8365 "configure"
+#line 8241 "configure"
 #include "confdefs.h"
 
 #include <$ac_hdr>
@@ -8369,7 +8245,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:8373: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:8249: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -8406,13 +8282,13 @@ fi
 
 if test $ac_cv_prog_gcc = yes; then
     echo $ac_n "checking whether ${CC-cc} needs -traditional""... $ac_c" 1>&6
-echo "configure:8410: checking whether ${CC-cc} needs -traditional" >&5
+echo "configure:8286: checking whether ${CC-cc} needs -traditional" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_gcc_traditional'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
     ac_pattern="Autoconf.*'x'"
   cat > conftest.$ac_ext <<EOF
-#line 8416 "configure"
+#line 8292 "configure"
 #include "confdefs.h"
 #include <sgtty.h>
 Autoconf TIOCGETP
@@ -8430,7 +8306,7 @@ rm -f conftest*
 
   if test $ac_cv_prog_gcc_traditional = no; then
     cat > conftest.$ac_ext <<EOF
-#line 8434 "configure"
+#line 8310 "configure"
 #include "confdefs.h"
 #include <termio.h>
 Autoconf TCGETA
@@ -8452,7 +8328,7 @@ echo "$ac_t""$ac_cv_prog_gcc_traditional" 1>&6
 fi
 
 echo $ac_n "checking for 8-bit clean memcmp""... $ac_c" 1>&6
-echo "configure:8456: checking for 8-bit clean memcmp" >&5
+echo "configure:8332: checking for 8-bit clean memcmp" >&5
 if eval "test \"`echo '$''{'ac_cv_func_memcmp_clean'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -8460,7 +8336,7 @@ else
   ac_cv_func_memcmp_clean=no
 else
   cat > conftest.$ac_ext <<EOF
-#line 8464 "configure"
+#line 8340 "configure"
 #include "confdefs.h"
 
 main()
@@ -8470,7 +8346,7 @@ main()
 }
 
 EOF
-if { (eval echo configure:8474: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:8350: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_func_memcmp_clean=yes
 else
@@ -8490,12 +8366,12 @@ test $ac_cv_func_memcmp_clean = no && LIBOBJS="$LIBOBJS memcmp.${ac_objext}"
 for ac_func in stat64 lstat64 truncate64 statvfs64 statvfs statfs64 statfs getpagesize gmtime_r localtime_r arc4random arc4random_buf mallinfo gettid lchown setpriority strerror syscall
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:8494: checking for $ac_func" >&5
+echo "configure:8370: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 8499 "configure"
+#line 8375 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -8522,7 +8398,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:8526: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8402: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -8555,7 +8431,7 @@ Darwin)
   ;;
 *)
   echo $ac_n "checking for clock_gettime(CLOCK_MONOTONIC)""... $ac_c" 1>&6
-echo "configure:8559: checking for clock_gettime(CLOCK_MONOTONIC)" >&5
+echo "configure:8435: checking for clock_gettime(CLOCK_MONOTONIC)" >&5
 if eval "test \"`echo '$''{'ac_cv_clock_monotonic'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -8563,7 +8439,7 @@ else
                       _SAVE_LIBS="$LIBS"
                       LIBS="$LIBS $libs"
                       cat > conftest.$ac_ext <<EOF
-#line 8567 "configure"
+#line 8443 "configure"
 #include "confdefs.h"
 #include <time.h>
 int main() {
@@ -8571,7 +8447,7 @@ int main() {
                                      clock_gettime(CLOCK_MONOTONIC, &ts); 
 ; return 0; }
 EOF
-if { (eval echo configure:8575: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8451: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_clock_monotonic=$libs
                                    LIBS="$_SAVE_LIBS"
@@ -8605,19 +8481,19 @@ EOF
 esac
 
 echo $ac_n "checking for pthread_cond_timedwait_monotonic_np""... $ac_c" 1>&6
-echo "configure:8609: checking for pthread_cond_timedwait_monotonic_np" >&5
+echo "configure:8485: checking for pthread_cond_timedwait_monotonic_np" >&5
 if eval "test \"`echo '$''{'ac_cv_pthread_cond_timedwait_monotonic_np'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 8614 "configure"
+#line 8490 "configure"
 #include "confdefs.h"
 #include <pthread.h>
 int main() {
 pthread_cond_timedwait_monotonic_np(0, 0, 0);
 ; return 0; }
 EOF
-if { (eval echo configure:8621: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8497: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_pthread_cond_timewait_monotonic_np=yes
 else
@@ -8650,19 +8526,19 @@ ac_link='${CXX-g++} -o conftest${ac_exeext} $CXXFLAGS $CPPFLAGS $LDFLAGS conftes
 cross_compiling=$ac_cv_prog_cxx_cross
 
 echo $ac_n "checking for wcrtomb""... $ac_c" 1>&6
-echo "configure:8654: checking for wcrtomb" >&5
+echo "configure:8530: checking for wcrtomb" >&5
 if eval "test \"`echo '$''{'ac_cv_have_wcrtomb'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 8659 "configure"
+#line 8535 "configure"
 #include "confdefs.h"
 #include <wchar.h>
 int main() {
 mbstate_t ps={0};wcrtomb(0,'f',&ps);
 ; return 0; }
 EOF
-if { (eval echo configure:8666: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8542: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_have_wcrtomb="yes"
 else
@@ -8685,19 +8561,19 @@ EOF
 
 fi
 echo $ac_n "checking for mbrtowc""... $ac_c" 1>&6
-echo "configure:8689: checking for mbrtowc" >&5
+echo "configure:8565: checking for mbrtowc" >&5
 if eval "test \"`echo '$''{'ac_cv_have_mbrtowc'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 8694 "configure"
+#line 8570 "configure"
 #include "confdefs.h"
 #include <wchar.h>
 int main() {
 mbstate_t ps={0};mbrtowc(0,0,0,&ps);
 ; return 0; }
 EOF
-if { (eval echo configure:8701: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8577: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_have_mbrtowc="yes"
 else
@@ -8729,7 +8605,7 @@ cross_compiling=$ac_cv_prog_cc_cross
 fi
 
 echo $ac_n "checking for res_ninit()""... $ac_c" 1>&6
-echo "configure:8733: checking for res_ninit()" >&5
+echo "configure:8609: checking for res_ninit()" >&5
 if eval "test \"`echo '$''{'ac_cv_func_res_ninit'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -8737,7 +8613,7 @@ else
                 ac_cv_func_res_ninit=no
      else
         cat > conftest.$ac_ext <<EOF
-#line 8741 "configure"
+#line 8617 "configure"
 #include "confdefs.h"
 
             #ifdef linux
@@ -8752,7 +8628,7 @@ int main() {
 int foo = res_ninit(&_res);
 ; return 0; }
 EOF
-if { (eval echo configure:8756: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8632: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_func_res_ninit=yes
 else
@@ -8794,7 +8670,7 @@ case $target_os in
     *)
 
 echo $ac_n "checking for iconv in -lc""... $ac_c" 1>&6
-echo "configure:8798: checking for iconv in -lc" >&5
+echo "configure:8674: checking for iconv in -lc" >&5
 ac_lib_var=`echo c'_'iconv | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -8802,7 +8678,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lc  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8806 "configure"
+#line 8682 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -8816,7 +8692,7 @@ int main() {
 iconv()
 ; return 0; }
 EOF
-if { (eval echo configure:8820: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8696: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8835,7 +8711,7 @@ if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
 else
   echo "$ac_t""no" 1>&6
 echo $ac_n "checking for iconv in -liconv""... $ac_c" 1>&6
-echo "configure:8839: checking for iconv in -liconv" >&5
+echo "configure:8715: checking for iconv in -liconv" >&5
 ac_lib_var=`echo iconv'_'iconv | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -8843,7 +8719,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-liconv  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8847 "configure"
+#line 8723 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -8857,7 +8733,7 @@ int main() {
 iconv()
 ; return 0; }
 EOF
-if { (eval echo configure:8861: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8737: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8876,7 +8752,7 @@ if eval "test \"`echo '$ac_cv_lib_'$ac_lib_var`\" = yes"; then
 else
   echo "$ac_t""no" 1>&6
 echo $ac_n "checking for libiconv in -liconv""... $ac_c" 1>&6
-echo "configure:8880: checking for libiconv in -liconv" >&5
+echo "configure:8756: checking for libiconv in -liconv" >&5
 ac_lib_var=`echo iconv'_'libiconv | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -8884,7 +8760,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-liconv  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 8888 "configure"
+#line 8764 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 #ifdef __cplusplus
@@ -8898,7 +8774,7 @@ int main() {
 libiconv()
 ; return 0; }
 EOF
-if { (eval echo configure:8902: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8778: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -8925,12 +8801,12 @@ fi
 _SAVE_LIBS=$LIBS
 LIBS="$LIBS $ICONV_LIBS"
 echo $ac_n "checking for iconv()""... $ac_c" 1>&6
-echo "configure:8929: checking for iconv()" >&5
+echo "configure:8805: checking for iconv()" >&5
 if eval "test \"`echo '$''{'ac_cv_func_iconv'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 8934 "configure"
+#line 8810 "configure"
 #include "confdefs.h"
 
         #include <stdlib.h>
@@ -8944,7 +8820,7 @@ int main() {
         
 ; return 0; }
 EOF
-if { (eval echo configure:8948: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8824: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_func_iconv=yes
 else
@@ -8969,12 +8845,12 @@ EOF
 
     LIBICONV="$ICONV_LIBS"
     echo $ac_n "checking for iconv() with const input""... $ac_c" 1>&6
-echo "configure:8973: checking for iconv() with const input" >&5
+echo "configure:8849: checking for iconv() with const input" >&5
 if eval "test \"`echo '$''{'ac_cv_func_const_iconv'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 8978 "configure"
+#line 8854 "configure"
 #include "confdefs.h"
 
             #include <stdlib.h>
@@ -8989,7 +8865,7 @@ int main() {
             
 ; return 0; }
 EOF
-if { (eval echo configure:8993: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:8869: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_func_const_iconv=yes
 else
@@ -9023,19 +8899,19 @@ esac
 
 
   echo $ac_n "checking for nl_langinfo and CODESET""... $ac_c" 1>&6
-echo "configure:9027: checking for nl_langinfo and CODESET" >&5
+echo "configure:8903: checking for nl_langinfo and CODESET" >&5
 if eval "test \"`echo '$''{'am_cv_langinfo_codeset'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 9032 "configure"
+#line 8908 "configure"
 #include "confdefs.h"
 #include <langinfo.h>
 int main() {
 char* cs = nl_langinfo(CODESET);
 ; return 0; }
 EOF
-if { (eval echo configure:9039: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:8915: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   am_cv_langinfo_codeset=yes
 else
@@ -9071,12 +8947,12 @@ cross_compiling=$ac_cv_prog_cc_cross
 
 
 echo $ac_n "checking for an implementation of va_copy()""... $ac_c" 1>&6
-echo "configure:9075: checking for an implementation of va_copy()" >&5
+echo "configure:8951: checking for an implementation of va_copy()" >&5
 if eval "test \"`echo '$''{'ac_cv_va_copy'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 9080 "configure"
+#line 8956 "configure"
 #include "confdefs.h"
 #include <stdarg.h>
                      #include <stdlib.h>
@@ -9092,7 +8968,7 @@ int main() {
 f(0, 42); return 0
 ; return 0; }
 EOF
-if { (eval echo configure:9096: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:8972: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_va_copy=yes
 else
@@ -9108,12 +8984,12 @@ fi
 
 echo "$ac_t""$ac_cv_va_copy" 1>&6
 echo $ac_n "checking whether va_list can be copied by value""... $ac_c" 1>&6
-echo "configure:9112: checking whether va_list can be copied by value" >&5
+echo "configure:8988: checking whether va_list can be copied by value" >&5
 if eval "test \"`echo '$''{'ac_cv_va_val_copy'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 9117 "configure"
+#line 8993 "configure"
 #include "confdefs.h"
 #include <stdarg.h>
                      #include <stdlib.h>
@@ -9129,7 +9005,7 @@ int main() {
 f(0, 42); return 0
 ; return 0; }
 EOF
-if { (eval echo configure:9133: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:9009: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_va_val_copy=yes
 else
@@ -9182,12 +9058,12 @@ ARM_ABI_PREFIX=
 if test "$GNU_CC"; then
   if test "$CPU_ARCH" = "arm" ; then
     echo $ac_n "checking for ARM EABI""... $ac_c" 1>&6
-echo "configure:9186: checking for ARM EABI" >&5
+echo "configure:9062: checking for ARM EABI" >&5
 if eval "test \"`echo '$''{'ac_cv_gcc_arm_eabi'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 9191 "configure"
+#line 9067 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -9200,7 +9076,7 @@ int main() {
                         
 ; return 0; }
 EOF
-if { (eval echo configure:9204: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:9080: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_gcc_arm_eabi="yes"
 else
@@ -9225,7 +9101,7 @@ echo "$ac_t""$ac_cv_gcc_arm_eabi" 1>&6
 fi
 
 echo $ac_n "checking for C++ dynamic_cast to void*""... $ac_c" 1>&6
-echo "configure:9229: checking for C++ dynamic_cast to void*" >&5
+echo "configure:9105: checking for C++ dynamic_cast to void*" >&5
 if eval "test \"`echo '$''{'ac_cv_cpp_dynamic_cast_void_ptr'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -9233,8 +9109,11 @@ else
   ac_cv_cpp_dynamic_cast_void_ptr=no
 else
   cat > conftest.$ac_ext <<EOF
-#line 9237 "configure"
+#line 9113 "configure"
 #include "confdefs.h"
+#ifdef __cplusplus
+extern "C" void exit(int);
+#endif
 class X { int i; public: virtual ~X() { } };
                             class Y { int j; public: virtual ~Y() { } };
                             class Z : public X, public Y { int k; };
@@ -9249,7 +9128,7 @@ class X { int i; public: virtual ~X() { } };
                                            ((void*)&mdo == dynamic_cast<void*>(suby))));
                             }
 EOF
-if { (eval echo configure:9253: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:9132: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_cpp_dynamic_cast_void_ptr=yes
 else
@@ -9282,19 +9161,19 @@ fi
 _SAVE_LDFLAGS=$LDFLAGS
 LDFLAGS="$LDFLAGS $DSO_PIC_CFLAGS $DSO_LDOPTS $MOZ_OPTIMIZE_LDFLAGS"
 echo $ac_n "checking for __thread keyword for TLS variables""... $ac_c" 1>&6
-echo "configure:9286: checking for __thread keyword for TLS variables" >&5
+echo "configure:9165: checking for __thread keyword for TLS variables" >&5
 if eval "test \"`echo '$''{'ac_cv_thread_keyword'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 9291 "configure"
+#line 9170 "configure"
 #include "confdefs.h"
 __thread bool tlsIsMainThread = false;
 int main() {
 return tlsIsMainThread;
 ; return 0; }
 EOF
-if { (eval echo configure:9298: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:9177: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   ac_cv_thread_keyword=yes
 else
@@ -9350,12 +9229,12 @@ fi
 
 if test -n "$MOZ_LINKER" -a "$OS_TARGET" = "Android"; then
   echo $ac_n "checking whether the CRT objects have text relocations""... $ac_c" 1>&6
-echo "configure:9354: checking whether the CRT objects have text relocations" >&5
+echo "configure:9233: checking whether the CRT objects have text relocations" >&5
 if eval "test \"`echo '$''{'ac_cv_crt_has_text_relocations'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   echo 'int foo() { return 0; }' > conftest.cpp
-     if { ac_try='${CXX-g++} -o conftest${DLL_SUFFIX} $CXXFLAGS $DSO_LDOPTS $LDFLAGS conftest.cpp $LIBS 1>&5'; { (eval echo configure:9359: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
+     if { ac_try='${CXX-g++} -o conftest${DLL_SUFFIX} $CXXFLAGS $DSO_LDOPTS $LDFLAGS conftest.cpp $LIBS 1>&5'; { (eval echo configure:9238: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
         test -s conftest${DLL_SUFFIX}; then
        if ${TOOLCHAIN_PREFIX}readelf -d conftest${DLL_SUFFIX} | grep TEXTREL > /dev/null; then
          ac_cv_crt_has_text_relocations=yes
@@ -9385,19 +9264,19 @@ cross_compiling=$ac_cv_prog_cc_cross
 
 
 echo $ac_n "checking for LC_MESSAGES""... $ac_c" 1>&6
-echo "configure:9389: checking for LC_MESSAGES" >&5
+echo "configure:9268: checking for LC_MESSAGES" >&5
 if eval "test \"`echo '$''{'ac_cv_i18n_lc_messages'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 9394 "configure"
+#line 9273 "configure"
 #include "confdefs.h"
 #include <locale.h>
 int main() {
 int category = LC_MESSAGES;
 ; return 0; }
 EOF
-if { (eval echo configure:9401: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:9280: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_i18n_lc_messages=yes
 else
@@ -9423,12 +9302,12 @@ fi
 for ac_func in localeconv
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:9427: checking for $ac_func" >&5
+echo "configure:9306: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 9432 "configure"
+#line 9311 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -9455,7 +9334,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:9459: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:9338: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -9496,12 +9375,12 @@ MALLOC_H=
 for file in $MALLOC_HEADERS; do
      ac_safe=`echo "$file" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for $file""... $ac_c" 1>&6
-echo "configure:9500: checking for $file" >&5
+echo "configure:9379: checking for $file" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 9505 "configure"
+#line 9384 "configure"
 #include "confdefs.h"
 
 #include <$file>
@@ -9509,7 +9388,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:9513: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:9392: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -9544,12 +9423,12 @@ done
 for ac_func in strndup posix_memalign memalign
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:9548: checking for $ac_func" >&5
+echo "configure:9427: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 9553 "configure"
+#line 9432 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -9576,7 +9455,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:9580: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:9459: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -9607,12 +9486,12 @@ done
 for ac_func in malloc_usable_size
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:9611: checking for $ac_func" >&5
+echo "configure:9490: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 9616 "configure"
+#line 9495 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -9639,7 +9518,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:9643: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:9522: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -9669,9 +9548,9 @@ done
 MALLOC_USABLE_SIZE_CONST_PTR=const
 if test -n "$HAVE_MALLOC_H"; then
   echo $ac_n "checking whether malloc_usable_size definition can use const argument""... $ac_c" 1>&6
-echo "configure:9673: checking whether malloc_usable_size definition can use const argument" >&5
+echo "configure:9552: checking whether malloc_usable_size definition can use const argument" >&5
   cat > conftest.$ac_ext <<EOF
-#line 9675 "configure"
+#line 9554 "configure"
 #include "confdefs.h"
 #include <malloc.h>
                   #include <stddef.h>
@@ -9680,7 +9559,7 @@ int main() {
 return malloc_usable_size(0);
 ; return 0; }
 EOF
-if { (eval echo configure:9684: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:9563: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
 else
@@ -9702,9 +9581,9 @@ EOF
 
 
 echo $ac_n "checking for valloc in malloc.h""... $ac_c" 1>&6
-echo "configure:9706: checking for valloc in malloc.h" >&5
+echo "configure:9585: checking for valloc in malloc.h" >&5
 cat > conftest.$ac_ext <<EOF
-#line 9708 "configure"
+#line 9587 "configure"
 #include "confdefs.h"
 #include <malloc.h>
 EOF
@@ -9727,9 +9606,9 @@ rm -f conftest*
 
 
 echo $ac_n "checking for valloc in unistd.h""... $ac_c" 1>&6
-echo "configure:9731: checking for valloc in unistd.h" >&5
+echo "configure:9610: checking for valloc in unistd.h" >&5
 cat > conftest.$ac_ext <<EOF
-#line 9733 "configure"
+#line 9612 "configure"
 #include "confdefs.h"
 #include <unistd.h>
 EOF
@@ -9882,7 +9761,7 @@ fi
 
 
 echo $ac_n "checking NSPR selection""... $ac_c" 1>&6
-echo "configure:9886: checking NSPR selection" >&5
+echo "configure:9765: checking NSPR selection" >&5
 nspr_opts=
 which_nspr=default
 if test -n "$_USE_SYSTEM_NSPR"; then
@@ -9982,7 +9861,7 @@ fi
 	# Extract the first word of "nspr-config", so it can be a program name with args.
 set dummy nspr-config; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:9986: checking for $ac_word" >&5
+echo "configure:9865: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_NSPR_CONFIG'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -10017,7 +9896,7 @@ fi
 
 	min_nspr_version=$NSPR_MINVER
 	echo $ac_n "checking for NSPR - version >= $min_nspr_version""... $ac_c" 1>&6
-echo "configure:10021: checking for NSPR - version >= $min_nspr_version" >&5
+echo "configure:9900: checking for NSPR - version >= $min_nspr_version" >&5
 
 	no_nspr=""
 	if test "$NSPR_CONFIG" != "no"; then
@@ -10084,7 +9963,7 @@ if test -n "$MOZ_SYSTEM_NSPR" -o -n "$NSPR_CFLAGS" -o -n "$NSPR_LIBS"; then
     _SAVE_CFLAGS=$CFLAGS
     CFLAGS="$CFLAGS $NSPR_CFLAGS"
     cat > conftest.$ac_ext <<EOF
-#line 10088 "configure"
+#line 9967 "configure"
 #include "confdefs.h"
 #include "prtypes.h"
 int main() {
@@ -10093,7 +9972,7 @@ int main() {
                  #endif
 ; return 0; }
 EOF
-if { (eval echo configure:10097: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:9976: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
@@ -10103,7 +9982,7 @@ else
 fi
 rm -f conftest*
     cat > conftest.$ac_ext <<EOF
-#line 10107 "configure"
+#line 9986 "configure"
 #include "confdefs.h"
 #include "prtypes.h"
 int main() {
@@ -10112,7 +9991,7 @@ int main() {
                  #endif
 ; return 0; }
 EOF
-if { (eval echo configure:10116: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:9995: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
@@ -10153,7 +10032,7 @@ if test -n "$MOZ_SYSTEM_NSPR"; then
     _SAVE_CFLAGS=$CFLAGS
     CFLAGS="$CFLAGS $NSPR_CFLAGS"
     cat > conftest.$ac_ext <<EOF
-#line 10157 "configure"
+#line 10036 "configure"
 #include "confdefs.h"
 #include "prlog.h"
 int main() {
@@ -10162,7 +10041,7 @@ int main() {
                  #endif
 ; return 0; }
 EOF
-if { (eval echo configure:10166: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:10045: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
@@ -10201,19 +10080,19 @@ if test "$LIBEVENT_DIR" = yes; then
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for libevent""... $ac_c" 1>&6
-echo "configure:10205: checking for libevent" >&5
+echo "configure:10084: checking for libevent" >&5
 
         if $PKG_CONFIG --exists "libevent" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_LIBEVENT_CFLAGS""... $ac_c" 1>&6
-echo "configure:10212: checking MOZ_LIBEVENT_CFLAGS" >&5
+echo "configure:10091: checking MOZ_LIBEVENT_CFLAGS" >&5
             MOZ_LIBEVENT_CFLAGS=`$PKG_CONFIG --cflags "libevent"`
             echo "$ac_t""$MOZ_LIBEVENT_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_LIBEVENT_LIBS""... $ac_c" 1>&6
-echo "configure:10217: checking MOZ_LIBEVENT_LIBS" >&5
+echo "configure:10096: checking MOZ_LIBEVENT_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_LIBEVENT_LIBS="`$PKG_CONFIG --libs \"libevent\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_LIBEVENT_LIBS" 1>&6
@@ -10250,12 +10129,12 @@ elif test -z "$MOZ_SYSTEM_LIBEVENT"; then
     LDFLAGS="-L${LIBEVENT_DIR}/lib $LDFLAGS"
        ac_safe=`echo "event.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for event.h""... $ac_c" 1>&6
-echo "configure:10254: checking for event.h" >&5
+echo "configure:10133: checking for event.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 10259 "configure"
+#line 10138 "configure"
 #include "confdefs.h"
 
 #include <event.h>
@@ -10263,7 +10142,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:10267: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:10146: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -10286,7 +10165,7 @@ fi
   fi
 
     echo $ac_n "checking for event_init in -levent""... $ac_c" 1>&6
-echo "configure:10290: checking for event_init in -levent" >&5
+echo "configure:10169: checking for event_init in -levent" >&5
 ac_lib_var=`echo event'_'event_init | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -10294,7 +10173,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-levent  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 10298 "configure"
+#line 10177 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -10305,7 +10184,7 @@ int main() {
 event_init()
 ; return 0; }
 EOF
-if { (eval echo configure:10309: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:10188: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -10386,7 +10265,7 @@ fi
 	# Extract the first word of "nss-config", so it can be a program name with args.
 set dummy nss-config; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:10390: checking for $ac_word" >&5
+echo "configure:10269: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_NSS_CONFIG'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -10421,7 +10300,7 @@ fi
 
 	min_nss_version=3.29.5
 	echo $ac_n "checking for NSS - version >= $min_nss_version""... $ac_c" 1>&6
-echo "configure:10425: checking for NSS - version >= $min_nss_version" >&5
+echo "configure:10304: checking for NSS - version >= $min_nss_version" >&5
 
 	no_nss=""
 	if test "$NSS_CONFIG" = "no"; then
@@ -10510,7 +10389,7 @@ if test -z "$JPEG_DIR" -o "$JPEG_DIR" = no; then
     MOZ_SYSTEM_JPEG=
 else
     echo $ac_n "checking for jpeg_destroy_compress in -ljpeg""... $ac_c" 1>&6
-echo "configure:10514: checking for jpeg_destroy_compress in -ljpeg" >&5
+echo "configure:10393: checking for jpeg_destroy_compress in -ljpeg" >&5
 ac_lib_var=`echo jpeg'_'jpeg_destroy_compress | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -10518,7 +10397,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-ljpeg  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 10522 "configure"
+#line 10401 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -10529,7 +10408,7 @@ int main() {
 jpeg_destroy_compress()
 ; return 0; }
 EOF
-if { (eval echo configure:10533: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:10412: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -10554,7 +10433,7 @@ fi
 
 if test "$MOZ_SYSTEM_JPEG" = 1; then
     cat > conftest.$ac_ext <<EOF
-#line 10558 "configure"
+#line 10437 "configure"
 #include "confdefs.h"
  #include <stdio.h>
                      #include <sys/types.h>
@@ -10569,7 +10448,7 @@ int main() {
                      
 ; return 0; }
 EOF
-if { (eval echo configure:10573: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:10452: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   MOZ_SYSTEM_JPEG=1
 else
@@ -10616,7 +10495,7 @@ if test -z "$MOZ_ZLIB_LIBS$MOZ_ZLIB_CFLAGS$SKIP_LIBRARY_CHECKS"; then
         MOZ_SYSTEM_ZLIB=
     else
         echo $ac_n "checking for gzread in -lz""... $ac_c" 1>&6
-echo "configure:10620: checking for gzread in -lz" >&5
+echo "configure:10499: checking for gzread in -lz" >&5
 ac_lib_var=`echo z'_'gzread | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -10624,7 +10503,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lz  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 10628 "configure"
+#line 10507 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -10635,7 +10514,7 @@ int main() {
 gzread()
 ; return 0; }
 EOF
-if { (eval echo configure:10639: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:10518: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -10659,7 +10538,7 @@ fi
         if test "$MOZ_SYSTEM_ZLIB" = 1; then
             MOZZLIBNUM=`echo $MOZZLIB | awk -F. '{printf "0x%x\n", ((($1 * 16 + $2) * 16) + $3) * 16 + $4}'`
             cat > conftest.$ac_ext <<EOF
-#line 10663 "configure"
+#line 10542 "configure"
 #include "confdefs.h"
  #include <stdio.h>
                              #include <string.h>
@@ -10670,7 +10549,7 @@ int main() {
                              #endif 
 ; return 0; }
 EOF
-if { (eval echo configure:10674: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:10553: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   MOZ_SYSTEM_ZLIB=1
 else
@@ -10716,7 +10595,7 @@ if test -z "$BZ2_DIR" -o "$BZ2_DIR" = no; then
     MOZ_SYSTEM_BZ2=
 else
     echo $ac_n "checking for BZ2_bzread in -lbz2""... $ac_c" 1>&6
-echo "configure:10720: checking for BZ2_bzread in -lbz2" >&5
+echo "configure:10599: checking for BZ2_bzread in -lbz2" >&5
 ac_lib_var=`echo bz2'_'BZ2_bzread | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -10724,7 +10603,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lbz2  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 10728 "configure"
+#line 10607 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -10735,7 +10614,7 @@ int main() {
 BZ2_bzread()
 ; return 0; }
 EOF
-if { (eval echo configure:10739: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:10618: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -10784,7 +10663,7 @@ if test -z "$PNG_DIR" -o "$PNG_DIR" = no; then
     MOZ_SYSTEM_PNG=
 else
     echo $ac_n "checking for png_get_valid in -lpng""... $ac_c" 1>&6
-echo "configure:10788: checking for png_get_valid in -lpng" >&5
+echo "configure:10667: checking for png_get_valid in -lpng" >&5
 ac_lib_var=`echo png'_'png_get_valid | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -10792,7 +10671,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lpng  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 10796 "configure"
+#line 10675 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -10803,7 +10682,7 @@ int main() {
 png_get_valid()
 ; return 0; }
 EOF
-if { (eval echo configure:10807: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:10686: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -10825,7 +10704,7 @@ else
 fi
 
     echo $ac_n "checking for png_get_acTL in -lpng""... $ac_c" 1>&6
-echo "configure:10829: checking for png_get_acTL in -lpng" >&5
+echo "configure:10708: checking for png_get_acTL in -lpng" >&5
 ac_lib_var=`echo png'_'png_get_acTL | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -10833,7 +10712,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lpng  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 10837 "configure"
+#line 10716 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -10844,7 +10723,7 @@ int main() {
 png_get_acTL()
 ; return 0; }
 EOF
-if { (eval echo configure:10848: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:10727: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -10878,7 +10757,7 @@ fi
 fi
 if test "$MOZ_SYSTEM_PNG" = 1; then
     cat > conftest.$ac_ext <<EOF
-#line 10882 "configure"
+#line 10761 "configure"
 #include "confdefs.h"
  #include <stdio.h>
                      #include <sys/types.h>
@@ -10892,7 +10771,7 @@ int main() {
                      #endif 
 ; return 0; }
 EOF
-if { (eval echo configure:10896: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:10775: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   MOZ_SYSTEM_PNG=1
 else
@@ -11025,7 +10904,7 @@ fi
 
 # Allow the application to influence configure with a confvars.sh script.
 echo $ac_n "checking if app-specific confvars.sh exists""... $ac_c" 1>&6
-echo "configure:11029: checking if app-specific confvars.sh exists" >&5
+echo "configure:10908: checking if app-specific confvars.sh exists" >&5
 if test -f "${srcdir}/${MOZ_BUILD_APP}/confvars.sh" ; then
   echo "$ac_t""${srcdir}/${MOZ_BUILD_APP}/confvars.sh" 1>&6
   . "${srcdir}/${MOZ_BUILD_APP}/confvars.sh"
@@ -11190,7 +11069,7 @@ case "$target" in
 
     android_target_sdk=23
     echo $ac_n "checking for Android SDK platform version $android_target_sdk""... $ac_c" 1>&6
-echo "configure:11194: checking for Android SDK platform version $android_target_sdk" >&5
+echo "configure:11073: checking for Android SDK platform version $android_target_sdk" >&5
     android_sdk=$android_sdk_root/platforms/android-$android_target_sdk
     if ! test -e "$android_sdk/source.properties" ; then
         { echo "configure: error: You must download Android SDK platform version $android_target_sdk.  Try |mach bootstrap|.  (Looked for $android_sdk)" 1>&2; echo "configure: error: You must download Android SDK platform version $android_target_sdk.  Try |mach bootstrap|.  (Looked for $android_sdk)" 1>&5; exit 1; }
@@ -11198,7 +11077,7 @@ echo "configure:11194: checking for Android SDK platform version $android_target
     echo "$ac_t""$android_sdk" 1>&6
 
     echo $ac_n "checking for Android build-tools""... $ac_c" 1>&6
-echo "configure:11202: checking for Android build-tools" >&5
+echo "configure:11081: checking for Android build-tools" >&5
     android_build_tools_base="$android_sdk_root"/build-tools
     android_build_tools_version=""
     for version in 23.0.3 23.0.1; do
@@ -11217,7 +11096,7 @@ echo "configure:11202: checking for Android build-tools" >&5
      # Extract the first word of "zipalign", so it can be a program name with args.
 set dummy zipalign; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:11221: checking for $ac_word" >&5
+echo "configure:11100: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_ZIPALIGN'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -11266,7 +11145,7 @@ fi
      # Extract the first word of "dx", so it can be a program name with args.
 set dummy dx; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:11270: checking for $ac_word" >&5
+echo "configure:11149: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_DX'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -11315,7 +11194,7 @@ fi
      # Extract the first word of "aapt", so it can be a program name with args.
 set dummy aapt; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:11319: checking for $ac_word" >&5
+echo "configure:11198: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_AAPT'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -11364,7 +11243,7 @@ fi
      # Extract the first word of "aidl", so it can be a program name with args.
 set dummy aidl; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:11368: checking for $ac_word" >&5
+echo "configure:11247: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_AIDL'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -11425,7 +11304,7 @@ fi
 
     android_platform_tools="$android_sdk_root"/platform-tools
     echo $ac_n "checking for Android platform-tools""... $ac_c" 1>&6
-echo "configure:11429: checking for Android platform-tools" >&5
+echo "configure:11308: checking for Android platform-tools" >&5
     if test -d "$android_platform_tools" -a -f "$android_platform_tools/adb"; then
         echo "$ac_t""$android_platform_tools" 1>&6
     else
@@ -11435,7 +11314,7 @@ echo "configure:11429: checking for Android platform-tools" >&5
      # Extract the first word of "adb", so it can be a program name with args.
 set dummy adb; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:11439: checking for $ac_word" >&5
+echo "configure:11318: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_ADB'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -11487,7 +11366,7 @@ fi
 
     android_tools="$android_sdk_root"/tools
     echo $ac_n "checking for Android tools""... $ac_c" 1>&6
-echo "configure:11491: checking for Android tools" >&5
+echo "configure:11370: checking for Android tools" >&5
     if test -d "$android_tools" -a -f "$android_tools/emulator"; then
         echo "$ac_t""$android_tools" 1>&6
     else
@@ -11497,7 +11376,7 @@ echo "configure:11491: checking for Android tools" >&5
      # Extract the first word of "emulator", so it can be a program name with args.
 set dummy emulator; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:11501: checking for $ac_word" >&5
+echo "configure:11380: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_path_EMULATOR'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -11570,7 +11449,7 @@ EOF
   
   ANDROID_CUSTOMTABS_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/customtabs/$ANDROID_SUPPORT_LIBRARY_VERSION/customtabs-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for customtabs AAR""... $ac_c" 1>&6
-echo "configure:11574: checking for customtabs AAR" >&5
+echo "configure:11453: checking for customtabs AAR" >&5
   if ! test -e "$ANDROID_CUSTOMTABS_AAR" ; then
     { echo "configure: error: You must download the customtabs AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_CUSTOMTABS_AAR)" 1>&2; echo "configure: error: You must download the customtabs AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_CUSTOMTABS_AAR)" 1>&5; exit 1; }
   fi
@@ -11585,7 +11464,7 @@ echo "configure:11574: checking for customtabs AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_CUSTOMTABS_AAR_LIB""... $ac_c" 1>&6
-echo "configure:11589: checking for ANDROID_CUSTOMTABS_AAR_LIB" >&5
+echo "configure:11468: checking for ANDROID_CUSTOMTABS_AAR_LIB" >&5
     ANDROID_CUSTOMTABS_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/customtabs-$ANDROID_SUPPORT_LIBRARY_VERSION/customtabs-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_CUSTOMTABS_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_CUSTOMTABS_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_CUSTOMTABS_AAR_LIB!" 1>&5; exit 1; }
@@ -11597,7 +11476,7 @@ echo "configure:11589: checking for ANDROID_CUSTOMTABS_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_CUSTOMTABS_AAR_RES""... $ac_c" 1>&6
-echo "configure:11601: checking for ANDROID_CUSTOMTABS_AAR_RES" >&5
+echo "configure:11480: checking for ANDROID_CUSTOMTABS_AAR_RES" >&5
     ANDROID_CUSTOMTABS_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/customtabs-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_CUSTOMTABS_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_CUSTOMTABS_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_CUSTOMTABS_AAR_RES!" 1>&5; exit 1; }
@@ -11626,7 +11505,7 @@ echo "configure:11601: checking for ANDROID_CUSTOMTABS_AAR_RES" >&5
   
   ANDROID_APPCOMPAT_V7_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/appcompat-v7/$ANDROID_SUPPORT_LIBRARY_VERSION/appcompat-v7-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for appcompat-v7 AAR""... $ac_c" 1>&6
-echo "configure:11630: checking for appcompat-v7 AAR" >&5
+echo "configure:11509: checking for appcompat-v7 AAR" >&5
   if ! test -e "$ANDROID_APPCOMPAT_V7_AAR" ; then
     { echo "configure: error: You must download the appcompat-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_APPCOMPAT_V7_AAR)" 1>&2; echo "configure: error: You must download the appcompat-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_APPCOMPAT_V7_AAR)" 1>&5; exit 1; }
   fi
@@ -11641,7 +11520,7 @@ echo "configure:11630: checking for appcompat-v7 AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_APPCOMPAT_V7_AAR_LIB""... $ac_c" 1>&6
-echo "configure:11645: checking for ANDROID_APPCOMPAT_V7_AAR_LIB" >&5
+echo "configure:11524: checking for ANDROID_APPCOMPAT_V7_AAR_LIB" >&5
     ANDROID_APPCOMPAT_V7_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/appcompat-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/appcompat-v7-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_APPCOMPAT_V7_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_APPCOMPAT_V7_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_APPCOMPAT_V7_AAR_LIB!" 1>&5; exit 1; }
@@ -11653,7 +11532,7 @@ echo "configure:11645: checking for ANDROID_APPCOMPAT_V7_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_APPCOMPAT_V7_AAR_RES""... $ac_c" 1>&6
-echo "configure:11657: checking for ANDROID_APPCOMPAT_V7_AAR_RES" >&5
+echo "configure:11536: checking for ANDROID_APPCOMPAT_V7_AAR_RES" >&5
     ANDROID_APPCOMPAT_V7_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/appcompat-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_APPCOMPAT_V7_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_APPCOMPAT_V7_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_APPCOMPAT_V7_AAR_RES!" 1>&5; exit 1; }
@@ -11682,7 +11561,7 @@ echo "configure:11657: checking for ANDROID_APPCOMPAT_V7_AAR_RES" >&5
   
   ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/support-vector-drawable/$ANDROID_SUPPORT_LIBRARY_VERSION/support-vector-drawable-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for support-vector-drawable AAR""... $ac_c" 1>&6
-echo "configure:11686: checking for support-vector-drawable AAR" >&5
+echo "configure:11565: checking for support-vector-drawable AAR" >&5
   if ! test -e "$ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR" ; then
     { echo "configure: error: You must download the support-vector-drawable AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR)" 1>&2; echo "configure: error: You must download the support-vector-drawable AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR)" 1>&5; exit 1; }
   fi
@@ -11697,7 +11576,7 @@ echo "configure:11686: checking for support-vector-drawable AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_LIB""... $ac_c" 1>&6
-echo "configure:11701: checking for ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_LIB" >&5
+echo "configure:11580: checking for ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_LIB" >&5
     ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/support-vector-drawable-$ANDROID_SUPPORT_LIBRARY_VERSION/support-vector-drawable-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_LIB!" 1>&5; exit 1; }
@@ -11709,7 +11588,7 @@ echo "configure:11701: checking for ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_RES""... $ac_c" 1>&6
-echo "configure:11713: checking for ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_RES" >&5
+echo "configure:11592: checking for ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_RES" >&5
     ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/support-vector-drawable-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_RES!" 1>&5; exit 1; }
@@ -11738,7 +11617,7 @@ echo "configure:11713: checking for ANDROID_SUPPORT_VECTOR_DRAWABLE_AAR_RES" >&5
   
   ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/animated-vector-drawable/$ANDROID_SUPPORT_LIBRARY_VERSION/animated-vector-drawable-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for animated-vector-drawable AAR""... $ac_c" 1>&6
-echo "configure:11742: checking for animated-vector-drawable AAR" >&5
+echo "configure:11621: checking for animated-vector-drawable AAR" >&5
   if ! test -e "$ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR" ; then
     { echo "configure: error: You must download the animated-vector-drawable AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR)" 1>&2; echo "configure: error: You must download the animated-vector-drawable AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR)" 1>&5; exit 1; }
   fi
@@ -11753,7 +11632,7 @@ echo "configure:11742: checking for animated-vector-drawable AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_LIB""... $ac_c" 1>&6
-echo "configure:11757: checking for ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_LIB" >&5
+echo "configure:11636: checking for ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_LIB" >&5
     ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/animated-vector-drawable-$ANDROID_SUPPORT_LIBRARY_VERSION/animated-vector-drawable-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_LIB!" 1>&5; exit 1; }
@@ -11765,7 +11644,7 @@ echo "configure:11757: checking for ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_LIB" >&
   
   
     echo $ac_n "checking for ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_RES""... $ac_c" 1>&6
-echo "configure:11769: checking for ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_RES" >&5
+echo "configure:11648: checking for ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_RES" >&5
     ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/animated-vector-drawable-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_RES!" 1>&5; exit 1; }
@@ -11794,7 +11673,7 @@ echo "configure:11769: checking for ANDROID_ANIMATED_VECTOR_DRAWABLE_AAR_RES" >&
   
   ANDROID_CARDVIEW_V7_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/cardview-v7/$ANDROID_SUPPORT_LIBRARY_VERSION/cardview-v7-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for cardview-v7 AAR""... $ac_c" 1>&6
-echo "configure:11798: checking for cardview-v7 AAR" >&5
+echo "configure:11677: checking for cardview-v7 AAR" >&5
   if ! test -e "$ANDROID_CARDVIEW_V7_AAR" ; then
     { echo "configure: error: You must download the cardview-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_CARDVIEW_V7_AAR)" 1>&2; echo "configure: error: You must download the cardview-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_CARDVIEW_V7_AAR)" 1>&5; exit 1; }
   fi
@@ -11809,7 +11688,7 @@ echo "configure:11798: checking for cardview-v7 AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_CARDVIEW_V7_AAR_LIB""... $ac_c" 1>&6
-echo "configure:11813: checking for ANDROID_CARDVIEW_V7_AAR_LIB" >&5
+echo "configure:11692: checking for ANDROID_CARDVIEW_V7_AAR_LIB" >&5
     ANDROID_CARDVIEW_V7_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/cardview-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/cardview-v7-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_CARDVIEW_V7_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_CARDVIEW_V7_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_CARDVIEW_V7_AAR_LIB!" 1>&5; exit 1; }
@@ -11821,7 +11700,7 @@ echo "configure:11813: checking for ANDROID_CARDVIEW_V7_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_CARDVIEW_V7_AAR_RES""... $ac_c" 1>&6
-echo "configure:11825: checking for ANDROID_CARDVIEW_V7_AAR_RES" >&5
+echo "configure:11704: checking for ANDROID_CARDVIEW_V7_AAR_RES" >&5
     ANDROID_CARDVIEW_V7_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/cardview-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_CARDVIEW_V7_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_CARDVIEW_V7_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_CARDVIEW_V7_AAR_RES!" 1>&5; exit 1; }
@@ -11850,7 +11729,7 @@ echo "configure:11825: checking for ANDROID_CARDVIEW_V7_AAR_RES" >&5
   
   ANDROID_DESIGN_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/design/$ANDROID_SUPPORT_LIBRARY_VERSION/design-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for design AAR""... $ac_c" 1>&6
-echo "configure:11854: checking for design AAR" >&5
+echo "configure:11733: checking for design AAR" >&5
   if ! test -e "$ANDROID_DESIGN_AAR" ; then
     { echo "configure: error: You must download the design AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_DESIGN_AAR)" 1>&2; echo "configure: error: You must download the design AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_DESIGN_AAR)" 1>&5; exit 1; }
   fi
@@ -11865,7 +11744,7 @@ echo "configure:11854: checking for design AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_DESIGN_AAR_LIB""... $ac_c" 1>&6
-echo "configure:11869: checking for ANDROID_DESIGN_AAR_LIB" >&5
+echo "configure:11748: checking for ANDROID_DESIGN_AAR_LIB" >&5
     ANDROID_DESIGN_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/design-$ANDROID_SUPPORT_LIBRARY_VERSION/design-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_DESIGN_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_DESIGN_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_DESIGN_AAR_LIB!" 1>&5; exit 1; }
@@ -11877,7 +11756,7 @@ echo "configure:11869: checking for ANDROID_DESIGN_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_DESIGN_AAR_RES""... $ac_c" 1>&6
-echo "configure:11881: checking for ANDROID_DESIGN_AAR_RES" >&5
+echo "configure:11760: checking for ANDROID_DESIGN_AAR_RES" >&5
     ANDROID_DESIGN_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/design-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_DESIGN_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_DESIGN_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_DESIGN_AAR_RES!" 1>&5; exit 1; }
@@ -11906,7 +11785,7 @@ echo "configure:11881: checking for ANDROID_DESIGN_AAR_RES" >&5
   
   ANDROID_RECYCLERVIEW_V7_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/recyclerview-v7/$ANDROID_SUPPORT_LIBRARY_VERSION/recyclerview-v7-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for recyclerview-v7 AAR""... $ac_c" 1>&6
-echo "configure:11910: checking for recyclerview-v7 AAR" >&5
+echo "configure:11789: checking for recyclerview-v7 AAR" >&5
   if ! test -e "$ANDROID_RECYCLERVIEW_V7_AAR" ; then
     { echo "configure: error: You must download the recyclerview-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_RECYCLERVIEW_V7_AAR)" 1>&2; echo "configure: error: You must download the recyclerview-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_RECYCLERVIEW_V7_AAR)" 1>&5; exit 1; }
   fi
@@ -11921,7 +11800,7 @@ echo "configure:11910: checking for recyclerview-v7 AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_RECYCLERVIEW_V7_AAR_LIB""... $ac_c" 1>&6
-echo "configure:11925: checking for ANDROID_RECYCLERVIEW_V7_AAR_LIB" >&5
+echo "configure:11804: checking for ANDROID_RECYCLERVIEW_V7_AAR_LIB" >&5
     ANDROID_RECYCLERVIEW_V7_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/recyclerview-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/recyclerview-v7-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_RECYCLERVIEW_V7_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_RECYCLERVIEW_V7_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_RECYCLERVIEW_V7_AAR_LIB!" 1>&5; exit 1; }
@@ -11933,7 +11812,7 @@ echo "configure:11925: checking for ANDROID_RECYCLERVIEW_V7_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_RECYCLERVIEW_V7_AAR_RES""... $ac_c" 1>&6
-echo "configure:11937: checking for ANDROID_RECYCLERVIEW_V7_AAR_RES" >&5
+echo "configure:11816: checking for ANDROID_RECYCLERVIEW_V7_AAR_RES" >&5
     ANDROID_RECYCLERVIEW_V7_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/recyclerview-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_RECYCLERVIEW_V7_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_RECYCLERVIEW_V7_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_RECYCLERVIEW_V7_AAR_RES!" 1>&5; exit 1; }
@@ -11962,7 +11841,7 @@ echo "configure:11937: checking for ANDROID_RECYCLERVIEW_V7_AAR_RES" >&5
   
   ANDROID_SUPPORT_V4_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/support-v4/$ANDROID_SUPPORT_LIBRARY_VERSION/support-v4-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for support-v4 AAR""... $ac_c" 1>&6
-echo "configure:11966: checking for support-v4 AAR" >&5
+echo "configure:11845: checking for support-v4 AAR" >&5
   if ! test -e "$ANDROID_SUPPORT_V4_AAR" ; then
     { echo "configure: error: You must download the support-v4 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_SUPPORT_V4_AAR)" 1>&2; echo "configure: error: You must download the support-v4 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_SUPPORT_V4_AAR)" 1>&5; exit 1; }
   fi
@@ -11977,7 +11856,7 @@ echo "configure:11966: checking for support-v4 AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_SUPPORT_V4_AAR_LIB""... $ac_c" 1>&6
-echo "configure:11981: checking for ANDROID_SUPPORT_V4_AAR_LIB" >&5
+echo "configure:11860: checking for ANDROID_SUPPORT_V4_AAR_LIB" >&5
     ANDROID_SUPPORT_V4_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/support-v4-$ANDROID_SUPPORT_LIBRARY_VERSION/support-v4-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_SUPPORT_V4_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_SUPPORT_V4_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_SUPPORT_V4_AAR_LIB!" 1>&5; exit 1; }
@@ -11989,7 +11868,7 @@ echo "configure:11981: checking for ANDROID_SUPPORT_V4_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_SUPPORT_V4_AAR_RES""... $ac_c" 1>&6
-echo "configure:11993: checking for ANDROID_SUPPORT_V4_AAR_RES" >&5
+echo "configure:11872: checking for ANDROID_SUPPORT_V4_AAR_RES" >&5
     ANDROID_SUPPORT_V4_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/support-v4-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_SUPPORT_V4_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_SUPPORT_V4_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_SUPPORT_V4_AAR_RES!" 1>&5; exit 1; }
@@ -12001,7 +11880,7 @@ echo "configure:11993: checking for ANDROID_SUPPORT_V4_AAR_RES" >&5
   
   
     echo $ac_n "checking for ANDROID_SUPPORT_V4_AAR_INTERNAL_LIB""... $ac_c" 1>&6
-echo "configure:12005: checking for ANDROID_SUPPORT_V4_AAR_INTERNAL_LIB" >&5
+echo "configure:11884: checking for ANDROID_SUPPORT_V4_AAR_INTERNAL_LIB" >&5
     ANDROID_SUPPORT_V4_AAR_INTERNAL_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/support-v4-$ANDROID_SUPPORT_LIBRARY_VERSION/libs/support-v4-$ANDROID_SUPPORT_LIBRARY_VERSION-internal_impl-$ANDROID_SUPPORT_LIBRARY_VERSION.jar"
     if ! test -e "$ANDROID_SUPPORT_V4_AAR_INTERNAL_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_SUPPORT_V4_AAR_INTERNAL_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_SUPPORT_V4_AAR_INTERNAL_LIB!" 1>&5; exit 1; }
@@ -12023,7 +11902,7 @@ echo "configure:12005: checking for ANDROID_SUPPORT_V4_AAR_INTERNAL_LIB" >&5
   
   ANDROID_PALETTE_V7_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/palette-v7/$ANDROID_SUPPORT_LIBRARY_VERSION/palette-v7-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for palette-v7 AAR""... $ac_c" 1>&6
-echo "configure:12027: checking for palette-v7 AAR" >&5
+echo "configure:11906: checking for palette-v7 AAR" >&5
   if ! test -e "$ANDROID_PALETTE_V7_AAR" ; then
     { echo "configure: error: You must download the palette-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PALETTE_V7_AAR)" 1>&2; echo "configure: error: You must download the palette-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PALETTE_V7_AAR)" 1>&5; exit 1; }
   fi
@@ -12038,7 +11917,7 @@ echo "configure:12027: checking for palette-v7 AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PALETTE_V7_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12042: checking for ANDROID_PALETTE_V7_AAR_LIB" >&5
+echo "configure:11921: checking for ANDROID_PALETTE_V7_AAR_LIB" >&5
     ANDROID_PALETTE_V7_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/palette-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/palette-v7-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_PALETTE_V7_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PALETTE_V7_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PALETTE_V7_AAR_LIB!" 1>&5; exit 1; }
@@ -12050,7 +11929,7 @@ echo "configure:12042: checking for ANDROID_PALETTE_V7_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_PALETTE_V7_AAR_RES""... $ac_c" 1>&6
-echo "configure:12054: checking for ANDROID_PALETTE_V7_AAR_RES" >&5
+echo "configure:11933: checking for ANDROID_PALETTE_V7_AAR_RES" >&5
     ANDROID_PALETTE_V7_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/palette-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_PALETTE_V7_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PALETTE_V7_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PALETTE_V7_AAR_RES!" 1>&5; exit 1; }
@@ -12077,7 +11956,7 @@ echo "configure:12054: checking for ANDROID_PALETTE_V7_AAR_RES" >&5
 
     ANDROID_SUPPORT_ANNOTATIONS_JAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/support-annotations/$ANDROID_SUPPORT_LIBRARY_VERSION/support-annotations-$ANDROID_SUPPORT_LIBRARY_VERSION.jar"
     echo $ac_n "checking for support-annotations JAR""... $ac_c" 1>&6
-echo "configure:12081: checking for support-annotations JAR" >&5
+echo "configure:11960: checking for support-annotations JAR" >&5
     if ! test -e $ANDROID_SUPPORT_ANNOTATIONS_JAR ; then
         { echo "configure: error: You must download the support-annotations lib.  Run the Android SDK tool and install the Android Support Repository under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (looked for $ANDROID_SUPPORT_ANNOTATIONS_JAR)" 1>&2; echo "configure: error: You must download the support-annotations lib.  Run the Android SDK tool and install the Android Support Repository under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (looked for $ANDROID_SUPPORT_ANNOTATIONS_JAR)" 1>&5; exit 1; }
     fi
@@ -12187,19 +12066,19 @@ if test "$COMPILE_ENVIRONMENT"; then
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for gtk+-3.0 >= $GTK3_VERSION gtk+-unix-print-3.0 glib-2.0 gobject-2.0 $GDK_PACKAGES""... $ac_c" 1>&6
-echo "configure:12191: checking for gtk+-3.0 >= $GTK3_VERSION gtk+-unix-print-3.0 glib-2.0 gobject-2.0 $GDK_PACKAGES" >&5
+echo "configure:12070: checking for gtk+-3.0 >= $GTK3_VERSION gtk+-unix-print-3.0 glib-2.0 gobject-2.0 $GDK_PACKAGES" >&5
 
         if $PKG_CONFIG --exists "gtk+-3.0 >= $GTK3_VERSION gtk+-unix-print-3.0 glib-2.0 gobject-2.0 $GDK_PACKAGES" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_GTK3_CFLAGS""... $ac_c" 1>&6
-echo "configure:12198: checking MOZ_GTK3_CFLAGS" >&5
+echo "configure:12077: checking MOZ_GTK3_CFLAGS" >&5
             MOZ_GTK3_CFLAGS=`$PKG_CONFIG --cflags "gtk+-3.0 >= $GTK3_VERSION gtk+-unix-print-3.0 glib-2.0 gobject-2.0 $GDK_PACKAGES"`
             echo "$ac_t""$MOZ_GTK3_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_GTK3_LIBS""... $ac_c" 1>&6
-echo "configure:12203: checking MOZ_GTK3_LIBS" >&5
+echo "configure:12082: checking MOZ_GTK3_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_GTK3_LIBS="`$PKG_CONFIG --libs \"gtk+-3.0 >= $GTK3_VERSION gtk+-unix-print-3.0 glib-2.0 gobject-2.0 $GDK_PACKAGES\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_GTK3_LIBS" 1>&6
@@ -12262,59 +12141,6 @@ cat >> confdefs.h <<EOF
 EOF
 
 
-    succeeded=no
-
-  if test -z "$PKG_CONFIG"; then
-     echo "*** The pkg-config script could not be found. Make sure it is"
-     echo "*** in your path, or set the PKG_CONFIG environment variable"
-     echo "*** to the full path to pkg-config."
-     echo "*** Or see http://www.freedesktop.org/software/pkgconfig to get pkg-config."
-  else
-     PKG_CONFIG_MIN_VERSION=0.9.0
-     if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
-        echo $ac_n "checking for gtk+-2.0 >= $GTK2_VERSION gtk+-unix-print-2.0 glib-2.0 >= $GLIB_VERSION gobject-2.0 $GDK_PACKAGES""... $ac_c" 1>&6
-echo "configure:12277: checking for gtk+-2.0 >= $GTK2_VERSION gtk+-unix-print-2.0 glib-2.0 >= $GLIB_VERSION gobject-2.0 $GDK_PACKAGES" >&5
-
-        if $PKG_CONFIG --exists "gtk+-2.0 >= $GTK2_VERSION gtk+-unix-print-2.0 glib-2.0 >= $GLIB_VERSION gobject-2.0 $GDK_PACKAGES" ; then
-            echo "$ac_t""yes" 1>&6
-            succeeded=yes
-
-            echo $ac_n "checking MOZ_GTK2_CFLAGS""... $ac_c" 1>&6
-echo "configure:12284: checking MOZ_GTK2_CFLAGS" >&5
-            MOZ_GTK2_CFLAGS=`$PKG_CONFIG --cflags "gtk+-2.0 >= $GTK2_VERSION gtk+-unix-print-2.0 glib-2.0 >= $GLIB_VERSION gobject-2.0 $GDK_PACKAGES"`
-            echo "$ac_t""$MOZ_GTK2_CFLAGS" 1>&6
-
-            echo $ac_n "checking MOZ_GTK2_LIBS""... $ac_c" 1>&6
-echo "configure:12289: checking MOZ_GTK2_LIBS" >&5
-            ## Remove evil flags like -Wl,--export-dynamic
-            MOZ_GTK2_LIBS="`$PKG_CONFIG --libs \"gtk+-2.0 >= $GTK2_VERSION gtk+-unix-print-2.0 glib-2.0 >= $GLIB_VERSION gobject-2.0 $GDK_PACKAGES\" |sed s/-Wl,--export-dynamic//g`"
-            echo "$ac_t""$MOZ_GTK2_LIBS" 1>&6
-        else
-            MOZ_GTK2_CFLAGS=""
-            MOZ_GTK2_LIBS=""
-            ## If we have a custom action on failure, don't print errors, but 
-            ## do set a variable so people can do so.
-            MOZ_GTK2_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "gtk+-2.0 >= $GTK2_VERSION gtk+-unix-print-2.0 glib-2.0 >= $GLIB_VERSION gobject-2.0 $GDK_PACKAGES"`
-            echo $MOZ_GTK2_PKG_ERRORS
-        fi
-
-        
-        
-     else
-        echo "*** Your version of pkg-config is too old. You need version $PKG_CONFIG_MIN_VERSION or newer."
-        echo "*** See http://www.freedesktop.org/software/pkgconfig"
-     fi
-  fi
-
-  if test $succeeded = yes; then
-     :
-  else
-     if test "$COMPILE_ENVIRONMENT"; then 
-       { echo "configure: error: Library requirements (gtk+-2.0 >= $GTK2_VERSION gtk+-unix-print-2.0 glib-2.0 >= $GLIB_VERSION gobject-2.0 $GDK_PACKAGES) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." 1>&2; echo "configure: error: Library requirements (gtk+-2.0 >= $GTK2_VERSION gtk+-unix-print-2.0 glib-2.0 >= $GLIB_VERSION gobject-2.0 $GDK_PACKAGES) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." 1>&5; exit 1; }
-     fi
-  fi
-
-    MOZ_GTK2_CFLAGS="-I${_topsrcdir}/widget/gtk/compat $MOZ_GTK2_CFLAGS"
   fi
   if test "$MOZ_WIDGET_TOOLKIT" = gtk2; then
     TK_CFLAGS=$MOZ_GTK2_CFLAGS
@@ -12354,19 +12180,19 @@ fi
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for libstartup-notification-1.0 >= $STARTUP_NOTIFICATION_VERSION""... $ac_c" 1>&6
-echo "configure:12358: checking for libstartup-notification-1.0 >= $STARTUP_NOTIFICATION_VERSION" >&5
+echo "configure:12184: checking for libstartup-notification-1.0 >= $STARTUP_NOTIFICATION_VERSION" >&5
 
         if $PKG_CONFIG --exists "libstartup-notification-1.0 >= $STARTUP_NOTIFICATION_VERSION" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_STARTUP_NOTIFICATION_CFLAGS""... $ac_c" 1>&6
-echo "configure:12365: checking MOZ_STARTUP_NOTIFICATION_CFLAGS" >&5
+echo "configure:12191: checking MOZ_STARTUP_NOTIFICATION_CFLAGS" >&5
             MOZ_STARTUP_NOTIFICATION_CFLAGS=`$PKG_CONFIG --cflags "libstartup-notification-1.0 >= $STARTUP_NOTIFICATION_VERSION"`
             echo "$ac_t""$MOZ_STARTUP_NOTIFICATION_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_STARTUP_NOTIFICATION_LIBS""... $ac_c" 1>&6
-echo "configure:12370: checking MOZ_STARTUP_NOTIFICATION_LIBS" >&5
+echo "configure:12196: checking MOZ_STARTUP_NOTIFICATION_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_STARTUP_NOTIFICATION_LIBS="`$PKG_CONFIG --libs \"libstartup-notification-1.0 >= $STARTUP_NOTIFICATION_VERSION\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_STARTUP_NOTIFICATION_LIBS" 1>&6
@@ -12502,7 +12328,7 @@ if test -n "$MOZ_NATIVE_DEVICES" ; then
   
   ANDROID_PLAY_SERVICES_BASE_AAR="$ANDROID_SDK_ROOT/extras/google/m2repository/com/google/android/gms/play-services-base/$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-base-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION.aar"
   echo $ac_n "checking for play-services-base AAR""... $ac_c" 1>&6
-echo "configure:12506: checking for play-services-base AAR" >&5
+echo "configure:12332: checking for play-services-base AAR" >&5
   if ! test -e "$ANDROID_PLAY_SERVICES_BASE_AAR" ; then
     { echo "configure: error: You must download the play-services-base AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASE_AAR)" 1>&2; echo "configure: error: You must download the play-services-base AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASE_AAR)" 1>&5; exit 1; }
   fi
@@ -12517,7 +12343,7 @@ echo "configure:12506: checking for play-services-base AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASE_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12521: checking for ANDROID_PLAY_SERVICES_BASE_AAR_LIB" >&5
+echo "configure:12347: checking for ANDROID_PLAY_SERVICES_BASE_AAR_LIB" >&5
     ANDROID_PLAY_SERVICES_BASE_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-base-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-base-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION-classes.jar"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASE_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASE_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASE_AAR_LIB!" 1>&5; exit 1; }
@@ -12529,7 +12355,7 @@ echo "configure:12521: checking for ANDROID_PLAY_SERVICES_BASE_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASE_AAR_RES""... $ac_c" 1>&6
-echo "configure:12533: checking for ANDROID_PLAY_SERVICES_BASE_AAR_RES" >&5
+echo "configure:12359: checking for ANDROID_PLAY_SERVICES_BASE_AAR_RES" >&5
     ANDROID_PLAY_SERVICES_BASE_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-base-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/res"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASE_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASE_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASE_AAR_RES!" 1>&5; exit 1; }
@@ -12558,7 +12384,7 @@ echo "configure:12533: checking for ANDROID_PLAY_SERVICES_BASE_AAR_RES" >&5
   
   ANDROID_PLAY_SERVICES_BASEMENT_AAR="$ANDROID_SDK_ROOT/extras/google/m2repository/com/google/android/gms/play-services-basement/$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION.aar"
   echo $ac_n "checking for play-services-basement AAR""... $ac_c" 1>&6
-echo "configure:12562: checking for play-services-basement AAR" >&5
+echo "configure:12388: checking for play-services-basement AAR" >&5
   if ! test -e "$ANDROID_PLAY_SERVICES_BASEMENT_AAR" ; then
     { echo "configure: error: You must download the play-services-basement AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASEMENT_AAR)" 1>&2; echo "configure: error: You must download the play-services-basement AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASEMENT_AAR)" 1>&5; exit 1; }
   fi
@@ -12573,7 +12399,7 @@ echo "configure:12562: checking for play-services-basement AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12577: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" >&5
+echo "configure:12403: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" >&5
     ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION-classes.jar"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB!" 1>&5; exit 1; }
@@ -12585,7 +12411,7 @@ echo "configure:12577: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES""... $ac_c" 1>&6
-echo "configure:12589: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" >&5
+echo "configure:12415: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" >&5
     ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/res"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES!" 1>&5; exit 1; }
@@ -12614,7 +12440,7 @@ echo "configure:12589: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" >&5
   
   ANDROID_PLAY_SERVICES_CAST_AAR="$ANDROID_SDK_ROOT/extras/google/m2repository/com/google/android/gms/play-services-cast/$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-cast-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION.aar"
   echo $ac_n "checking for play-services-cast AAR""... $ac_c" 1>&6
-echo "configure:12618: checking for play-services-cast AAR" >&5
+echo "configure:12444: checking for play-services-cast AAR" >&5
   if ! test -e "$ANDROID_PLAY_SERVICES_CAST_AAR" ; then
     { echo "configure: error: You must download the play-services-cast AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_CAST_AAR)" 1>&2; echo "configure: error: You must download the play-services-cast AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_CAST_AAR)" 1>&5; exit 1; }
   fi
@@ -12629,7 +12455,7 @@ echo "configure:12618: checking for play-services-cast AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_CAST_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12633: checking for ANDROID_PLAY_SERVICES_CAST_AAR_LIB" >&5
+echo "configure:12459: checking for ANDROID_PLAY_SERVICES_CAST_AAR_LIB" >&5
     ANDROID_PLAY_SERVICES_CAST_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-cast-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-cast-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION-classes.jar"
     if ! test -e "$ANDROID_PLAY_SERVICES_CAST_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_CAST_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_CAST_AAR_LIB!" 1>&5; exit 1; }
@@ -12641,7 +12467,7 @@ echo "configure:12633: checking for ANDROID_PLAY_SERVICES_CAST_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_CAST_AAR_RES""... $ac_c" 1>&6
-echo "configure:12645: checking for ANDROID_PLAY_SERVICES_CAST_AAR_RES" >&5
+echo "configure:12471: checking for ANDROID_PLAY_SERVICES_CAST_AAR_RES" >&5
     ANDROID_PLAY_SERVICES_CAST_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-cast-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/res"
     if ! test -e "$ANDROID_PLAY_SERVICES_CAST_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_CAST_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_CAST_AAR_RES!" 1>&5; exit 1; }
@@ -12670,7 +12496,7 @@ echo "configure:12645: checking for ANDROID_PLAY_SERVICES_CAST_AAR_RES" >&5
   
   ANDROID_MEDIAROUTER_V7_AAR="$ANDROID_SDK_ROOT/extras/android/m2repository/com/android/support/mediarouter-v7/$ANDROID_SUPPORT_LIBRARY_VERSION/mediarouter-v7-$ANDROID_SUPPORT_LIBRARY_VERSION.aar"
   echo $ac_n "checking for mediarouter-v7 AAR""... $ac_c" 1>&6
-echo "configure:12674: checking for mediarouter-v7 AAR" >&5
+echo "configure:12500: checking for mediarouter-v7 AAR" >&5
   if ! test -e "$ANDROID_MEDIAROUTER_V7_AAR" ; then
     { echo "configure: error: You must download the mediarouter-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_MEDIAROUTER_V7_AAR)" 1>&2; echo "configure: error: You must download the mediarouter-v7 AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_MEDIAROUTER_V7_AAR)" 1>&5; exit 1; }
   fi
@@ -12685,7 +12511,7 @@ echo "configure:12674: checking for mediarouter-v7 AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_MEDIAROUTER_V7_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12689: checking for ANDROID_MEDIAROUTER_V7_AAR_LIB" >&5
+echo "configure:12515: checking for ANDROID_MEDIAROUTER_V7_AAR_LIB" >&5
     ANDROID_MEDIAROUTER_V7_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/mediarouter-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/mediarouter-v7-$ANDROID_SUPPORT_LIBRARY_VERSION-classes.jar"
     if ! test -e "$ANDROID_MEDIAROUTER_V7_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_MEDIAROUTER_V7_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_MEDIAROUTER_V7_AAR_LIB!" 1>&5; exit 1; }
@@ -12697,7 +12523,7 @@ echo "configure:12689: checking for ANDROID_MEDIAROUTER_V7_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_MEDIAROUTER_V7_AAR_RES""... $ac_c" 1>&6
-echo "configure:12701: checking for ANDROID_MEDIAROUTER_V7_AAR_RES" >&5
+echo "configure:12527: checking for ANDROID_MEDIAROUTER_V7_AAR_RES" >&5
     ANDROID_MEDIAROUTER_V7_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/mediarouter-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/res"
     if ! test -e "$ANDROID_MEDIAROUTER_V7_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_MEDIAROUTER_V7_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_MEDIAROUTER_V7_AAR_RES!" 1>&5; exit 1; }
@@ -12709,7 +12535,7 @@ echo "configure:12701: checking for ANDROID_MEDIAROUTER_V7_AAR_RES" >&5
   
   
     echo $ac_n "checking for ANDROID_MEDIAROUTER_V7_AAR_INTERNAL_LIB""... $ac_c" 1>&6
-echo "configure:12713: checking for ANDROID_MEDIAROUTER_V7_AAR_INTERNAL_LIB" >&5
+echo "configure:12539: checking for ANDROID_MEDIAROUTER_V7_AAR_INTERNAL_LIB" >&5
     ANDROID_MEDIAROUTER_V7_AAR_INTERNAL_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/mediarouter-v7-$ANDROID_SUPPORT_LIBRARY_VERSION/libs/mediarouter-v7-$ANDROID_SUPPORT_LIBRARY_VERSION-internal_impl-$ANDROID_SUPPORT_LIBRARY_VERSION.jar"
     if ! test -e "$ANDROID_MEDIAROUTER_V7_AAR_INTERNAL_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_MEDIAROUTER_V7_AAR_INTERNAL_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_MEDIAROUTER_V7_AAR_INTERNAL_LIB!" 1>&5; exit 1; }
@@ -12737,7 +12563,7 @@ if test -n "$MOZ_ANDROID_GCM" ; then
   
   ANDROID_PLAY_SERVICES_BASE_AAR="$ANDROID_SDK_ROOT/extras/google/m2repository/com/google/android/gms/play-services-base/$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-base-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION.aar"
   echo $ac_n "checking for play-services-base AAR""... $ac_c" 1>&6
-echo "configure:12741: checking for play-services-base AAR" >&5
+echo "configure:12567: checking for play-services-base AAR" >&5
   if ! test -e "$ANDROID_PLAY_SERVICES_BASE_AAR" ; then
     { echo "configure: error: You must download the play-services-base AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASE_AAR)" 1>&2; echo "configure: error: You must download the play-services-base AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASE_AAR)" 1>&5; exit 1; }
   fi
@@ -12752,7 +12578,7 @@ echo "configure:12741: checking for play-services-base AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASE_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12756: checking for ANDROID_PLAY_SERVICES_BASE_AAR_LIB" >&5
+echo "configure:12582: checking for ANDROID_PLAY_SERVICES_BASE_AAR_LIB" >&5
     ANDROID_PLAY_SERVICES_BASE_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-base-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-base-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION-classes.jar"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASE_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASE_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASE_AAR_LIB!" 1>&5; exit 1; }
@@ -12764,7 +12590,7 @@ echo "configure:12756: checking for ANDROID_PLAY_SERVICES_BASE_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASE_AAR_RES""... $ac_c" 1>&6
-echo "configure:12768: checking for ANDROID_PLAY_SERVICES_BASE_AAR_RES" >&5
+echo "configure:12594: checking for ANDROID_PLAY_SERVICES_BASE_AAR_RES" >&5
     ANDROID_PLAY_SERVICES_BASE_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-base-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/res"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASE_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASE_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASE_AAR_RES!" 1>&5; exit 1; }
@@ -12793,7 +12619,7 @@ echo "configure:12768: checking for ANDROID_PLAY_SERVICES_BASE_AAR_RES" >&5
   
   ANDROID_PLAY_SERVICES_BASEMENT_AAR="$ANDROID_SDK_ROOT/extras/google/m2repository/com/google/android/gms/play-services-basement/$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION.aar"
   echo $ac_n "checking for play-services-basement AAR""... $ac_c" 1>&6
-echo "configure:12797: checking for play-services-basement AAR" >&5
+echo "configure:12623: checking for play-services-basement AAR" >&5
   if ! test -e "$ANDROID_PLAY_SERVICES_BASEMENT_AAR" ; then
     { echo "configure: error: You must download the play-services-basement AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASEMENT_AAR)" 1>&2; echo "configure: error: You must download the play-services-basement AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASEMENT_AAR)" 1>&5; exit 1; }
   fi
@@ -12808,7 +12634,7 @@ echo "configure:12797: checking for play-services-basement AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12812: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" >&5
+echo "configure:12638: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" >&5
     ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION-classes.jar"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB!" 1>&5; exit 1; }
@@ -12820,7 +12646,7 @@ echo "configure:12812: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES""... $ac_c" 1>&6
-echo "configure:12824: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" >&5
+echo "configure:12650: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" >&5
     ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/res"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES!" 1>&5; exit 1; }
@@ -12849,7 +12675,7 @@ echo "configure:12824: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" >&5
   
   ANDROID_PLAY_SERVICES_GCM_AAR="$ANDROID_SDK_ROOT/extras/google/m2repository/com/google/android/gms/play-services-gcm/$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-gcm-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION.aar"
   echo $ac_n "checking for play-services-gcm AAR""... $ac_c" 1>&6
-echo "configure:12853: checking for play-services-gcm AAR" >&5
+echo "configure:12679: checking for play-services-gcm AAR" >&5
   if ! test -e "$ANDROID_PLAY_SERVICES_GCM_AAR" ; then
     { echo "configure: error: You must download the play-services-gcm AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_GCM_AAR)" 1>&2; echo "configure: error: You must download the play-services-gcm AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_GCM_AAR)" 1>&5; exit 1; }
   fi
@@ -12864,7 +12690,7 @@ echo "configure:12853: checking for play-services-gcm AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_GCM_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12868: checking for ANDROID_PLAY_SERVICES_GCM_AAR_LIB" >&5
+echo "configure:12694: checking for ANDROID_PLAY_SERVICES_GCM_AAR_LIB" >&5
     ANDROID_PLAY_SERVICES_GCM_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-gcm-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-gcm-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION-classes.jar"
     if ! test -e "$ANDROID_PLAY_SERVICES_GCM_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_GCM_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_GCM_AAR_LIB!" 1>&5; exit 1; }
@@ -12876,7 +12702,7 @@ echo "configure:12868: checking for ANDROID_PLAY_SERVICES_GCM_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_GCM_AAR_RES""... $ac_c" 1>&6
-echo "configure:12880: checking for ANDROID_PLAY_SERVICES_GCM_AAR_RES" >&5
+echo "configure:12706: checking for ANDROID_PLAY_SERVICES_GCM_AAR_RES" >&5
     ANDROID_PLAY_SERVICES_GCM_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-gcm-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/res"
     if ! test -e "$ANDROID_PLAY_SERVICES_GCM_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_GCM_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_GCM_AAR_RES!" 1>&5; exit 1; }
@@ -12905,7 +12731,7 @@ echo "configure:12880: checking for ANDROID_PLAY_SERVICES_GCM_AAR_RES" >&5
   
   ANDROID_PLAY_SERVICES_MEASUREMENT_AAR="$ANDROID_SDK_ROOT/extras/google/m2repository/com/google/android/gms/play-services-measurement/$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-measurement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION.aar"
   echo $ac_n "checking for play-services-measurement AAR""... $ac_c" 1>&6
-echo "configure:12909: checking for play-services-measurement AAR" >&5
+echo "configure:12735: checking for play-services-measurement AAR" >&5
   if ! test -e "$ANDROID_PLAY_SERVICES_MEASUREMENT_AAR" ; then
     { echo "configure: error: You must download the play-services-measurement AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_MEASUREMENT_AAR)" 1>&2; echo "configure: error: You must download the play-services-measurement AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_MEASUREMENT_AAR)" 1>&5; exit 1; }
   fi
@@ -12920,7 +12746,7 @@ echo "configure:12909: checking for play-services-measurement AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12924: checking for ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_LIB" >&5
+echo "configure:12750: checking for ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_LIB" >&5
     ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-measurement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-measurement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION-classes.jar"
     if ! test -e "$ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_LIB!" 1>&5; exit 1; }
@@ -12932,7 +12758,7 @@ echo "configure:12924: checking for ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_LIB" >
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_RES""... $ac_c" 1>&6
-echo "configure:12936: checking for ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_RES" >&5
+echo "configure:12762: checking for ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_RES" >&5
     ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-measurement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/res"
     if ! test -e "$ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_MEASUREMENT_AAR_RES!" 1>&5; exit 1; }
@@ -12968,7 +12794,7 @@ if test -n "$MOZ_INSTALL_TRACKING"; then
   
   ANDROID_PLAY_SERVICES_ADS_AAR="$ANDROID_SDK_ROOT/extras/google/m2repository/com/google/android/gms/play-services-ads/$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-ads-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION.aar"
   echo $ac_n "checking for play-services-ads AAR""... $ac_c" 1>&6
-echo "configure:12972: checking for play-services-ads AAR" >&5
+echo "configure:12798: checking for play-services-ads AAR" >&5
   if ! test -e "$ANDROID_PLAY_SERVICES_ADS_AAR" ; then
     { echo "configure: error: You must download the play-services-ads AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_ADS_AAR)" 1>&2; echo "configure: error: You must download the play-services-ads AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_ADS_AAR)" 1>&5; exit 1; }
   fi
@@ -12983,7 +12809,7 @@ echo "configure:12972: checking for play-services-ads AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_ADS_AAR_LIB""... $ac_c" 1>&6
-echo "configure:12987: checking for ANDROID_PLAY_SERVICES_ADS_AAR_LIB" >&5
+echo "configure:12813: checking for ANDROID_PLAY_SERVICES_ADS_AAR_LIB" >&5
     ANDROID_PLAY_SERVICES_ADS_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-ads-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-ads-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION-classes.jar"
     if ! test -e "$ANDROID_PLAY_SERVICES_ADS_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_ADS_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_ADS_AAR_LIB!" 1>&5; exit 1; }
@@ -12995,7 +12821,7 @@ echo "configure:12987: checking for ANDROID_PLAY_SERVICES_ADS_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_ADS_AAR_RES""... $ac_c" 1>&6
-echo "configure:12999: checking for ANDROID_PLAY_SERVICES_ADS_AAR_RES" >&5
+echo "configure:12825: checking for ANDROID_PLAY_SERVICES_ADS_AAR_RES" >&5
     ANDROID_PLAY_SERVICES_ADS_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-ads-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/res"
     if ! test -e "$ANDROID_PLAY_SERVICES_ADS_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_ADS_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_ADS_AAR_RES!" 1>&5; exit 1; }
@@ -13024,7 +12850,7 @@ echo "configure:12999: checking for ANDROID_PLAY_SERVICES_ADS_AAR_RES" >&5
   
   ANDROID_PLAY_SERVICES_BASEMENT_AAR="$ANDROID_SDK_ROOT/extras/google/m2repository/com/google/android/gms/play-services-basement/$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION.aar"
   echo $ac_n "checking for play-services-basement AAR""... $ac_c" 1>&6
-echo "configure:13028: checking for play-services-basement AAR" >&5
+echo "configure:12854: checking for play-services-basement AAR" >&5
   if ! test -e "$ANDROID_PLAY_SERVICES_BASEMENT_AAR" ; then
     { echo "configure: error: You must download the play-services-basement AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASEMENT_AAR)" 1>&2; echo "configure: error: You must download the play-services-basement AAR.  Run the Android SDK tool and install the Android and Google Support Repositories under Extras.  See https://developer.android.com/tools/extras/support-library.html for more info. (Looked for $ANDROID_PLAY_SERVICES_BASEMENT_AAR)" 1>&5; exit 1; }
   fi
@@ -13039,7 +12865,7 @@ echo "configure:13028: checking for play-services-basement AAR" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB""... $ac_c" 1>&6
-echo "configure:13043: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" >&5
+echo "configure:12869: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" >&5
     ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION-classes.jar"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB!" 1>&5; exit 1; }
@@ -13051,7 +12877,7 @@ echo "configure:13043: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_LIB" >&5
   
   
     echo $ac_n "checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES""... $ac_c" 1>&6
-echo "configure:13055: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" >&5
+echo "configure:12881: checking for ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" >&5
     ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES="$MOZ_BUILD_ROOT/dist/exploded-aar/play-services-basement-$ANDROID_GOOGLE_PLAY_SERVICES_VERSION/res"
     if ! test -e "$ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES" ; then
       { echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES!" 1>&2; echo "configure: error: Could not find required exploded ANDROID_PLAY_SERVICES_BASEMENT_AAR_RES!" 1>&5; exit 1; }
@@ -13117,19 +12943,19 @@ fi
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for gtk+-2.0 >= 2.14""... $ac_c" 1>&6
-echo "configure:13121: checking for gtk+-2.0 >= 2.14" >&5
+echo "configure:12947: checking for gtk+-2.0 >= 2.14" >&5
 
         if $PKG_CONFIG --exists "gtk+-2.0 >= 2.14" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking _GTKCHECK_CFLAGS""... $ac_c" 1>&6
-echo "configure:13128: checking _GTKCHECK_CFLAGS" >&5
+echo "configure:12954: checking _GTKCHECK_CFLAGS" >&5
             _GTKCHECK_CFLAGS=`$PKG_CONFIG --cflags "gtk+-2.0 >= 2.14"`
             echo "$ac_t""$_GTKCHECK_CFLAGS" 1>&6
 
             echo $ac_n "checking _GTKCHECK_LIBS""... $ac_c" 1>&6
-echo "configure:13133: checking _GTKCHECK_LIBS" >&5
+echo "configure:12959: checking _GTKCHECK_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             _GTKCHECK_LIBS="`$PKG_CONFIG --libs \"gtk+-2.0 >= 2.14\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$_GTKCHECK_LIBS" 1>&6
@@ -13170,19 +12996,19 @@ echo "configure:13133: checking _GTKCHECK_LIBS" >&5
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for gio-2.0 >= $GIO_VERSION""... $ac_c" 1>&6
-echo "configure:13174: checking for gio-2.0 >= $GIO_VERSION" >&5
+echo "configure:13000: checking for gio-2.0 >= $GIO_VERSION" >&5
 
         if $PKG_CONFIG --exists "gio-2.0 >= $GIO_VERSION" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_GIO_CFLAGS""... $ac_c" 1>&6
-echo "configure:13181: checking MOZ_GIO_CFLAGS" >&5
+echo "configure:13007: checking MOZ_GIO_CFLAGS" >&5
             MOZ_GIO_CFLAGS=`$PKG_CONFIG --cflags "gio-2.0 >= $GIO_VERSION"`
             echo "$ac_t""$MOZ_GIO_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_GIO_LIBS""... $ac_c" 1>&6
-echo "configure:13186: checking MOZ_GIO_LIBS" >&5
+echo "configure:13012: checking MOZ_GIO_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_GIO_LIBS="`$PKG_CONFIG --libs \"gio-2.0 >= $GIO_VERSION\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_GIO_LIBS" 1>&6
@@ -13257,19 +13083,19 @@ fi
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for gconf-2.0 >= $GCONF_VERSION gobject-2.0 ""... $ac_c" 1>&6
-echo "configure:13261: checking for gconf-2.0 >= $GCONF_VERSION gobject-2.0 " >&5
+echo "configure:13087: checking for gconf-2.0 >= $GCONF_VERSION gobject-2.0 " >&5
 
         if $PKG_CONFIG --exists "gconf-2.0 >= $GCONF_VERSION gobject-2.0 " ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_GCONF_CFLAGS""... $ac_c" 1>&6
-echo "configure:13268: checking MOZ_GCONF_CFLAGS" >&5
+echo "configure:13094: checking MOZ_GCONF_CFLAGS" >&5
             MOZ_GCONF_CFLAGS=`$PKG_CONFIG --cflags "gconf-2.0 >= $GCONF_VERSION gobject-2.0 "`
             echo "$ac_t""$MOZ_GCONF_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_GCONF_LIBS""... $ac_c" 1>&6
-echo "configure:13273: checking MOZ_GCONF_LIBS" >&5
+echo "configure:13099: checking MOZ_GCONF_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_GCONF_LIBS="`$PKG_CONFIG --libs \"gconf-2.0 >= $GCONF_VERSION gobject-2.0 \" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_GCONF_LIBS" 1>&6
@@ -13354,19 +13180,19 @@ fi
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for libproxy-1.0""... $ac_c" 1>&6
-echo "configure:13358: checking for libproxy-1.0" >&5
+echo "configure:13184: checking for libproxy-1.0" >&5
 
         if $PKG_CONFIG --exists "libproxy-1.0" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_LIBPROXY_CFLAGS""... $ac_c" 1>&6
-echo "configure:13365: checking MOZ_LIBPROXY_CFLAGS" >&5
+echo "configure:13191: checking MOZ_LIBPROXY_CFLAGS" >&5
             MOZ_LIBPROXY_CFLAGS=`$PKG_CONFIG --cflags "libproxy-1.0"`
             echo "$ac_t""$MOZ_LIBPROXY_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_LIBPROXY_LIBS""... $ac_c" 1>&6
-echo "configure:13370: checking MOZ_LIBPROXY_LIBS" >&5
+echo "configure:13196: checking MOZ_LIBPROXY_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_LIBPROXY_LIBS="`$PKG_CONFIG --libs \"libproxy-1.0\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_LIBPROXY_LIBS" 1>&6
@@ -13435,19 +13261,19 @@ fi
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for libgnomeui-2.0 >= $GNOMEUI_VERSION""... $ac_c" 1>&6
-echo "configure:13439: checking for libgnomeui-2.0 >= $GNOMEUI_VERSION" >&5
+echo "configure:13265: checking for libgnomeui-2.0 >= $GNOMEUI_VERSION" >&5
 
         if $PKG_CONFIG --exists "libgnomeui-2.0 >= $GNOMEUI_VERSION" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_GNOMEUI_CFLAGS""... $ac_c" 1>&6
-echo "configure:13446: checking MOZ_GNOMEUI_CFLAGS" >&5
+echo "configure:13272: checking MOZ_GNOMEUI_CFLAGS" >&5
             MOZ_GNOMEUI_CFLAGS=`$PKG_CONFIG --cflags "libgnomeui-2.0 >= $GNOMEUI_VERSION"`
             echo "$ac_t""$MOZ_GNOMEUI_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_GNOMEUI_LIBS""... $ac_c" 1>&6
-echo "configure:13451: checking MOZ_GNOMEUI_LIBS" >&5
+echo "configure:13277: checking MOZ_GNOMEUI_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_GNOMEUI_LIBS="`$PKG_CONFIG --libs \"libgnomeui-2.0 >= $GNOMEUI_VERSION\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_GNOMEUI_LIBS" 1>&6
@@ -13530,19 +13356,19 @@ fi
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for dbus-1 >= $DBUS_VERSION""... $ac_c" 1>&6
-echo "configure:13534: checking for dbus-1 >= $DBUS_VERSION" >&5
+echo "configure:13360: checking for dbus-1 >= $DBUS_VERSION" >&5
 
         if $PKG_CONFIG --exists "dbus-1 >= $DBUS_VERSION" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_DBUS_CFLAGS""... $ac_c" 1>&6
-echo "configure:13541: checking MOZ_DBUS_CFLAGS" >&5
+echo "configure:13367: checking MOZ_DBUS_CFLAGS" >&5
             MOZ_DBUS_CFLAGS=`$PKG_CONFIG --cflags "dbus-1 >= $DBUS_VERSION"`
             echo "$ac_t""$MOZ_DBUS_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_DBUS_LIBS""... $ac_c" 1>&6
-echo "configure:13546: checking MOZ_DBUS_LIBS" >&5
+echo "configure:13372: checking MOZ_DBUS_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_DBUS_LIBS="`$PKG_CONFIG --libs \"dbus-1 >= $DBUS_VERSION\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_DBUS_LIBS" 1>&6
@@ -13582,19 +13408,19 @@ echo "configure:13546: checking MOZ_DBUS_LIBS" >&5
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for dbus-glib-1 >= $DBUS_VERSION""... $ac_c" 1>&6
-echo "configure:13586: checking for dbus-glib-1 >= $DBUS_VERSION" >&5
+echo "configure:13412: checking for dbus-glib-1 >= $DBUS_VERSION" >&5
 
         if $PKG_CONFIG --exists "dbus-glib-1 >= $DBUS_VERSION" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_DBUS_GLIB_CFLAGS""... $ac_c" 1>&6
-echo "configure:13593: checking MOZ_DBUS_GLIB_CFLAGS" >&5
+echo "configure:13419: checking MOZ_DBUS_GLIB_CFLAGS" >&5
             MOZ_DBUS_GLIB_CFLAGS=`$PKG_CONFIG --cflags "dbus-glib-1 >= $DBUS_VERSION"`
             echo "$ac_t""$MOZ_DBUS_GLIB_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_DBUS_GLIB_LIBS""... $ac_c" 1>&6
-echo "configure:13598: checking MOZ_DBUS_GLIB_LIBS" >&5
+echo "configure:13424: checking MOZ_DBUS_GLIB_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_DBUS_GLIB_LIBS="`$PKG_CONFIG --libs \"dbus-glib-1 >= $DBUS_VERSION\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_DBUS_GLIB_LIBS" 1>&6
@@ -13697,14 +13523,14 @@ if test -n "$MOZ_WEBRTC"; then
 fi
 
 cat > conftest.$ac_ext <<EOF
-#line 13701 "configure"
+#line 13527 "configure"
 #include "confdefs.h"
 #include <linux/ethtool.h>
 int main() {
  struct ethtool_cmd cmd; cmd.speed_hi = 0; 
 ; return 0; }
 EOF
-if { (eval echo configure:13708: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:13534: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   MOZ_WEBRTC_HAVE_ETHTOOL_SPEED_HI=1
 else
@@ -13790,7 +13616,7 @@ cat >> confdefs.h <<\EOF
 EOF
 
     if test -n "$MOZ_X11"; then
-      MOZ_WEBRTC_X11_LIBS="-lXext -lXdamage -lXfixes -lXcomposite"
+      MOZ_WEBRTC_X11_LIBS=""
     fi
 else
     MOZ_SYNTH_PICO=
@@ -13883,17 +13709,17 @@ if test -n "$MOZ_APPLEMEDIA"; then
     
 ac_safe=`echo "CoreMedia/CoreMedia.h" | sed 'y%./+-%__p_%'`
 echo $ac_n "checking for CoreMedia/CoreMedia.h""... $ac_c" 1>&6
-echo "configure:13887: checking for CoreMedia/CoreMedia.h" >&5
+echo "configure:13713: checking for CoreMedia/CoreMedia.h" >&5
 if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 13892 "configure"
+#line 13718 "configure"
 #include "confdefs.h"
 #include <CoreMedia/CoreMedia.h>
 EOF
 ac_try="$ac_cpp conftest.$ac_ext >/dev/null 2>conftest.out"
-{ (eval echo configure:13897: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
+{ (eval echo configure:13723: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }
 ac_err=`grep -v '^ *+' conftest.out | grep -v "^conftest.${ac_ext}\$"`
 if test -z "$ac_err"; then
   rm -rf conftest*
@@ -14043,19 +13869,19 @@ if test -n "$MOZ_SYSTEM_LIBVPX"; then
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for vpx >= 1.5.0""... $ac_c" 1>&6
-echo "configure:14047: checking for vpx >= 1.5.0" >&5
+echo "configure:13873: checking for vpx >= 1.5.0" >&5
 
         if $PKG_CONFIG --exists "vpx >= 1.5.0" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_LIBVPX_CFLAGS""... $ac_c" 1>&6
-echo "configure:14054: checking MOZ_LIBVPX_CFLAGS" >&5
+echo "configure:13880: checking MOZ_LIBVPX_CFLAGS" >&5
             MOZ_LIBVPX_CFLAGS=`$PKG_CONFIG --cflags "vpx >= 1.5.0"`
             echo "$ac_t""$MOZ_LIBVPX_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_LIBVPX_LIBS""... $ac_c" 1>&6
-echo "configure:14059: checking MOZ_LIBVPX_LIBS" >&5
+echo "configure:13885: checking MOZ_LIBVPX_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_LIBVPX_LIBS="`$PKG_CONFIG --libs \"vpx >= 1.5.0\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_LIBVPX_LIBS" 1>&6
@@ -14090,12 +13916,12 @@ echo "configure:14059: checking MOZ_LIBVPX_LIBS" >&5
 
        ac_safe=`echo "vpx/vpx_decoder.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for vpx/vpx_decoder.h""... $ac_c" 1>&6
-echo "configure:14094: checking for vpx/vpx_decoder.h" >&5
+echo "configure:13920: checking for vpx/vpx_decoder.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 14099 "configure"
+#line 13925 "configure"
 #include "confdefs.h"
 
 #include <vpx/vpx_decoder.h>
@@ -14103,7 +13929,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:14107: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:13933: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -14125,7 +13951,7 @@ fi
 
 
     echo $ac_n "checking for vpx_codec_dec_init_ver in -lvpx""... $ac_c" 1>&6
-echo "configure:14129: checking for vpx_codec_dec_init_ver in -lvpx" >&5
+echo "configure:13955: checking for vpx_codec_dec_init_ver in -lvpx" >&5
 ac_lib_var=`echo vpx'_'vpx_codec_dec_init_ver | sed 'y%./+-%__p_%'`
 if eval "test \"`echo '$''{'ac_cv_lib_$ac_lib_var'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
@@ -14133,7 +13959,7 @@ else
   ac_save_LIBS="$LIBS"
 LIBS="-lvpx  $LIBS"
 cat > conftest.$ac_ext <<EOF
-#line 14137 "configure"
+#line 13963 "configure"
 #include "confdefs.h"
 /* Override any gcc2 internal prototype to avoid an error.  */
 /* We use char because int might match the return type of a gcc2
@@ -14144,7 +13970,7 @@ int main() {
 vpx_codec_dec_init_ver()
 ; return 0; }
 EOF
-if { (eval echo configure:14148: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:13974: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_lib_$ac_lib_var=yes"
 else
@@ -14178,12 +14004,12 @@ fi
 
        ac_safe=`echo "vpx_mem/vpx_mem.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for vpx_mem/vpx_mem.h""... $ac_c" 1>&6
-echo "configure:14182: checking for vpx_mem/vpx_mem.h" >&5
+echo "configure:14008: checking for vpx_mem/vpx_mem.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 14187 "configure"
+#line 14013 "configure"
 #include "confdefs.h"
 
 #include <vpx_mem/vpx_mem.h>
@@ -14191,7 +14017,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:14195: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:14021: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -14206,12 +14032,12 @@ fi
   if eval "test \"`echo '$ac_cv_header_'$ac_safe`\" = yes"; then
     echo "$ac_t""yes" 1>&6
     echo $ac_n "checking for vpx_mem_set_functions""... $ac_c" 1>&6
-echo "configure:14210: checking for vpx_mem_set_functions" >&5
+echo "configure:14036: checking for vpx_mem_set_functions" >&5
 if eval "test \"`echo '$''{'ac_cv_func_vpx_mem_set_functions'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 14215 "configure"
+#line 14041 "configure"
 #define vpx_mem_set_functions innocuous_vpx_mem_set_functions
 #include "confdefs.h"
 #undef vpx_mem_set_functions
@@ -14238,7 +14064,7 @@ vpx_mem_set_functions();
 
 ; return 0; }
 EOF
-if { (eval echo configure:14242: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:14068: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_vpx_mem_set_functions=yes"
 else
@@ -14318,7 +14144,7 @@ if test -z "$MOZ_SYSTEM_LIBVPX"; then
         VPX_AS_CONVERSION='$(PERL) $(topsrcdir)/media/libvpx/libvpx/build/make/ads2gas.pl'
         VPX_ARM_ASM=1
                                                                                                 cat > conftest.$ac_ext <<EOF
-#line 14322 "configure"
+#line 14148 "configure"
 #include "confdefs.h"
 
 int main() {
@@ -14327,7 +14153,7 @@ int main() {
            #endif
 ; return 0; }
 EOF
-if { (eval echo configure:14331: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:14157: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   VPX_ASFLAGS="$VPX_ASFLAGS -mfloat-abi=softfp"
            
@@ -14450,19 +14276,19 @@ if test -n "$MOZ_ALSA"; then
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for alsa""... $ac_c" 1>&6
-echo "configure:14454: checking for alsa" >&5
+echo "configure:14280: checking for alsa" >&5
 
         if $PKG_CONFIG --exists "alsa" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_ALSA_CFLAGS""... $ac_c" 1>&6
-echo "configure:14461: checking MOZ_ALSA_CFLAGS" >&5
+echo "configure:14287: checking MOZ_ALSA_CFLAGS" >&5
             MOZ_ALSA_CFLAGS=`$PKG_CONFIG --cflags "alsa"`
             echo "$ac_t""$MOZ_ALSA_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_ALSA_LIBS""... $ac_c" 1>&6
-echo "configure:14466: checking MOZ_ALSA_LIBS" >&5
+echo "configure:14292: checking MOZ_ALSA_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_ALSA_LIBS="`$PKG_CONFIG --libs \"alsa\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_ALSA_LIBS" 1>&6
@@ -14538,19 +14364,19 @@ EOF
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for libpulse""... $ac_c" 1>&6
-echo "configure:14542: checking for libpulse" >&5
+echo "configure:14368: checking for libpulse" >&5
 
         if $PKG_CONFIG --exists "libpulse" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_PULSEAUDIO_CFLAGS""... $ac_c" 1>&6
-echo "configure:14549: checking MOZ_PULSEAUDIO_CFLAGS" >&5
+echo "configure:14375: checking MOZ_PULSEAUDIO_CFLAGS" >&5
             MOZ_PULSEAUDIO_CFLAGS=`$PKG_CONFIG --cflags "libpulse"`
             echo "$ac_t""$MOZ_PULSEAUDIO_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_PULSEAUDIO_LIBS""... $ac_c" 1>&6
-echo "configure:14554: checking MOZ_PULSEAUDIO_LIBS" >&5
+echo "configure:14380: checking MOZ_PULSEAUDIO_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_PULSEAUDIO_LIBS="`$PKG_CONFIG --libs \"libpulse\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_PULSEAUDIO_LIBS" 1>&6
@@ -14736,12 +14562,12 @@ if test -n "$MOZ_ANGLE_RENDERER"; then
   if test -n "$GNU_CC"; then
        ac_safe=`echo "d3d10.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for d3d10.h""... $ac_c" 1>&6
-echo "configure:14740: checking for d3d10.h" >&5
+echo "configure:14566: checking for d3d10.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 14745 "configure"
+#line 14571 "configure"
 #include "confdefs.h"
 
 #include <d3d10.h>
@@ -14749,7 +14575,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:14753: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:14579: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -14804,12 +14630,12 @@ WINNT)
 Linux)
        ac_safe=`echo "linux/joystick.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for linux/joystick.h""... $ac_c" 1>&6
-echo "configure:14808: checking for linux/joystick.h" >&5
+echo "configure:14634: checking for linux/joystick.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 14813 "configure"
+#line 14639 "configure"
 #include "confdefs.h"
 
 #include <linux/joystick.h>
@@ -14817,7 +14643,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:14821: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:14647: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -14913,19 +14739,19 @@ EOF
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for gthread-2.0""... $ac_c" 1>&6
-echo "configure:14917: checking for gthread-2.0" >&5
+echo "configure:14743: checking for gthread-2.0" >&5
 
         if $PKG_CONFIG --exists "gthread-2.0" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_GTHREAD_CFLAGS""... $ac_c" 1>&6
-echo "configure:14924: checking MOZ_GTHREAD_CFLAGS" >&5
+echo "configure:14750: checking MOZ_GTHREAD_CFLAGS" >&5
             MOZ_GTHREAD_CFLAGS=`$PKG_CONFIG --cflags "gthread-2.0"`
             echo "$ac_t""$MOZ_GTHREAD_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_GTHREAD_LIBS""... $ac_c" 1>&6
-echo "configure:14929: checking MOZ_GTHREAD_LIBS" >&5
+echo "configure:14755: checking MOZ_GTHREAD_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_GTHREAD_LIBS="`$PKG_CONFIG --libs \"gthread-2.0\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_GTHREAD_LIBS" 1>&6
@@ -15223,7 +15049,7 @@ do
 # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
 echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:15227: checking for $ac_word" >&5
+echo "configure:15053: checking for $ac_word" >&5
 if eval "test \"`echo '$''{'ac_cv_prog_WGET'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -15596,19 +15422,19 @@ then
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for sqlite3 >= $SQLITE_VERSION""... $ac_c" 1>&6
-echo "configure:15600: checking for sqlite3 >= $SQLITE_VERSION" >&5
+echo "configure:15426: checking for sqlite3 >= $SQLITE_VERSION" >&5
 
         if $PKG_CONFIG --exists "sqlite3 >= $SQLITE_VERSION" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking SQLITE_CFLAGS""... $ac_c" 1>&6
-echo "configure:15607: checking SQLITE_CFLAGS" >&5
+echo "configure:15433: checking SQLITE_CFLAGS" >&5
             SQLITE_CFLAGS=`$PKG_CONFIG --cflags "sqlite3 >= $SQLITE_VERSION"`
             echo "$ac_t""$SQLITE_CFLAGS" 1>&6
 
             echo $ac_n "checking SQLITE_LIBS""... $ac_c" 1>&6
-echo "configure:15612: checking SQLITE_LIBS" >&5
+echo "configure:15438: checking SQLITE_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             SQLITE_LIBS="`$PKG_CONFIG --libs \"sqlite3 >= $SQLITE_VERSION\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$SQLITE_LIBS" 1>&6
@@ -15639,7 +15465,7 @@ echo "configure:15612: checking SQLITE_LIBS" >&5
 
 
                         echo $ac_n "checking for SQLITE_SECURE_DELETE support in system SQLite""... $ac_c" 1>&6
-echo "configure:15643: checking for SQLITE_SECURE_DELETE support in system SQLite" >&5
+echo "configure:15469: checking for SQLITE_SECURE_DELETE support in system SQLite" >&5
     _SAVE_CFLAGS="$CFLAGS"
     CFLAGS="$CFLAGS $SQLITE_CFLAGS"
     _SAVE_LIBS="$LIBS"
@@ -15653,7 +15479,7 @@ else
         
 else
   cat > conftest.$ac_ext <<EOF
-#line 15657 "configure"
+#line 15483 "configure"
 #include "confdefs.h"
 
             #include "sqlite3.h"
@@ -15662,7 +15488,7 @@ else
               return !sqlite3_compileoption_used("SQLITE_SECURE_DELETE");
             }
 EOF
-if { (eval echo configure:15666: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:15492: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sqlite_secure_delete=yes
 else
@@ -15685,7 +15511,7 @@ fi
     fi
 
                         echo $ac_n "checking for SQLITE_THREADSAFE support in system SQLite""... $ac_c" 1>&6
-echo "configure:15689: checking for SQLITE_THREADSAFE support in system SQLite" >&5
+echo "configure:15515: checking for SQLITE_THREADSAFE support in system SQLite" >&5
     _SAVE_CFLAGS="$CFLAGS"
     CFLAGS="$CFLAGS $SQLITE_CFLAGS"
     _SAVE_LIBS="$LIBS"
@@ -15699,7 +15525,7 @@ else
         
 else
   cat > conftest.$ac_ext <<EOF
-#line 15703 "configure"
+#line 15529 "configure"
 #include "confdefs.h"
 
             #include "sqlite3.h"
@@ -15708,7 +15534,7 @@ else
               return !sqlite3_compileoption_used("SQLITE_THREADSAFE=1");
             }
 EOF
-if { (eval echo configure:15712: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:15538: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sqlite_threadsafe=yes
 else
@@ -15731,7 +15557,7 @@ fi
     fi
 
                         echo $ac_n "checking for SQLITE_ENABLE_FTS3 support in system SQLite""... $ac_c" 1>&6
-echo "configure:15735: checking for SQLITE_ENABLE_FTS3 support in system SQLite" >&5
+echo "configure:15561: checking for SQLITE_ENABLE_FTS3 support in system SQLite" >&5
     _SAVE_CFLAGS="$CFLAGS"
     CFLAGS="$CFLAGS $SQLITE_CFLAGS"
     _SAVE_LIBS="$LIBS"
@@ -15745,7 +15571,7 @@ else
         
 else
   cat > conftest.$ac_ext <<EOF
-#line 15749 "configure"
+#line 15575 "configure"
 #include "confdefs.h"
 
             #include "sqlite3.h"
@@ -15754,7 +15580,7 @@ else
               return !sqlite3_compileoption_used("SQLITE_ENABLE_FTS3");
             }
 EOF
-if { (eval echo configure:15758: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:15584: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sqlite_enable_fts3=yes
 else
@@ -15777,7 +15603,7 @@ fi
     fi
 
                         echo $ac_n "checking for SQLITE_ENABLE_UNLOCK_NOTIFY support in system SQLite""... $ac_c" 1>&6
-echo "configure:15781: checking for SQLITE_ENABLE_UNLOCK_NOTIFY support in system SQLite" >&5
+echo "configure:15607: checking for SQLITE_ENABLE_UNLOCK_NOTIFY support in system SQLite" >&5
     _SAVE_CFLAGS="$CFLAGS"
     CFLAGS="$CFLAGS $SQLITE_CFLAGS"
     _SAVE_LIBS="$LIBS"
@@ -15791,7 +15617,7 @@ else
         
 else
   cat > conftest.$ac_ext <<EOF
-#line 15795 "configure"
+#line 15621 "configure"
 #include "confdefs.h"
 
             #include "sqlite3.h"
@@ -15800,7 +15626,7 @@ else
               return !sqlite3_compileoption_used("SQLITE_ENABLE_UNLOCK_NOTIFY");
             }
 EOF
-if { (eval echo configure:15804: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:15630: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sqlite_enable_unlock_notify=yes
 else
@@ -15823,7 +15649,7 @@ fi
     fi
 
                         echo $ac_n "checking for SQLITE_ENABLE_DBSTAT_VTAB support in system SQLite""... $ac_c" 1>&6
-echo "configure:15827: checking for SQLITE_ENABLE_DBSTAT_VTAB support in system SQLite" >&5
+echo "configure:15653: checking for SQLITE_ENABLE_DBSTAT_VTAB support in system SQLite" >&5
     _SAVE_CFLAGS="$CFLAGS"
     CFLAGS="$CFLAGS $SQLITE_CFLAGS"
     _SAVE_LIBS="$LIBS"
@@ -15837,7 +15663,7 @@ else
         
 else
   cat > conftest.$ac_ext <<EOF
-#line 15841 "configure"
+#line 15667 "configure"
 #include "confdefs.h"
 
             #include "sqlite3.h"
@@ -15846,7 +15672,7 @@ else
               return !sqlite3_compileoption_used("SQLITE_ENABLE_DBSTAT_VTAB");
             }
 EOF
-if { (eval echo configure:15850: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
+if { (eval echo configure:15676: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext} && (./conftest; exit) 2>/dev/null
 then
   ac_cv_sqlite_dbstat_vtab=yes
 else
@@ -16030,18 +15856,18 @@ fi
 if test "$COMPILE_ENVIRONMENT"; then
 if test -n "$MOZ_OPTIMIZE"; then
     echo $ac_n "checking for valid C compiler optimization flags""... $ac_c" 1>&6
-echo "configure:16034: checking for valid C compiler optimization flags" >&5
+echo "configure:15860: checking for valid C compiler optimization flags" >&5
     _SAVE_CFLAGS=$CFLAGS
     CFLAGS="$CFLAGS $MOZ_OPTIMIZE_FLAGS"
     cat > conftest.$ac_ext <<EOF
-#line 16038 "configure"
+#line 15864 "configure"
 #include "confdefs.h"
 #include <stdio.h>
 int main() {
 printf("Hello World\n");
 ; return 0; }
 EOF
-if { (eval echo configure:16045: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:15871: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   _results=yes
 else
@@ -16174,12 +16000,12 @@ if test -n "$MOZ_REPLACE_MALLOC"; then
 
         if test -n "$MACOSX_DEPLOYMENT_TARGET"; then
         echo $ac_n "checking how to do weak dynamic linking""... $ac_c" 1>&6
-echo "configure:16178: checking how to do weak dynamic linking" >&5
+echo "configure:16004: checking how to do weak dynamic linking" >&5
 if eval "test \"`echo '$''{'ac_cv_weak_dynamic_linking'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   echo 'extern void foo() __attribute__((weak_import));int bar() { if (foo) foo(); return 0; }' > conftest.c
-             if { ac_try='${CC-cc} -o conftest${DLL_SUFFIX} $CFLAGS -dynamiclib $LDFLAGS -Wl,-U,_foo conftest.c $LIBS 1>&5'; { (eval echo configure:16183: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
+             if { ac_try='${CC-cc} -o conftest${DLL_SUFFIX} $CFLAGS -dynamiclib $LDFLAGS -Wl,-U,_foo conftest.c $LIBS 1>&5'; { (eval echo configure:16009: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
                 test -s conftest${DLL_SUFFIX}; then
                                                                                      if "$OTOOL" -l conftest${DLL_SUFFIX} 2> /dev/null | grep "LC_DYLD_INFO_ONLY" > /dev/null; then
                      _CLASSIC_INFO=
@@ -16230,12 +16056,12 @@ else
     for ac_func in mallctl nallocx
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:16234: checking for $ac_func" >&5
+echo "configure:16060: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 16239 "configure"
+#line 16065 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -16262,7 +16088,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:16266: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:16092: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -16362,7 +16188,7 @@ if test -n "$ENABLE_CLANG_PLUGIN"; then
     fi
 
     echo $ac_n "checking for llvm-config""... $ac_c" 1>&6
-echo "configure:16366: checking for llvm-config" >&5
+echo "configure:16192: checking for llvm-config" >&5
     if test -z "$LLVMCONFIG"; then
       if test -n "$CLANG_CL"; then
           CXX_COMPILER="$(dirname "$CXX")/clang"
@@ -16422,7 +16248,7 @@ echo "configure:16366: checking for llvm-config" >&5
     fi
 
                 echo $ac_n "checking for new ASTMatcher API""... $ac_c" 1>&6
-echo "configure:16426: checking for new ASTMatcher API" >&5
+echo "configure:16252: checking for new ASTMatcher API" >&5
 if eval "test \"`echo '$''{'ac_cv_have_new_ASTMatcher_api'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -16442,14 +16268,14 @@ cross_compiling=$ac_cv_prog_cxx_cross
             CXXFLAGS="${LLVM_CXXFLAGS}"
             CXX="${HOST_CXX}"
             cat > conftest.$ac_ext <<EOF
-#line 16446 "configure"
+#line 16272 "configure"
 #include "confdefs.h"
 #include "clang/ASTMatchers/ASTMatchers.h"
 int main() {
 clang::ast_matchers::cxxConstructExpr();
 ; return 0; }
 EOF
-if { (eval echo configure:16453: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:16279: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_have_new_ASTMatcher_names="yes"
 else
@@ -16478,7 +16304,7 @@ echo "$ac_t""$ac_cv_have_new_ASTMatcher_api" 1>&6
     fi
 
                 echo $ac_n "checking for has with ignoringParenImpCasts""... $ac_c" 1>&6
-echo "configure:16482: checking for has with ignoringParenImpCasts" >&5
+echo "configure:16308: checking for has with ignoringParenImpCasts" >&5
 if eval "test \"`echo '$''{'ac_cv_has_accepts_ignoringParenImpCasts'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -16498,7 +16324,7 @@ cross_compiling=$ac_cv_prog_cxx_cross
             CXXFLAGS="${LLVM_CXXFLAGS}"
             CXX="${HOST_CXX}"
             cat > conftest.$ac_ext <<EOF
-#line 16502 "configure"
+#line 16328 "configure"
 #include "confdefs.h"
 #include "clang/ASTMatchers/ASTMatchers.h"
 int main() {
@@ -16507,7 +16333,7 @@ using namespace clang::ast_matchers;
                            
 ; return 0; }
 EOF
-if { (eval echo configure:16511: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:16337: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_has_accepts_ignoringParenImpCasts="yes"
 else
@@ -16614,12 +16440,12 @@ fi
 
 if test -n "$COMPILE_ENVIRONMENT" -a -n "$USE_ELF_HACK"; then
                                         echo $ac_n "checking whether linker creates PT_GNU_RELRO segments""... $ac_c" 1>&6
-echo "configure:16618: checking whether linker creates PT_GNU_RELRO segments" >&5
+echo "configure:16444: checking whether linker creates PT_GNU_RELRO segments" >&5
 if eval "test \"`echo '$''{'LINK_WITH_PT_GNU_RELRO'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   echo "int main() {return 0;}" > conftest.${ac_ext}
-         if { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS conftest.${ac_ext} $LIBS 1>&2'; { (eval echo configure:16623: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
+         if { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS conftest.${ac_ext} $LIBS 1>&2'; { (eval echo configure:16449: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } &&
             test -s conftest${ac_exeext}; then
             if ${TOOLCHAIN_PREFIX}readelf -l conftest${ac_exeext} | grep GNU_RELRO > /dev/null; then
                 LINK_WITH_PT_GNU_RELRO=yes
@@ -16636,18 +16462,18 @@ echo "$ac_t""$LINK_WITH_PT_GNU_RELRO" 1>&6
     if test "$LINK_WITH_PT_GNU_RELRO" = yes; then
         if test "$USE_ELF_HACK" = F; then
             echo $ac_n "checking for -z norelro option to ld""... $ac_c" 1>&6
-echo "configure:16640: checking for -z norelro option to ld" >&5
+echo "configure:16466: checking for -z norelro option to ld" >&5
             _SAVE_LDFLAGS=$LDFLAGS
             LDFLAGS="$LDFLAGS -Wl,-z,norelro"
             cat > conftest.$ac_ext <<EOF
-#line 16644 "configure"
+#line 16470 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:16651: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:16477: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   echo "$ac_t""yes" 1>&6
                         NSPR_LDFLAGS="$NSPR_LDFLAGS -Wl,-z,norelro"
@@ -16892,12 +16718,12 @@ cross_compiling=$ac_cv_prog_cxx_cross
     for ac_func in __cxa_demangle
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:16896: checking for $ac_func" >&5
+echo "configure:16722: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 16901 "configure"
+#line 16727 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -16927,7 +16753,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:16931: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:16757: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -16989,12 +16815,12 @@ cross_compiling=$ac_cv_prog_cxx_cross
 
        ac_safe=`echo "unwind.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for unwind.h""... $ac_c" 1>&6
-echo "configure:16993: checking for unwind.h" >&5
+echo "configure:16819: checking for unwind.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 16998 "configure"
+#line 16824 "configure"
 #include "confdefs.h"
 
 #include <unwind.h>
@@ -17002,7 +16828,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:17006: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:16832: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -17019,12 +16845,12 @@ fi
     for ac_func in _Unwind_Backtrace
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:17023: checking for $ac_func" >&5
+echo "configure:16849: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 17028 "configure"
+#line 16854 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -17056,7 +16882,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:17060: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:16886: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -17202,7 +17028,7 @@ if test -z "$SKIP_COMPILER_CHECKS"; then
 # Compiler Options
 
 echo $ac_n "checking for -pipe support""... $ac_c" 1>&6
-echo "configure:17206: checking for -pipe support" >&5
+echo "configure:17032: checking for -pipe support" >&5
 if test -n "$GNU_CC" -a -n "$GNU_CXX"; then
         CFLAGS="$CFLAGS -pipe"
     CXXFLAGS="$CXXFLAGS -pipe"
@@ -17216,16 +17042,16 @@ _SAVE_CFLAGS="$CFLAGS"
 CFLAGS="$CFLAGS -fprofile-generate -fprofile-correction"
 
 echo $ac_n "checking whether C compiler supports -fprofile-generate""... $ac_c" 1>&6
-echo "configure:17220: checking whether C compiler supports -fprofile-generate" >&5
+echo "configure:17046: checking whether C compiler supports -fprofile-generate" >&5
 cat > conftest.$ac_ext <<EOF
-#line 17222 "configure"
+#line 17048 "configure"
 #include "confdefs.h"
 
 int main() {
 return 0;
 ; return 0; }
 EOF
-if { (eval echo configure:17229: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:17055: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
    PROFILE_GEN_CFLAGS="-fprofile-generate"
                  result="yes" 
@@ -17272,20 +17098,20 @@ if test "$COMPILE_ENVIRONMENT"; then
 
 
 echo $ac_n "checking what kind of list files are supported by the linker""... $ac_c" 1>&6
-echo "configure:17276: checking what kind of list files are supported by the linker" >&5
+echo "configure:17102: checking what kind of list files are supported by the linker" >&5
 if eval "test \"`echo '$''{'EXPAND_LIBS_LIST_STYLE'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   echo "int main() {return 0;}" > conftest.${ac_ext}
-     if { ac_try='${CC-cc} -o conftest.${OBJ_SUFFIX} -c $CFLAGS $CPPFLAGS conftest.${ac_ext} 1>&5'; { (eval echo configure:17281: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } && test -s conftest.${OBJ_SUFFIX}; then
+     if { ac_try='${CC-cc} -o conftest.${OBJ_SUFFIX} -c $CFLAGS $CPPFLAGS conftest.${ac_ext} 1>&5'; { (eval echo configure:17107: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } && test -s conftest.${OBJ_SUFFIX}; then
          echo "INPUT(conftest.${OBJ_SUFFIX})" > conftest.list
-         if { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS conftest.list $LIBS 1>&5'; { (eval echo configure:17283: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } && test -s conftest${ac_exeext}; then
+         if { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS conftest.list $LIBS 1>&5'; { (eval echo configure:17109: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } && test -s conftest${ac_exeext}; then
              EXPAND_LIBS_LIST_STYLE=linkerscript
          else
              echo "conftest.${OBJ_SUFFIX}" > conftest.list
-                                                                 if { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS -Wl,-filelist,conftest.list $LIBS 1>&5'; { (eval echo configure:17287: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } && test -s conftest${ac_exeext}; then
+                                                                 if { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS -Wl,-filelist,conftest.list $LIBS 1>&5'; { (eval echo configure:17113: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } && test -s conftest${ac_exeext}; then
                  EXPAND_LIBS_LIST_STYLE=filelist
-             elif { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS @conftest.list $LIBS 1>&5'; { (eval echo configure:17289: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } && test -s conftest${ac_exeext}; then
+             elif { ac_try='${CC-cc} -o conftest${ac_exeext} $LDFLAGS @conftest.list $LIBS 1>&5'; { (eval echo configure:17115: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } && test -s conftest${ac_exeext}; then
                  EXPAND_LIBS_LIST_STYLE=list
              else
                  EXPAND_LIBS_LIST_STYLE=none
@@ -17305,7 +17131,7 @@ LIBS_DESC_SUFFIX=desc
 
 if test "$GCC_USE_GNU_LD"; then
     echo $ac_n "checking what kind of ordering can be done with the linker""... $ac_c" 1>&6
-echo "configure:17309: checking what kind of ordering can be done with the linker" >&5
+echo "configure:17135: checking what kind of ordering can be done with the linker" >&5
 if eval "test \"`echo '$''{'EXPAND_LIBS_ORDER_STYLE'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
@@ -17313,14 +17139,14 @@ else
          _SAVE_LDFLAGS="$LDFLAGS"
          LDFLAGS="${LDFLAGS} -Wl,--section-ordering-file,conftest.order"
          cat > conftest.$ac_ext <<EOF
-#line 17317 "configure"
+#line 17143 "configure"
 #include "confdefs.h"
 
 int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:17324: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:17150: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   EXPAND_LIBS_ORDER_STYLE=section-ordering-file
 else
@@ -17332,7 +17158,7 @@ fi
 rm -f conftest*
          LDFLAGS="$_SAVE_LDFLAGS"
          if test -z "$EXPAND_LIBS_ORDER_STYLE"; then
-             if { ac_try='${CC-cc} ${DSO_LDOPTS} ${LDFLAGS} -o ${DLL_PREFIX}conftest${DLL_SUFFIX} -Wl'; { (eval echo configure:17336: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
+             if { ac_try='${CC-cc} ${DSO_LDOPTS} ${LDFLAGS} -o ${DLL_PREFIX}conftest${DLL_SUFFIX} -Wl'; { (eval echo configure:17162: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; }; then
                  EXPAND_LIBS_ORDER_STYLE=linkerscript
              else
                  EXPAND_LIBS_ORDER_STYLE=none
@@ -17412,19 +17238,19 @@ if test -z "${GLIB_CFLAGS}" -o -z "${GLIB_LIBS}" ; then
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for glib-2.0 >= 1.3.7 gobject-2.0""... $ac_c" 1>&6
-echo "configure:17416: checking for glib-2.0 >= 1.3.7 gobject-2.0" >&5
+echo "configure:17242: checking for glib-2.0 >= 1.3.7 gobject-2.0" >&5
 
         if $PKG_CONFIG --exists "glib-2.0 >= 1.3.7 gobject-2.0" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking GLIB_CFLAGS""... $ac_c" 1>&6
-echo "configure:17423: checking GLIB_CFLAGS" >&5
+echo "configure:17249: checking GLIB_CFLAGS" >&5
             GLIB_CFLAGS=`$PKG_CONFIG --cflags "glib-2.0 >= 1.3.7 gobject-2.0"`
             echo "$ac_t""$GLIB_CFLAGS" 1>&6
 
             echo $ac_n "checking GLIB_LIBS""... $ac_c" 1>&6
-echo "configure:17428: checking GLIB_LIBS" >&5
+echo "configure:17254: checking GLIB_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             GLIB_LIBS="`$PKG_CONFIG --libs \"glib-2.0 >= 1.3.7 gobject-2.0\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$GLIB_LIBS" 1>&6
@@ -17475,12 +17301,12 @@ if test "$USE_FC_FREETYPE"; then
             CFLAGS="$CFLAGS $FT2_CFLAGS"
 
             echo $ac_n "checking for FT_Bitmap_Size.y_ppem""... $ac_c" 1>&6
-echo "configure:17479: checking for FT_Bitmap_Size.y_ppem" >&5
+echo "configure:17305: checking for FT_Bitmap_Size.y_ppem" >&5
 if eval "test \"`echo '$''{'ac_cv_member_FT_Bitmap_Size_y_ppem'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 17484 "configure"
+#line 17310 "configure"
 #include "confdefs.h"
 #include <ft2build.h>
                                  #include FT_FREETYPE_H
@@ -17490,7 +17316,7 @@ FT_Bitmap_Size s;
                                  return 1
 ; return 0; }
 EOF
-if { (eval echo configure:17494: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:17320: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   ac_cv_member_FT_Bitmap_Size_y_ppem=yes
 else
@@ -17519,12 +17345,12 @@ EOF
             for ac_func in FT_GlyphSlot_Embolden FT_Load_Sfnt_Table
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:17523: checking for $ac_func" >&5
+echo "configure:17349: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 17528 "configure"
+#line 17354 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -17551,7 +17377,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:17555: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:17381: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -17589,12 +17415,12 @@ done
   do
        ac_safe=`echo "$ac_hdr" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for $ac_hdr""... $ac_c" 1>&6
-echo "configure:17593: checking for $ac_hdr" >&5
+echo "configure:17419: checking for $ac_hdr" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 17598 "configure"
+#line 17424 "configure"
 #include "confdefs.h"
 #include <fontconfig/fontconfig.h>
 #include <$ac_hdr>
@@ -17602,7 +17428,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:17606: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:17432: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -17635,6 +17461,38 @@ EOF
     fi
 fi
 
+if test -n "$MOZ_SYSTEM_GRAPHITE2"; then
+        _SAVE_CFLAGS=$CFLAGS
+    CFLAGS="$CFLAGS $MOZ_GRAPHITE2_CFLAGS"
+    cat > conftest.$ac_ext <<EOF
+#line 17469 "configure"
+#include "confdefs.h"
+ #include <graphite2/Font.h>
+                     #define GR2_VERSION_REQUIRE(major,minor,bugfix)  \
+                             ( GR2_VERSION_MAJOR * 10000 + GR2_VERSION_MINOR \
+                               * 100 + GR2_VERSION_BUGFIX >= \
+                               (major) * 10000 + (minor) * 100 + (bugfix) )
+                   
+int main() {
+
+                     #if !GR2_VERSION_REQUIRE(1,3,8)
+                     #error "Insufficient graphite2 version."
+                     #endif
+                   
+; return 0; }
+EOF
+if { (eval echo configure:17485: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+  :
+else
+  echo "configure: failed program was:" >&5
+  cat conftest.$ac_ext >&5
+  rm -rf conftest*
+  { echo "configure: error: --with-system-graphite2 requested but no working libgraphite2 found" 1>&2; echo "configure: error: --with-system-graphite2 requested but no working libgraphite2 found" 1>&5; exit 1; }
+fi
+rm -f conftest*
+    CFLAGS=$_SAVE_CFLAGS
+fi
+
 
 
 
@@ -17700,19 +17558,19 @@ else
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for pixman-1 >= 0.19.2""... $ac_c" 1>&6
-echo "configure:17704: checking for pixman-1 >= 0.19.2" >&5
+echo "configure:17562: checking for pixman-1 >= 0.19.2" >&5
 
         if $PKG_CONFIG --exists "pixman-1 >= 0.19.2" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_PIXMAN_CFLAGS""... $ac_c" 1>&6
-echo "configure:17711: checking MOZ_PIXMAN_CFLAGS" >&5
+echo "configure:17569: checking MOZ_PIXMAN_CFLAGS" >&5
             MOZ_PIXMAN_CFLAGS=`$PKG_CONFIG --cflags "pixman-1 >= 0.19.2"`
             echo "$ac_t""$MOZ_PIXMAN_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_PIXMAN_LIBS""... $ac_c" 1>&6
-echo "configure:17716: checking MOZ_PIXMAN_LIBS" >&5
+echo "configure:17574: checking MOZ_PIXMAN_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_PIXMAN_LIBS="`$PKG_CONFIG --libs \"pixman-1 >= 0.19.2\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_PIXMAN_LIBS" 1>&6
@@ -17796,12 +17654,12 @@ EOF
 
              ac_safe=`echo "d3d9.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for d3d9.h""... $ac_c" 1>&6
-echo "configure:17800: checking for d3d9.h" >&5
+echo "configure:17658: checking for d3d9.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 17805 "configure"
+#line 17663 "configure"
 #include "confdefs.h"
 
 #include <d3d9.h>
@@ -17809,7 +17667,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:17813: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:17671: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -17833,12 +17691,12 @@ fi
                     if test -n "$WIN32_D2D_SURFACE_FEATURE"; then
                ac_safe=`echo "d3d10.h" | sed 'y%./+-%__p_%'`
   echo $ac_n "checking for d3d10.h""... $ac_c" 1>&6
-echo "configure:17837: checking for d3d10.h" >&5
+echo "configure:17695: checking for d3d10.h" >&5
   if eval "test \"`echo '$''{'ac_cv_header_$ac_safe'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
    cat > conftest.$ac_ext <<EOF
-#line 17842 "configure"
+#line 17700 "configure"
 #include "confdefs.h"
 
 #include <d3d10.h>
@@ -17846,7 +17704,7 @@ int main() {
 
 ; return 0; }
 EOF
-if { (eval echo configure:17850: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:17708: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   rm -rf conftest*
   eval "ac_cv_header_$ac_safe=yes"
 else
@@ -17915,19 +17773,19 @@ else
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for cairo >= $CAIRO_VERSION""... $ac_c" 1>&6
-echo "configure:17919: checking for cairo >= $CAIRO_VERSION" >&5
+echo "configure:17777: checking for cairo >= $CAIRO_VERSION" >&5
 
         if $PKG_CONFIG --exists "cairo >= $CAIRO_VERSION" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking CAIRO_CFLAGS""... $ac_c" 1>&6
-echo "configure:17926: checking CAIRO_CFLAGS" >&5
+echo "configure:17784: checking CAIRO_CFLAGS" >&5
             CAIRO_CFLAGS=`$PKG_CONFIG --cflags "cairo >= $CAIRO_VERSION"`
             echo "$ac_t""$CAIRO_CFLAGS" 1>&6
 
             echo $ac_n "checking CAIRO_LIBS""... $ac_c" 1>&6
-echo "configure:17931: checking CAIRO_LIBS" >&5
+echo "configure:17789: checking CAIRO_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             CAIRO_LIBS="`$PKG_CONFIG --libs \"cairo >= $CAIRO_VERSION\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$CAIRO_LIBS" 1>&6
@@ -17969,19 +17827,19 @@ echo "configure:17931: checking CAIRO_LIBS" >&5
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for cairo-tee >= $CAIRO_VERSION""... $ac_c" 1>&6
-echo "configure:17973: checking for cairo-tee >= $CAIRO_VERSION" >&5
+echo "configure:17831: checking for cairo-tee >= $CAIRO_VERSION" >&5
 
         if $PKG_CONFIG --exists "cairo-tee >= $CAIRO_VERSION" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking CAIRO_TEE_CFLAGS""... $ac_c" 1>&6
-echo "configure:17980: checking CAIRO_TEE_CFLAGS" >&5
+echo "configure:17838: checking CAIRO_TEE_CFLAGS" >&5
             CAIRO_TEE_CFLAGS=`$PKG_CONFIG --cflags "cairo-tee >= $CAIRO_VERSION"`
             echo "$ac_t""$CAIRO_TEE_CFLAGS" 1>&6
 
             echo $ac_n "checking CAIRO_TEE_LIBS""... $ac_c" 1>&6
-echo "configure:17985: checking CAIRO_TEE_LIBS" >&5
+echo "configure:17843: checking CAIRO_TEE_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             CAIRO_TEE_LIBS="`$PKG_CONFIG --libs \"cairo-tee >= $CAIRO_VERSION\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$CAIRO_TEE_LIBS" 1>&6
@@ -18010,63 +17868,7 @@ echo "configure:17985: checking CAIRO_TEE_LIBS" >&5
      fi
   fi
 
-    if test "$MOZ_X11"; then
-        succeeded=no
-
-  if test -z "$PKG_CONFIG"; then
-     echo "*** The pkg-config script could not be found. Make sure it is"
-     echo "*** in your path, or set the PKG_CONFIG environment variable"
-     echo "*** to the full path to pkg-config."
-     echo "*** Or see http://www.freedesktop.org/software/pkgconfig to get pkg-config."
-  else
-     PKG_CONFIG_MIN_VERSION=0.9.0
-     if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
-        echo $ac_n "checking for cairo-xlib-xrender >= $CAIRO_VERSION""... $ac_c" 1>&6
-echo "configure:18026: checking for cairo-xlib-xrender >= $CAIRO_VERSION" >&5
-
-        if $PKG_CONFIG --exists "cairo-xlib-xrender >= $CAIRO_VERSION" ; then
-            echo "$ac_t""yes" 1>&6
-            succeeded=yes
-
-            echo $ac_n "checking CAIRO_XRENDER_CFLAGS""... $ac_c" 1>&6
-echo "configure:18033: checking CAIRO_XRENDER_CFLAGS" >&5
-            CAIRO_XRENDER_CFLAGS=`$PKG_CONFIG --cflags "cairo-xlib-xrender >= $CAIRO_VERSION"`
-            echo "$ac_t""$CAIRO_XRENDER_CFLAGS" 1>&6
-
-            echo $ac_n "checking CAIRO_XRENDER_LIBS""... $ac_c" 1>&6
-echo "configure:18038: checking CAIRO_XRENDER_LIBS" >&5
-            ## Remove evil flags like -Wl,--export-dynamic
-            CAIRO_XRENDER_LIBS="`$PKG_CONFIG --libs \"cairo-xlib-xrender >= $CAIRO_VERSION\" |sed s/-Wl,--export-dynamic//g`"
-            echo "$ac_t""$CAIRO_XRENDER_LIBS" 1>&6
-        else
-            CAIRO_XRENDER_CFLAGS=""
-            CAIRO_XRENDER_LIBS=""
-            ## If we have a custom action on failure, don't print errors, but 
-            ## do set a variable so people can do so.
-            CAIRO_XRENDER_PKG_ERRORS=`$PKG_CONFIG --errors-to-stdout --print-errors "cairo-xlib-xrender >= $CAIRO_VERSION"`
-            echo $CAIRO_XRENDER_PKG_ERRORS
-        fi
-
-        
-        
-     else
-        echo "*** Your version of pkg-config is too old. You need version $PKG_CONFIG_MIN_VERSION or newer."
-        echo "*** See http://www.freedesktop.org/software/pkgconfig"
-     fi
-  fi
-
-  if test $succeeded = yes; then
-     :
-  else
-     if test "$COMPILE_ENVIRONMENT"; then 
-       { echo "configure: error: Library requirements (cairo-xlib-xrender >= $CAIRO_VERSION) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." 1>&2; echo "configure: error: Library requirements (cairo-xlib-xrender >= $CAIRO_VERSION) not met; consider adjusting the PKG_CONFIG_PATH environment variable if your libraries are in a nonstandard prefix so pkg-config can find them." 1>&5; exit 1; }
-     fi
-  fi
-
-        MOZ_CAIRO_LIBS="$MOZ_CAIRO_LIBS $XLDFLAGS $CAIRO_XRENDER_LIBS"
         MOZ_CAIRO_OSLIBS="$MOZ_CAIRO_LIBS"
-        MOZ_CAIRO_CFLAGS="$MOZ_CAIRO_CFLAGS $CAIRO_XRENDER_CFLAGS"
-    fi
 fi
 
 case "$MOZ_WIDGET_TOOLKIT" in
@@ -18580,19 +18382,19 @@ if test -n "$MOZ_SYSTEM_ICU"; then
      PKG_CONFIG_MIN_VERSION=0.9.0
      if $PKG_CONFIG --atleast-pkgconfig-version $PKG_CONFIG_MIN_VERSION; then
         echo $ac_n "checking for icu-i18n >= 58.1""... $ac_c" 1>&6
-echo "configure:18584: checking for icu-i18n >= 58.1" >&5
+echo "configure:18386: checking for icu-i18n >= 58.1" >&5
 
         if $PKG_CONFIG --exists "icu-i18n >= 58.1" ; then
             echo "$ac_t""yes" 1>&6
             succeeded=yes
 
             echo $ac_n "checking MOZ_ICU_CFLAGS""... $ac_c" 1>&6
-echo "configure:18591: checking MOZ_ICU_CFLAGS" >&5
+echo "configure:18393: checking MOZ_ICU_CFLAGS" >&5
             MOZ_ICU_CFLAGS=`$PKG_CONFIG --cflags "icu-i18n >= 58.1"`
             echo "$ac_t""$MOZ_ICU_CFLAGS" 1>&6
 
             echo $ac_n "checking MOZ_ICU_LIBS""... $ac_c" 1>&6
-echo "configure:18596: checking MOZ_ICU_LIBS" >&5
+echo "configure:18398: checking MOZ_ICU_LIBS" >&5
             ## Remove evil flags like -Wl,--export-dynamic
             MOZ_ICU_LIBS="`$PKG_CONFIG --libs \"icu-i18n >= 58.1\" |sed s/-Wl,--export-dynamic//g`"
             echo "$ac_t""$MOZ_ICU_LIBS" 1>&6
@@ -18877,12 +18679,12 @@ if test -n "$COMPILE_ENVIRONMENT"; then
 for ac_func in posix_fadvise posix_fallocate
 do
 echo $ac_n "checking for $ac_func""... $ac_c" 1>&6
-echo "configure:18881: checking for $ac_func" >&5
+echo "configure:18683: checking for $ac_func" >&5
 if eval "test \"`echo '$''{'ac_cv_func_$ac_func'+set}'`\" = set"; then
   echo $ac_n "(cached) $ac_c" 1>&6
 else
   cat > conftest.$ac_ext <<EOF
-#line 18886 "configure"
+#line 18688 "configure"
 #define $ac_func innocuous_$ac_func
 #include "confdefs.h"
 #undef $ac_func
@@ -18909,7 +18711,7 @@ $ac_func();
 
 ; return 0; }
 EOF
-if { (eval echo configure:18913: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
+if { (eval echo configure:18715: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
   rm -rf conftest*
   eval "ac_cv_func_$ac_func=yes"
 else
@@ -18937,11 +18739,11 @@ fi
 done
 
 
-if test "$MOZ_X11"; then
+if test "$MOZ_X11_no"; then
                 _SAVE_CFLAGS=$CFLAGS
     CFLAGS="$CFLAGS $XCFLAGS"
     cat > conftest.$ac_ext <<EOF
-#line 18945 "configure"
+#line 18747 "configure"
 #include "confdefs.h"
 
         #include <stdio.h>
@@ -18960,7 +18762,7 @@ int main() {
     
 ; return 0; }
 EOF
-if { (eval echo configure:18964: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
+if { (eval echo configure:18766: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
   :
 else
   echo "configure: failed program was:" >&5
@@ -19391,8 +19193,6 @@ sed 's/$/,/' >> $CONFIG_STATUS <<EOF
     (''' MOZ_ANDROID_MAX_SDK_VERSION ''', r''' $MOZ_ANDROID_MAX_SDK_VERSION ''')
     (''' MOZ_GTK3_CFLAGS ''', list(r''' $MOZ_GTK3_CFLAGS '''.split()))
     (''' MOZ_GTK3_LIBS ''', list(r''' $MOZ_GTK3_LIBS '''.split()))
-    (''' MOZ_GTK2_CFLAGS ''', list(r''' $MOZ_GTK2_CFLAGS '''.split()))
-    (''' MOZ_GTK2_LIBS ''', list(r''' $MOZ_GTK2_LIBS '''.split()))
     (''' MOZ_FS_LAYOUT ''', r''' $MOZ_FS_LAYOUT ''')
     (''' MOZ_STARTUP_NOTIFICATION_CFLAGS ''', list(r''' $MOZ_STARTUP_NOTIFICATION_CFLAGS '''.split()))
     (''' MOZ_STARTUP_NOTIFICATION_LIBS ''', list(r''' $MOZ_STARTUP_NOTIFICATION_LIBS '''.split()))
@@ -19562,8 +19362,6 @@ sed 's/$/,/' >> $CONFIG_STATUS <<EOF
     (''' CAIRO_LIBS ''', list(r''' $CAIRO_LIBS '''.split()))
     (''' CAIRO_TEE_CFLAGS ''', list(r''' $CAIRO_TEE_CFLAGS '''.split()))
     (''' CAIRO_TEE_LIBS ''', list(r''' $CAIRO_TEE_LIBS '''.split()))
-    (''' CAIRO_XRENDER_CFLAGS ''', list(r''' $CAIRO_XRENDER_CFLAGS '''.split()))
-    (''' CAIRO_XRENDER_LIBS ''', list(r''' $CAIRO_XRENDER_LIBS '''.split()))
     (''' MOZ_TREE_CAIRO ''', r''' $MOZ_TREE_CAIRO ''')
     (''' MOZ_CAIRO_CFLAGS ''', list(r''' $MOZ_CAIRO_CFLAGS '''.split()))
     (''' MOZ_CAIRO_LIBS ''', list(r''' $MOZ_CAIRO_LIBS '''.split()))
diff --git a/toolkit/components/moz.build b/toolkit/components/moz.build
index 2518640..fda3f4a 100644
--- a/toolkit/components/moz.build
+++ b/toolkit/components/moz.build
@@ -5,7 +5,7 @@
 # file, You can obtain one at http://mozilla.org/MPL/2.0/.
 
 # These component dirs are built for all apps (including suite)
-if CONFIG['MOZ_ENABLE_XREMOTE']:
+if CONFIG['MOZ_ENABLE_XREMOTE_no']:
     DIRS += ['remote']
 
 DIRS += [
diff --git a/toolkit/components/remote/nsGTKRemoteService.cpp b/toolkit/components/remote/nsGTKRemoteService.cpp
index 860efe0..ccd0e5f 100644
--- a/toolkit/components/remote/nsGTKRemoteService.cpp
+++ b/toolkit/components/remote/nsGTKRemoteService.cpp
@@ -9,7 +9,7 @@
 
 #include <gtk/gtk.h>
 #include <gdk/gdk.h>
-#include <gdk/gdkx.h>
+//#include <gdk/gdkx.h>
 
 #include "nsIBaseWindow.h"
 #include "nsIDocShell.h"
diff --git a/toolkit/components/remote/nsGTKRemoteService.h b/toolkit/components/remote/nsGTKRemoteService.h
index 034a77a..5493fe7 100644
--- a/toolkit/components/remote/nsGTKRemoteService.h
+++ b/toolkit/components/remote/nsGTKRemoteService.h
@@ -9,14 +9,14 @@
 #define __nsGTKRemoteService_h__
 
 #include <gdk/gdk.h>
-#include <gdk/gdkx.h>
+//#include <gdk/gdkx.h>
 #include <gtk/gtk.h>
 
 #include "nsInterfaceHashtable.h"
-#include "nsXRemoteService.h"
+//#include "nsXRemoteService.h"
 #include "mozilla/Attributes.h"
 
-class nsGTKRemoteService final : public nsXRemoteService
+class nsGTKRemoteService final
 {
 public:
   // We will be a static singleton, so don't use the ordinary methods.
diff --git a/toolkit/library/moz.build b/toolkit/library/moz.build
index 5c3f6b8..16747f7 100644
--- a/toolkit/library/moz.build
+++ b/toolkit/library/moz.build
@@ -302,11 +302,7 @@ if CONFIG['MOZ_ENABLE_DBUS']:
     OS_LIBS += CONFIG['MOZ_DBUS_GLIB_LIBS']
 
 if 'gtk' in CONFIG['MOZ_WIDGET_TOOLKIT']:
-    if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'gtk3':
-        OS_LIBS += [l for l in CONFIG['TK_LIBS']
-            if l not in ('-lgtk-3', '-lgdk-3')]
-    else:
-        OS_LIBS += CONFIG['TK_LIBS']
+    OS_LIBS += CONFIG['TK_LIBS']
     OS_LIBS += CONFIG['XLDFLAGS']
     OS_LIBS += CONFIG['XLIBS']
     OS_LIBS += CONFIG['XEXT_LIBS']
diff --git a/toolkit/toolkit.mozbuild b/toolkit/toolkit.mozbuild
index 0569a14..81c0a41 100644
--- a/toolkit/toolkit.mozbuild
+++ b/toolkit/toolkit.mozbuild
@@ -117,7 +117,7 @@ DIRS += [
     '/xpfe/components',
 ]
 
-if CONFIG['MOZ_ENABLE_XREMOTE']:
+if CONFIG['MOZ_ENABLE_XREMOTE_no']:
     DIRS += ['/widget/xremoteclient']
 
 if CONFIG['MOZ_SPELLCHECK']:
diff --git a/toolkit/xre/moz.build b/toolkit/xre/moz.build
index b119d38..1478ba2 100644
--- a/toolkit/xre/moz.build
+++ b/toolkit/xre/moz.build
@@ -71,7 +71,7 @@ if CONFIG['MOZ_WIDGET_TOOLKIT'] == 'gtk3':
         'nsGDKErrorHandler.cpp',
     ]
 
-if CONFIG['MOZ_X11']:
+if CONFIG['MOZ_X11_no']:
     EXPORTS += ['nsX11ErrorHandler.h']
     UNIFIED_SOURCES += [
         'nsX11ErrorHandler.cpp',
diff --git a/toolkit/xre/nsAppRunner.cpp b/toolkit/xre/nsAppRunner.cpp
index 8ceda40..4be40ec 100644
--- a/toolkit/xre/nsAppRunner.cpp
+++ b/toolkit/xre/nsAppRunner.cpp
@@ -166,7 +166,7 @@
 #endif
 
 // for X remote support
-#ifdef MOZ_ENABLE_XREMOTE
+#ifdef MOZ_ENABLE_XREMOTE_no
 #include "XRemoteClient.h"
 #include "nsIRemoteService.h"
 #include "nsProfileLock.h"
@@ -247,7 +247,7 @@ nsString gAbsoluteArgv0Path;
 #include <pango/pangofc-fontmap.h>
 #endif
 #include <gtk/gtk.h>
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <gdk/gdkx.h>
 #endif /* MOZ_X11 */
 #include "nsGTKToolkit.h"
@@ -1602,7 +1602,7 @@ DumpHelp()
   printf("Usage: %s [ options ... ] [URL]\n"
          "       where options include:\n\n", gArgv[0]);
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   printf("X11 options\n"
          "  --display=DISPLAY  X display to use\n"
          "  --sync             Make X calls synchronous\n");
@@ -1687,7 +1687,7 @@ DumpVersion()
   printf("\n");
 }
 
-#ifdef MOZ_ENABLE_XREMOTE
+#ifdef MOZ_ENABLE_XREMOTE_no
 static RemoteResult
 ParseRemoteCommandLine(nsCString& program,
                        const char** profile,
@@ -3012,7 +3012,7 @@ public:
   XREMain() :
     mStartOffline(false)
     , mShuttingDown(false)
-#ifdef MOZ_ENABLE_XREMOTE
+#ifdef MOZ_ENABLE_XREMOTE_no
     , mDisableRemote(false)
 #endif
 #if defined(MOZ_WIDGET_GTK)
@@ -3035,7 +3035,7 @@ public:
   nsCOMPtr<nsIFile> mProfD;
   nsCOMPtr<nsIFile> mProfLD;
   nsCOMPtr<nsIProfileLock> mProfileLock;
-#ifdef MOZ_ENABLE_XREMOTE
+#ifdef MOZ_ENABLE_XREMOTE_no
   nsCOMPtr<nsIRemoteService> mRemoteService;
   nsProfileLock mRemoteLock;
   nsCOMPtr<nsIFile> mRemoteLockDir;
@@ -3050,7 +3050,7 @@ public:
 
   bool mStartOffline;
   bool mShuttingDown;
-#ifdef MOZ_ENABLE_XREMOTE
+#ifdef MOZ_ENABLE_XREMOTE_no
   bool mDisableRemote;
 #endif
 
@@ -3759,7 +3759,7 @@ XREMain::XRE_mainStartup(bool* aExitFlag)
     }
   }
 #endif /* MOZ_WIDGET_GTK */
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   // Init X11 in thread-safe mode. Must be called prior to the first call to XOpenDisplay
   // (called inside gdk_display_open). This is a requirement for off main tread compositing.
   XInitThreads();
@@ -3772,15 +3772,8 @@ XREMain::XRE_mainStartup(bool* aExitFlag)
   }
   gdk_display_manager_set_default_display (gdk_display_manager_get(),
                                            mGdkDisplay);
-  if (GDK_IS_X11_DISPLAY(mGdkDisplay)) {
-    if (saveDisplayArg) {
-      SaveWordToEnv("DISPLAY", nsDependentCString(display_name));
-    }
-  } else {
-    mDisableRemote = true;
-  }
 #endif
-#ifdef MOZ_ENABLE_XREMOTE
+#ifdef MOZ_ENABLE_XREMOTE_no
   // handle --remote now that xpcom is fired up
   bool newInstance;
   {
@@ -3873,7 +3866,7 @@ XREMain::XRE_mainStartup(bool* aExitFlag)
   gtk_widget_set_default_colormap(gdk_rgb_get_colormap());
 #endif /* (MOZ_WIDGET_GTK == 2) */
 #endif /* defined(MOZ_WIDGET_GTK) */
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   // Do this after initializing GDK, or GDK will install its own handler.
   XRE_InstallX11ErrorHandler();
 #endif
@@ -4419,7 +4412,7 @@ XREMain::XRE_mainRun()
   }
 
   if (!mShuttingDown) {
-#ifdef MOZ_ENABLE_XREMOTE
+#ifdef MOZ_ENABLE_XREMOTE_no
     // if we have X remote support, start listening for requests on the
     // proxy window.
     if (!mDisableRemote)
@@ -4671,7 +4664,7 @@ XREMain::XRE_main(int argc, char* argv[], const BootstrapConfig& aConfig)
   }
 
   if (!mShuttingDown) {
-#ifdef MOZ_ENABLE_XREMOTE
+#ifdef MOZ_ENABLE_XREMOTE_no
     // shut down the x remote proxy window
     if (mRemoteService) {
       mRemoteService->Shutdown();
diff --git a/toolkit/xre/nsEmbedFunctions.cpp b/toolkit/xre/nsEmbedFunctions.cpp
index 7b60600..d44d586 100644
--- a/toolkit/xre/nsEmbedFunctions.cpp
+++ b/toolkit/xre/nsEmbedFunctions.cpp
@@ -43,7 +43,7 @@
 #include "nsVersionComparator.h"
 #include "chrome/common/mach_ipc_mac.h"
 #endif
-#include "nsX11ErrorHandler.h"
+//#include "nsX11ErrorHandler.h"
 #include "nsGDKErrorHandler.h"
 #include "base/at_exit.h"
 #include "base/command_line.h"
@@ -550,7 +550,7 @@ XRE_InitChildProcess(int aArgc,
   gArgv = aArgv;
   gArgc = aArgc;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   XInitThreads();
 #endif
 #if MOZ_WIDGET_GTK == 2
diff --git a/toolkit/xre/nsGDKErrorHandler.cpp b/toolkit/xre/nsGDKErrorHandler.cpp
index a01a7c5..89b1c8b 100644
--- a/toolkit/xre/nsGDKErrorHandler.cpp
+++ b/toolkit/xre/nsGDKErrorHandler.cpp
@@ -6,14 +6,12 @@
 #include "nsGDKErrorHandler.h"
 
 #include <gtk/gtk.h>
-#include <gdk/gdkx.h>
 #include <errno.h>
 #include <stdlib.h>
 #include <string.h>
 
 #include "nsDebug.h"
 #include "nsString.h"
-#include "nsX11ErrorHandler.h"
 
 #include "prenv.h"
 
@@ -29,62 +27,8 @@ static void
 GdkErrorHandler(const gchar *log_domain, GLogLevelFlags log_level,
                 const gchar *message,  gpointer user_data)
 {
-  if (strstr(message, "X Window System error")) {
-    XErrorEvent event;
-    nsDependentCString buffer(message);
-    char *endptr;
-
-    /* Parse Gdk X Window error message which has this format:
-     * (Details: serial XXXX error_code XXXX request_code XXXX (XXXX) minor_code XXXX)
-     */
-    NS_NAMED_LITERAL_CSTRING(serialString, "(Details: serial ");
-    int32_t start = buffer.Find(serialString);
-    if (start == kNotFound)
-      NS_RUNTIMEABORT(message);
-
-    start += serialString.Length();
-    errno = 0;
-    event.serial = strtol(buffer.BeginReading() + start, &endptr, 10);
-    if (errno)
-      NS_RUNTIMEABORT(message);
-
-    NS_NAMED_LITERAL_CSTRING(errorCodeString, " error_code ");    
-    if (!StringBeginsWith(Substring(endptr, buffer.EndReading()), errorCodeString))
-      NS_RUNTIMEABORT(message);
-
-    errno = 0;
-    event.error_code = strtol(endptr + errorCodeString.Length(), &endptr, 10);
-    if (errno)
-      NS_RUNTIMEABORT(message);
-
-    NS_NAMED_LITERAL_CSTRING(requestCodeString, " request_code ");
-    if (!StringBeginsWith(Substring(endptr, buffer.EndReading()), requestCodeString))
-      NS_RUNTIMEABORT(message);
-
-    errno = 0;
-    event.request_code = strtol(endptr + requestCodeString.Length(), &endptr, 10);
-    if (errno)
-      NS_RUNTIMEABORT(message);
-
-    NS_NAMED_LITERAL_CSTRING(minorCodeString, " minor_code ");
-    start = buffer.Find(minorCodeString, endptr - buffer.BeginReading());
-    if (!start)
-      NS_RUNTIMEABORT(message);
-
-    errno = 0;
-    event.minor_code = strtol(buffer.BeginReading() + start + minorCodeString.Length(), nullptr, 10);
-    if (errno)
-      NS_RUNTIMEABORT(message);
-
-    event.display = GDK_DISPLAY_XDISPLAY(gdk_display_get_default());
-    // Gdk does not provide resource ID
-    event.resourceid = 0;
-
-    X11Error(event.display, &event);
-  } else {
     g_log_default_handler(log_domain, log_level, message, user_data);
     NS_RUNTIMEABORT(message);
-  }
 }
 
 void
@@ -94,7 +38,4 @@ InstallGdkErrorHandler()
                     (GLogLevelFlags)(G_LOG_LEVEL_ERROR | G_LOG_FLAG_FATAL | G_LOG_FLAG_RECURSION),
                     GdkErrorHandler,
                     nullptr);
-  if (PR_GetEnv("MOZ_X_SYNC")) {
-    XSynchronize(GDK_DISPLAY_XDISPLAY(gdk_display_get_default()), True);
-  }
 }
diff --git a/toolkit/xre/nsNativeAppSupportUnix.cpp b/toolkit/xre/nsNativeAppSupportUnix.cpp
index a04a799..a0f55f6 100644
--- a/toolkit/xre/nsNativeAppSupportUnix.cpp
+++ b/toolkit/xre/nsNativeAppSupportUnix.cpp
@@ -32,7 +32,7 @@
 #include <glib-object.h>
 #include <gtk/gtk.h>
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <gdk/gdkx.h>
 #include <X11/ICE/ICElib.h>
 #include <X11/SM/SMlib.h>
@@ -52,7 +52,7 @@
 You have GTK+ %d.%d.\nThis application requires GTK+ %d.%d or newer.\n\n\
 Please upgrade your GTK+ library if you wish to use this application."
 
-#if MOZ_X11
+#if MOZ_X11_no
 #undef IceSetIOErrorHandler
 #undef IceAddConnectionWatch
 #undef IceConnectionNumber
@@ -126,7 +126,7 @@ static LazyLogModule sMozSMLog("MozSM");
 class nsNativeAppSupportUnix : public nsNativeAppSupportBase
 {
 public:
-#if MOZ_X11
+#if MOZ_X11_no
   nsNativeAppSupportUnix(): mSessionConnection(nullptr),
                             mClientState(STATE_DISCONNECTED) {};
   ~nsNativeAppSupportUnix()
@@ -143,7 +143,7 @@ public:
   NS_IMETHOD Enable();
 
 private:
-#if MOZ_X11
+#if MOZ_X11_no
   static void SaveYourselfCB(SmcConn smc_conn, SmPointer client_data,
                              int save_style, Bool shutdown, int interact_style,
                              Bool fast);
@@ -163,7 +163,7 @@ private:
 #endif
 };
 
-#if MOZ_X11
+#if MOZ_X11_no
 static gboolean
 process_ice_messages(IceConn connection)
 {
@@ -479,7 +479,7 @@ nsNativeAppSupportUnix::Start(bool *aRetVal)
 
   *aRetVal = true;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   gboolean sm_disable = FALSE;
   if (!getenv("SESSION_MANAGER")) {
     sm_disable = TRUE;
diff --git a/widget/CompositorWidget.h b/widget/CompositorWidget.h
index ce10c3e..d94c0c1 100644
--- a/widget/CompositorWidget.h
+++ b/widget/CompositorWidget.h
@@ -42,7 +42,7 @@ class CompositorWidgetInitData;
 class CompositorWidgetDelegate;
 
 // Platforms that support out-of-process widgets.
-#if defined(XP_WIN) || defined(MOZ_X11)
+#if defined(XP_WIN) || defined(MOZ_X11_no)
 // CompositorWidgetParent should implement CompositorWidget and
 // PCompositorWidgetParent.
 class CompositorWidgetParent;
diff --git a/widget/InProcessCompositorWidget.cpp b/widget/InProcessCompositorWidget.cpp
index e7bbf7a..10e64d0 100644
--- a/widget/InProcessCompositorWidget.cpp
+++ b/widget/InProcessCompositorWidget.cpp
@@ -14,7 +14,7 @@ namespace widget {
 
 // Platforms with no OOP compositor process support use
 // InProcessCompositorWidget by default.
-#if !defined(MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING)
+#if !defined(MOZ_WIDGET_SUPPORTS_OOP_COMPOSITING_no)
 /* static */ RefPtr<CompositorWidget>
 CompositorWidget::CreateLocal(const CompositorWidgetInitData& aInitData,
                               const layers::CompositorOptions& aOptions,
diff --git a/widget/gtk/CompositorWidgetChild.h b/widget/gtk/CompositorWidgetChild.h
index 8da8e47..4e188d9 100644
--- a/widget/gtk/CompositorWidgetChild.h
+++ b/widget/gtk/CompositorWidgetChild.h
@@ -6,7 +6,7 @@
 #ifndef widget_gtk_CompositorWidgetChild_h
 #define widget_gtk_CompositorWidgetChild_h
 
-#include "X11CompositorWidget.h"
+//#include "X11CompositorWidget.h"
 #include "mozilla/widget/PCompositorWidgetChild.h"
 #include "mozilla/widget/CompositorWidgetVsyncObserver.h"
 
@@ -15,7 +15,6 @@ namespace widget {
 
 class CompositorWidgetChild final
  : public PCompositorWidgetChild
- , public CompositorWidgetDelegate
 {
 public:
   CompositorWidgetChild(RefPtr<CompositorVsyncDispatcher> aVsyncDispatcher,
@@ -25,7 +24,7 @@ public:
   mozilla::ipc::IPCResult RecvObserveVsync() override;
   mozilla::ipc::IPCResult RecvUnobserveVsync() override;
 
-  void NotifyClientSizeChanged(const LayoutDeviceIntSize& aClientSize) override;
+  void NotifyClientSizeChanged(const LayoutDeviceIntSize& aClientSize) ;
 
 private:
   RefPtr<CompositorVsyncDispatcher> mVsyncDispatcher;
diff --git a/widget/gtk/CompositorWidgetParent.h b/widget/gtk/CompositorWidgetParent.h
index 100e181..4f70cb3 100644
--- a/widget/gtk/CompositorWidgetParent.h
+++ b/widget/gtk/CompositorWidgetParent.h
@@ -6,15 +6,15 @@
 #ifndef widget_gtk_CompositorWidgetParent_h
 #define widget_gtk_CompositorWidgetParent_h
 
-#include "X11CompositorWidget.h"
+//#include "X11CompositorWidget.h"
 #include "mozilla/widget/PCompositorWidgetParent.h"
 
 namespace mozilla {
 namespace widget {
 
 class CompositorWidgetParent final
- : public PCompositorWidgetParent,
-   public X11CompositorWidget
+ : public PCompositorWidgetParent//,
+   //public X11CompositorWidget
 {
 public:
   explicit CompositorWidgetParent(const CompositorWidgetInitData& aInitData,
@@ -23,8 +23,8 @@ public:
 
   void ActorDestroy(ActorDestroyReason aWhy) override { }
 
-  void ObserveVsync(VsyncObserver* aObserver) override;
-  RefPtr<VsyncObserver> GetVsyncObserver() const override;
+  void ObserveVsync(VsyncObserver* aObserver);
+  RefPtr<VsyncObserver> GetVsyncObserver() const ;
 
   mozilla::ipc::IPCResult RecvNotifyClientSizeChanged(const LayoutDeviceIntSize& aClientSize) override;
 
diff --git a/widget/gtk/moz.build b/widget/gtk/moz.build
index baccb6c..1a2c11c 100644
--- a/widget/gtk/moz.build
+++ b/widget/gtk/moz.build
@@ -47,15 +47,15 @@ if CONFIG['MOZ_X11']:
     UNIFIED_SOURCES += [
         'CompositorWidgetChild.cpp',
         'CompositorWidgetParent.cpp',
-        'InProcessX11CompositorWidget.cpp',
-        'nsIdleServiceGTK.cpp',
-        'X11CompositorWidget.cpp',
+        #'InProcessX11CompositorWidget.cpp',
+        #'nsIdleServiceGTK.cpp',
+        #'X11CompositorWidget.cpp',
     ]
     EXPORTS.mozilla.widget += [
         'CompositorWidgetChild.h',
         'CompositorWidgetParent.h',
-        'InProcessX11CompositorWidget.h',
-        'X11CompositorWidget.h',
+        #'InProcessX11CompositorWidget.h',
+        #'X11CompositorWidget.h',
     ]
 
 if CONFIG['NS_PRINTING']:
@@ -71,15 +71,15 @@ if CONFIG['NS_PRINTING']:
 
 if CONFIG['MOZ_X11']:
     UNIFIED_SOURCES += [
-        'nsClipboard.cpp',
+        #'nsClipboard.cpp',
         'nsDragService.cpp',
-        'WindowSurfaceProvider.cpp',
-        'WindowSurfaceX11.cpp',
-        'WindowSurfaceX11Image.cpp',
-        'WindowSurfaceXRender.cpp',
+        #'WindowSurfaceProvider.cpp',
+        #'WindowSurfaceX11.cpp',
+        #'WindowSurfaceX11Image.cpp',
+        #'WindowSurfaceXRender.cpp',
     ]
     EXPORTS.mozilla.widget += [
-        'WindowSurfaceProvider.h',
+        #'WindowSurfaceProvider.h',
     ]
 
 if CONFIG['ACCESSIBILITY']:
diff --git a/widget/gtk/mozgtk/mozgtk.c b/widget/gtk/mozgtk/mozgtk.c
index 8b62943..43a9303 100644
--- a/widget/gtk/mozgtk/mozgtk.c
+++ b/widget/gtk/mozgtk/mozgtk.c
@@ -597,7 +597,7 @@ STUB(gtk_color_chooser_get_rgba)
 STUB(gtk_color_chooser_set_use_alpha)
 #endif
 
-#ifdef GTK2_SYMBOLS
+#ifdef GTK2_SYMBOLS_no
 STUB(gdk_drawable_get_screen)
 STUB(gdk_rgb_get_colormap)
 STUB(gdk_rgb_get_visual)
@@ -612,21 +612,3 @@ STUB(gdkx_visual_get)
 STUB(gtk_object_get_type)
 #endif
 
-#ifndef GTK3_SYMBOLS
-// Only define the following workaround when using GTK3, which we detect
-// by checking if GTK3 stubs are not provided.
-#include <X11/Xlib.h>
-// Bug 1271100
-// We need to trick system Cairo into not using the XShm extension due to
-// a race condition in it that results in frequent BadAccess errors. Cairo
-// relies upon XShmQueryExtension to initially detect if XShm is available.
-// So we define our own stub that always indicates XShm not being present.
-// mozgtk loads before libXext/libcairo and so this stub will take priority.
-// Our tree usage goes through xcb and remains unaffected by this.
-MOZ_EXPORT Bool
-XShmQueryExtension(Display* aDisplay)
-{
-  return False;
-}
-#endif
-
diff --git a/widget/gtk/nsClipboard.cpp b/widget/gtk/nsClipboard.cpp
index 053ae97..bd530da 100644
--- a/widget/gtk/nsClipboard.cpp
+++ b/widget/gtk/nsClipboard.cpp
@@ -27,8 +27,8 @@
 #include <gtk/gtk.h>
 
 // For manipulation of the X event queue
-#include <X11/Xlib.h>
-#include <gdk/gdkx.h>
+//#include <X11/Xlib.h>
+//#include <gdk/gdkx.h>
 #include <sys/time.h>
 #include <sys/types.h>
 #include <errno.h>
@@ -802,6 +802,7 @@ void GetHTMLCharset(guchar * data, int32_t dataLength, nsCString& str)
     str.AssignLiteral("UNKNOWN");
 }
 
+#ifdef MOZ_X11_no
 static void
 DispatchSelectionNotifyEvent(GtkWidget *widget, XEvent *xevent)
 {
@@ -862,6 +863,7 @@ checkEventProc(Display *display, XEvent *event, XPointer arg)
 
     return False;
 }
+#endif
 
 // Idle timeout for receiving selection and property notify events (microsec)
 static const int kClipboardTimeout = 500000;
@@ -926,53 +928,6 @@ RetrievalContext::Wait()
     }
 
     GdkDisplay *gdkDisplay = gdk_display_get_default();
-    if (GDK_IS_X11_DISPLAY(gdkDisplay)) {
-        Display *xDisplay = GDK_DISPLAY_XDISPLAY(gdkDisplay);
-        checkEventContext context;
-        context.cbWidget = nullptr;
-        context.selAtom = gdk_x11_atom_to_xatom(gdk_atom_intern("GDK_SELECTION",
-                                                                FALSE));
-
-        // Send X events which are relevant to the ongoing selection retrieval
-        // to the clipboard widget.  Wait until either the operation completes, or
-        // we hit our timeout.  All other X events remain queued.
-
-        int select_result;
-
-        int cnumber = ConnectionNumber(xDisplay);
-        fd_set select_set;
-        FD_ZERO(&select_set);
-        FD_SET(cnumber, &select_set);
-        ++cnumber;
-        TimeStamp start = TimeStamp::Now();
-
-        do {
-            XEvent xevent;
-
-            while (XCheckIfEvent(xDisplay, &xevent, checkEventProc,
-                                 (XPointer) &context)) {
-
-                if (xevent.xany.type == SelectionNotify)
-                    DispatchSelectionNotifyEvent(context.cbWidget, &xevent);
-                else
-                    DispatchPropertyNotifyEvent(context.cbWidget, &xevent);
-
-                if (mState == COMPLETED) {
-                    void *data = mData;
-                    mData = nullptr;
-                    return data;
-                }
-            }
-
-            TimeStamp now = TimeStamp::Now();
-            struct timeval tv;
-            tv.tv_sec = 0;
-            tv.tv_usec = std::max<int32_t>(0,
-                kClipboardTimeout - (now - start).ToMicroseconds());
-            select_result = select(cnumber, &select_set, nullptr, nullptr, &tv);
-        } while (select_result == 1 ||
-                 (select_result == -1 && errno == EINTR));
-    }
 #ifdef DEBUG_CLIPBOARD
     printf("exceeded clipboard timeout\n");
 #endif
diff --git a/widget/gtk/nsDragService.cpp b/widget/gtk/nsDragService.cpp
index 15b4eef..bc76399 100644
--- a/widget/gtk/nsDragService.cpp
+++ b/widget/gtk/nsDragService.cpp
@@ -22,12 +22,12 @@
 #include "prthread.h"
 #include <dlfcn.h>
 #include <gtk/gtk.h>
-#include <gdk/gdkx.h>
+//#include <gdk/gdkx.h>
 #include "nsCRT.h"
 #include "mozilla/BasicEvents.h"
 #include "mozilla/Services.h"
 
-#include "gfxXlibSurface.h"
+//#include "gfxXlibSurface.h"
 #include "gfxContext.h"
 #include "nsImageToPixbuf.h"
 #include "nsPresContext.h"
diff --git a/widget/gtk/nsGtkKeyUtils.cpp b/widget/gtk/nsGtkKeyUtils.cpp
index ce55cf1..d4ca3db 100644
--- a/widget/gtk/nsGtkKeyUtils.cpp
+++ b/widget/gtk/nsGtkKeyUtils.cpp
@@ -12,11 +12,11 @@
 #include <gdk/gdkkeysyms.h>
 #include <algorithm>
 #include <gdk/gdk.h>
-#include <gdk/gdkx.h>
+//#include <gdk/gdkx.h>
 #if (MOZ_WIDGET_GTK == 3)
 #include <gdk/gdkkeysyms-compat.h>
 #endif
-#include <X11/XKBlib.h>
+//#include <X11/XKBlib.h>
 #include "WidgetUtils.h"
 #include "keysym2ucs.h"
 #include "nsContentUtils.h"
@@ -173,8 +173,8 @@ KeymapWrapper::KeymapWrapper() :
     g_signal_connect(mGdkKeymap, "direction-changed",
                      (GCallback)OnDirectionChanged, this);
 
-    if (GDK_IS_X11_DISPLAY(gdk_display_get_default()))
-        InitXKBExtension();
+    //if (GDK_IS_X11_DISPLAY(gdk_display_get_default()))
+    //    InitXKBExtension();
 
     Init();
 }
@@ -194,10 +194,10 @@ KeymapWrapper::Init()
     mModifierKeys.Clear();
     memset(mModifierMasks, 0, sizeof(mModifierMasks));
 
-    if (GDK_IS_X11_DISPLAY(gdk_display_get_default()))
-        InitBySystemSettings();
+    //if (GDK_IS_X11_DISPLAY(gdk_display_get_default()))
+    //    InitBySystemSettings();
 
-    gdk_window_add_filter(nullptr, FilterEvents, this);
+    //gdk_window_add_filter(nullptr, FilterEvents, this);
 
     MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
         ("%p Init, CapsLock=0x%X, NumLock=0x%X, "
@@ -215,233 +215,16 @@ KeymapWrapper::Init()
 void
 KeymapWrapper::InitXKBExtension()
 {
-    PodZero(&mKeyboardState);
-
-    int xkbMajorVer = XkbMajorVersion;
-    int xkbMinorVer = XkbMinorVersion;
-    if (!XkbLibraryVersion(&xkbMajorVer, &xkbMinorVer)) {
-        MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-            ("%p InitXKBExtension failed due to failure of "
-             "XkbLibraryVersion()", this));
-        return;
-    }
-
-    Display* display =
-        gdk_x11_display_get_xdisplay(gdk_display_get_default());
-
-    // XkbLibraryVersion() set xkbMajorVer and xkbMinorVer to that of the
-    // library, which may be newer than what is required of the server in
-    // XkbQueryExtension(), so these variables should be reset to
-    // XkbMajorVersion and XkbMinorVersion before the XkbQueryExtension call.
-    xkbMajorVer = XkbMajorVersion;
-    xkbMinorVer = XkbMinorVersion;
-    int opcode, baseErrorCode;
-    if (!XkbQueryExtension(display, &opcode, &mXKBBaseEventCode, &baseErrorCode,
-                           &xkbMajorVer, &xkbMinorVer)) {
-        MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-            ("%p InitXKBExtension failed due to failure of "
-             "XkbQueryExtension(), display=0x%p", this, display));
-        return;
-    }
-
-    if (!XkbSelectEventDetails(display, XkbUseCoreKbd, XkbStateNotify,
-                               XkbModifierStateMask, XkbModifierStateMask)) {
-        MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-            ("%p InitXKBExtension failed due to failure of "
-             "XkbSelectEventDetails() for XModifierStateMask, display=0x%p",
-                this, display));
-        return;
-    }
-
-    if (!XkbSelectEventDetails(display, XkbUseCoreKbd, XkbControlsNotify,
-                               XkbPerKeyRepeatMask, XkbPerKeyRepeatMask)) {
-        MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-            ("%p InitXKBExtension failed due to failure of "
-             "XkbSelectEventDetails() for XkbControlsNotify, display=0x%p",
-             this, display));
-        return;
-    }
-
-    if (!XGetKeyboardControl(display, &mKeyboardState)) {
-        MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-            ("%p InitXKBExtension failed due to failure of "
-             "XGetKeyboardControl(), display=0x%p",
-             this, display));
-        return;
-    }
-
-    MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-        ("%p InitXKBExtension, Succeeded", this));
 }
 
 void
 KeymapWrapper::InitBySystemSettings()
 {
-    MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-        ("%p InitBySystemSettings, mGdkKeymap=%p",
-         this, mGdkKeymap));
-
-    Display* display =
-        gdk_x11_display_get_xdisplay(gdk_display_get_default());
-
-    int min_keycode = 0;
-    int max_keycode = 0;
-    XDisplayKeycodes(display, &min_keycode, &max_keycode);
-
-    int keysyms_per_keycode = 0;
-    KeySym* xkeymap = XGetKeyboardMapping(display, min_keycode,
-                                          max_keycode - min_keycode + 1,
-                                          &keysyms_per_keycode);
-    if (!xkeymap) {
-        MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-            ("%p InitBySystemSettings, "
-             "Failed due to null xkeymap", this));
-        return;
-    }
-
-    XModifierKeymap* xmodmap = XGetModifierMapping(display);
-    if (!xmodmap) {
-        MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-            ("%p InitBySystemSettings, "
-             "Failed due to null xmodmap", this));
-        XFree(xkeymap);
-        return;
-    }
-    MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-        ("%p InitBySystemSettings, min_keycode=%d, "
-         "max_keycode=%d, keysyms_per_keycode=%d, max_keypermod=%d",
-         this, min_keycode, max_keycode, keysyms_per_keycode,
-         xmodmap->max_keypermod));
-
-    // The modifiermap member of the XModifierKeymap structure contains 8 sets
-    // of max_keypermod KeyCodes, one for each modifier in the order Shift,
-    // Lock, Control, Mod1, Mod2, Mod3, Mod4, and Mod5.
-    // Only nonzero KeyCodes have meaning in each set, and zero KeyCodes are
-    // ignored.
-
-    // Note that two or more modifiers may use one modifier flag.  E.g.,
-    // on Ubuntu 10.10, Alt and Meta share the Mod1 in default settings.
-    // And also Super and Hyper share the Mod4. In such cases, we need to
-    // decide which modifier flag means one of DOM modifiers.
-
-    // mod[0] is Modifier introduced by Mod1.
-    Modifier mod[5];
-    int32_t foundLevel[5];
-    for (uint32_t i = 0; i < ArrayLength(mod); i++) {
-        mod[i] = NOT_MODIFIER;
-        foundLevel[i] = INT32_MAX;
-    }
-    const uint32_t map_size = 8 * xmodmap->max_keypermod;
-    for (uint32_t i = 0; i < map_size; i++) {
-        KeyCode keycode = xmodmap->modifiermap[i];
-        MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-            ("%p InitBySystemSettings, "
-             "  i=%d, keycode=0x%08X",
-             this, i, keycode));
-        if (!keycode || keycode < min_keycode || keycode > max_keycode) {
-            continue;
-        }
-
-        ModifierKey* modifierKey = GetModifierKey(keycode);
-        if (!modifierKey) {
-            modifierKey = mModifierKeys.AppendElement(ModifierKey(keycode));
-        }
-
-        const KeySym* syms =
-            xkeymap + (keycode - min_keycode) * keysyms_per_keycode;
-        const uint32_t bit = i / xmodmap->max_keypermod;
-        modifierKey->mMask |= 1 << bit;
-
-        // We need to know the meaning of Mod1, Mod2, Mod3, Mod4 and Mod5.
-        // Let's skip if current map is for others.
-        if (bit < 3) {
-            continue;
-        }
-
-        const int32_t modIndex = bit - 3;
-        for (int32_t j = 0; j < keysyms_per_keycode; j++) {
-            Modifier modifier = GetModifierForGDKKeyval(syms[j]);
-            MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-                ("%p InitBySystemSettings, "
-                 "    Mod%d, j=%d, syms[j]=%s(0x%X), modifier=%s",
-                 this, modIndex + 1, j, gdk_keyval_name(syms[j]), syms[j],
-                 GetModifierName(modifier)));
-
-            switch (modifier) {
-                case NOT_MODIFIER:
-                    // Don't overwrite the stored information with
-                    // NOT_MODIFIER.
-                    break;
-                case CAPS_LOCK:
-                case SHIFT:
-                case CTRL:
-                    // Ignore the modifiers defined in GDK spec. They shouldn't
-                    // be mapped to Mod1-5 because they must not work on native
-                    // GTK applications.
-                    break;
-                default:
-                    // If new modifier is found in higher level than stored
-                    // value, we don't need to overwrite it.
-                    if (j > foundLevel[modIndex]) {
-                        break;
-                    }
-                    // If new modifier is more important than stored value,
-                    // we should overwrite it with new modifier.
-                    if (j == foundLevel[modIndex]) {
-                        mod[modIndex] = std::min(modifier, mod[modIndex]);
-                        break;
-                    }
-                    foundLevel[modIndex] = j;
-                    mod[modIndex] = modifier;
-                    break;
-            }
-        }
-    }
-
-    for (uint32_t i = 0; i < COUNT_OF_MODIFIER_INDEX; i++) {
-        Modifier modifier;
-        switch (i) {
-            case INDEX_NUM_LOCK:
-                modifier = NUM_LOCK;
-                break;
-            case INDEX_SCROLL_LOCK:
-                modifier = SCROLL_LOCK;
-                break;
-            case INDEX_ALT:
-                modifier = ALT;
-                break;
-            case INDEX_META:
-                modifier = META;
-                break;
-            case INDEX_SUPER:
-                modifier = SUPER;
-                break;
-            case INDEX_HYPER:
-                modifier = HYPER;
-                break;
-            case INDEX_LEVEL3:
-                modifier = LEVEL3;
-                break;
-            case INDEX_LEVEL5:
-                modifier = LEVEL5;
-                break;
-            default:
-                MOZ_CRASH("All indexes must be handled here");
-        }
-        for (uint32_t j = 0; j < ArrayLength(mod); j++) {
-            if (modifier == mod[j]) {
-                mModifierMasks[i] |= 1 << (j + 3);
-            }
-        }
-    }
-
-    XFreeModifiermap(xmodmap);
-    XFree(xkeymap);
 }
 
 KeymapWrapper::~KeymapWrapper()
 {
-    gdk_window_remove_filter(nullptr, FilterEvents, this);
+    //gdk_window_remove_filter(nullptr, FilterEvents, this);
     g_signal_handlers_disconnect_by_func(mGdkKeymap,
                                          FuncToGpointer(OnKeysChanged), this);
     g_signal_handlers_disconnect_by_func(mGdkKeymap,
@@ -451,77 +234,6 @@ KeymapWrapper::~KeymapWrapper()
         ("%p Destructor", this));
 }
 
-/* static */ GdkFilterReturn
-KeymapWrapper::FilterEvents(GdkXEvent* aXEvent,
-                            GdkEvent* aGdkEvent,
-                            gpointer aData)
-{
-    XEvent* xEvent = static_cast<XEvent*>(aXEvent);
-    switch (xEvent->type) {
-        case KeyPress: {
-            // If the key doesn't support auto repeat, ignore the event because
-            // even if such key (e.g., Shift) is pressed during auto repeat of
-            // anoter key, it doesn't stop the auto repeat.
-            KeymapWrapper* self = static_cast<KeymapWrapper*>(aData);
-            if (!self->IsAutoRepeatableKey(xEvent->xkey.keycode)) {
-                break;
-            }
-            if (sRepeatState == NOT_PRESSED) {
-                sRepeatState = FIRST_PRESS;
-            } else if (sLastRepeatableHardwareKeyCode == xEvent->xkey.keycode) {
-                sRepeatState = REPEATING;
-            } else {
-                // If a different key is pressed while another key is pressed,
-                // auto repeat system repeats only the last pressed key.
-                // So, setting new keycode and setting repeat state as first key
-                // press should work fine.
-                sRepeatState = FIRST_PRESS;
-            }
-            sLastRepeatableHardwareKeyCode = xEvent->xkey.keycode;
-            break;
-        }
-        case KeyRelease: {
-            if (sLastRepeatableHardwareKeyCode != xEvent->xkey.keycode) {
-                // This case means the key release event is caused by
-                // a non-repeatable key such as Shift or a repeatable key that
-                // was pressed before sLastRepeatableHardwareKeyCode was
-                // pressed.
-                break;
-            }
-            sRepeatState = NOT_PRESSED;
-            break;
-        }
-        case FocusOut: {
-            // At moving focus, we should reset keyboard repeat state.
-            // Strictly, this causes incorrect behavior.  However, this
-            // correctness must be enough for web applications.
-            sRepeatState = NOT_PRESSED;
-            break;
-        }
-        default: {
-            KeymapWrapper* self = static_cast<KeymapWrapper*>(aData);
-            if (xEvent->type != self->mXKBBaseEventCode) {
-                break;
-            }
-            XkbEvent* xkbEvent = (XkbEvent*)xEvent;
-            if (xkbEvent->any.xkb_type != XkbControlsNotify ||
-                !(xkbEvent->ctrls.changed_ctrls & XkbPerKeyRepeatMask)) {
-                break;
-            }
-            if (!XGetKeyboardControl(xkbEvent->any.display,
-                                     &self->mKeyboardState)) {
-                MOZ_LOG(gKeymapWrapperLog, LogLevel::Info,
-                    ("%p FilterEvents failed due to failure "
-                     "of XGetKeyboardControl(), display=0x%p",
-                     self, xkbEvent->any.display));
-            }
-            break;
-        }
-    }
-
-    return GDK_FILTER_CONTINUE;
-}
-
 static void
 ResetBidiKeyboard()
 {
@@ -920,23 +632,6 @@ KeymapWrapper::InitKeyEvent(WidgetKeyboardEvent& aKeyEvent,
     // key release events, the result isn't what we want.
     guint modifierState = aGdkKeyEvent->state;
     GdkDisplay* gdkDisplay = gdk_display_get_default();
-    if (aGdkKeyEvent->is_modifier && GDK_IS_X11_DISPLAY(gdkDisplay)) {
-        Display* display =
-            gdk_x11_display_get_xdisplay(gdkDisplay);
-        if (XEventsQueued(display, QueuedAfterReading)) {
-            XEvent nextEvent;
-            XPeekEvent(display, &nextEvent);
-            if (nextEvent.type == keymapWrapper->mXKBBaseEventCode) {
-                XkbEvent* XKBEvent = (XkbEvent*)&nextEvent;
-                if (XKBEvent->any.xkb_type == XkbStateNotify) {
-                    XkbStateNotifyEvent* stateNotifyEvent =
-                        (XkbStateNotifyEvent*)XKBEvent;
-                    modifierState &= ~0xFF;
-                    modifierState |= stateNotifyEvent->lookup_mods;
-                }
-            }
-        }
-    }
     InitInputEvent(aKeyEvent, modifierState);
 
     switch (aGdkKeyEvent->keyval) {
@@ -1176,11 +871,7 @@ KeymapWrapper::IsLatinGroup(guint8 aGroup)
 bool
 KeymapWrapper::IsAutoRepeatableKey(guint aHardwareKeyCode)
 {
-    uint8_t indexOfArray = aHardwareKeyCode / 8;
-    MOZ_ASSERT(indexOfArray < ArrayLength(mKeyboardState.auto_repeats),
-               "invalid index");
-    char bitMask = 1 << (aHardwareKeyCode % 8);
-    return (mKeyboardState.auto_repeats[indexOfArray] & bitMask) != 0;
+    return true;
 }
 
 /* static */ bool
diff --git a/widget/gtk/nsGtkKeyUtils.h b/widget/gtk/nsGtkKeyUtils.h
index 67528d8..f1ecd6b 100644
--- a/widget/gtk/nsGtkKeyUtils.h
+++ b/widget/gtk/nsGtkKeyUtils.h
@@ -12,7 +12,7 @@
 #include "mozilla/EventForwards.h"
 
 #include <gdk/gdk.h>
-#include <X11/XKBlib.h>
+//#include <X11/XKBlib.h>
 
 namespace mozilla {
 namespace widget {
@@ -223,14 +223,6 @@ protected:
     int mXKBBaseEventCode;
 
     /**
-     * Only auto_repeats[] stores valid value.  If you need to use other
-     * members, you need to listen notification events for them.
-     * See a call of XkbSelectEventDetails() with XkbControlsNotify in
-     * InitXKBExtension().
-     */
-    XKeyboardState mKeyboardState;
-
-    /**
      * Pointer of the singleton instance.
      */
     static KeymapWrapper* sInstance;
@@ -339,15 +331,6 @@ protected:
     static uint32_t GetDOMKeyCodeFromKeyPairs(guint aGdkKeyval);
 
     /**
-     * FilterEvents() listens all events on all our windows.
-     * Be careful, this may make damage to performance if you add expensive
-     * code in this method.
-     */
-    static GdkFilterReturn FilterEvents(GdkXEvent* aXEvent,
-                                        GdkEvent* aGdkEvent,
-                                        gpointer aData);
-
-    /**
      * See the document of WillDispatchKeyboardEvent().
      */
     void WillDispatchKeyboardEventInternal(WidgetKeyboardEvent& aKeyEvent,
diff --git a/widget/gtk/nsScreenGtk.cpp b/widget/gtk/nsScreenGtk.cpp
index 61e6605..a9f8cb9 100644
--- a/widget/gtk/nsScreenGtk.cpp
+++ b/widget/gtk/nsScreenGtk.cpp
@@ -8,7 +8,7 @@
 #include "nsIWidget.h"
 
 #include <gdk/gdk.h>
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <gdk/gdkx.h>
 #include <X11/Xatom.h>
 #endif
@@ -130,7 +130,7 @@ nsScreenGtk :: Init (GdkWindow *aRootWindow)
   // versions of GDK predating the GdkScreen object.  See bug 256646.
   mAvailRect = mRect = nsIntRect(0, 0, width, height);
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   // We need to account for the taskbar, etc in the available rect.
   // See http://freedesktop.org/Standards/wm-spec/index.html#id2767771
 
@@ -193,7 +193,7 @@ nsScreenGtk :: Init (GdkWindow *aRootWindow)
 #endif
 }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 void
 nsScreenGtk :: Init (XineramaScreenInfo *aScreenInfo)
 {
diff --git a/widget/gtk/nsScreenGtk.h b/widget/gtk/nsScreenGtk.h
index d58ea4b..afe468f 100644
--- a/widget/gtk/nsScreenGtk.h
+++ b/widget/gtk/nsScreenGtk.h
@@ -9,7 +9,7 @@
 #include "nsBaseScreen.h"
 #include "nsRect.h"
 #include "gdk/gdk.h"
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <X11/Xlib.h>
 
 // from Xinerama.h
@@ -40,7 +40,7 @@ public:
   NS_IMETHOD GetDefaultCSSScaleFactor(double* aScaleFactor) override;
 
   void Init(GdkWindow *aRootWindow);
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   void Init(XineramaScreenInfo *aScreenInfo);
 #endif /* MOZ_X11 */
 
diff --git a/widget/gtk/nsScreenManagerGtk.cpp b/widget/gtk/nsScreenManagerGtk.cpp
index 98166cc..4dfc0ee 100644
--- a/widget/gtk/nsScreenManagerGtk.cpp
+++ b/widget/gtk/nsScreenManagerGtk.cpp
@@ -13,7 +13,7 @@
 
 #define SCREEN_MANAGER_LIBRARY_LOAD_FAILED ((PRLibrary*)1)
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <gdk/gdkx.h>
 // prototypes from Xinerama.h
 typedef Bool (*_XnrmIsActive_fn)(Display *dpy);
@@ -34,7 +34,7 @@ root_window_event_filter(GdkXEvent *aGdkXEvent, GdkEvent *aGdkEvent,
                          gpointer aClosure)
 {
   nsScreenManagerGtk *manager = static_cast<nsScreenManagerGtk*>(aClosure);
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   XEvent *xevent = static_cast<XEvent*>(aGdkXEvent);
 
   // See comments in nsScreenGtk::Init below.
@@ -58,7 +58,6 @@ root_window_event_filter(GdkXEvent *aGdkXEvent, GdkEvent *aGdkEvent,
 nsScreenManagerGtk :: nsScreenManagerGtk ( )
   : mXineramalib(nullptr)
   , mRootWindow(nullptr)
-  , mNetWorkareaAtom(0)
 {
   // nothing else to do. I guess we could cache a bunch of information
   // here, but we want to ask the device at runtime in case anything
@@ -114,7 +113,7 @@ nsScreenManagerGtk :: EnsureInit()
 
   g_signal_connect(gdk_screen_get_default(), "monitors-changed",
                    G_CALLBACK(monitors_changed), this);
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   gdk_window_add_filter(mRootWindow, root_window_event_filter, this);
   if (GDK_IS_X11_DISPLAY(gdk_display_get_default()))
       mNetWorkareaAtom =
@@ -127,7 +126,7 @@ nsScreenManagerGtk :: EnsureInit()
 nsresult
 nsScreenManagerGtk :: Init()
 {
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   XineramaScreenInfo *screenInfo = nullptr;
   int numScreens;
 
@@ -170,7 +169,7 @@ nsScreenManagerGtk :: Init()
     }
 
     screen->Init(mRootWindow);
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   }
   // If Xinerama is enabled and there's more than one screen, fill
   // in the info for all of the screens.  If that's not the case
diff --git a/widget/gtk/nsScreenManagerGtk.h b/widget/gtk/nsScreenManagerGtk.h
index 9afb3bf..60c016d 100644
--- a/widget/gtk/nsScreenManagerGtk.h
+++ b/widget/gtk/nsScreenManagerGtk.h
@@ -12,7 +12,7 @@
 #include "nsCOMArray.h"
 #include "prlink.h"
 #include "gdk/gdk.h"
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <X11/Xlib.h>
 #endif
 
@@ -26,7 +26,7 @@ public:
   NS_DECL_ISUPPORTS
   NS_DECL_NSISCREENMANAGER
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   Atom NetWorkareaAtom() { return mNetWorkareaAtom; }
 #endif
   
@@ -44,7 +44,7 @@ private:
   PRLibrary *mXineramalib;
 
   GdkWindow *mRootWindow;
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   Atom mNetWorkareaAtom;
 #endif
 };
diff --git a/widget/gtk/nsWidgetFactory.cpp b/widget/gtk/nsWidgetFactory.cpp
index 7e42743..553fd2e 100644
--- a/widget/gtk/nsWidgetFactory.cpp
+++ b/widget/gtk/nsWidgetFactory.cpp
@@ -17,11 +17,11 @@
 #include "nsWindow.h"
 #include "nsTransferable.h"
 #include "nsHTMLFormatConverter.h"
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "nsClipboardHelper.h"
 #include "nsClipboard.h"
-#include "nsDragService.h"
 #endif
+#include "nsDragService.h"
 #if (MOZ_WIDGET_GTK == 3)
 #include "nsApplicationChooser.h"
 #endif
@@ -44,10 +44,10 @@
 #include "nsImageToPixbuf.h"
 #include "nsPrintDialogGTK.h"
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
 #include "nsIdleServiceGTK.h"
-#include "GfxInfoX11.h"
 #endif
+#include "GfxInfoX11.h"
 
 #include "nsNativeThemeGTK.h"
 
@@ -70,12 +70,12 @@ NS_GENERIC_FACTORY_CONSTRUCTOR(nsChildWindow)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsTransferable)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsBidiKeyboard)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsHTMLFormatConverter)
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 NS_GENERIC_FACTORY_SINGLETON_CONSTRUCTOR(nsIdleServiceGTK, nsIdleServiceGTK::GetInstance)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsClipboardHelper)
 NS_GENERIC_FACTORY_CONSTRUCTOR_INIT(nsClipboard, Init)
-NS_GENERIC_FACTORY_CONSTRUCTOR(nsDragService)
 #endif
+NS_GENERIC_FACTORY_CONSTRUCTOR(nsDragService)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsSound)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsScreenManagerGtk)
 NS_GENERIC_FACTORY_CONSTRUCTOR(nsImageToPixbuf)
@@ -202,11 +202,11 @@ NS_DEFINE_NAMED_CID(NS_APPLICATIONCHOOSER_CID);
 #endif
 NS_DEFINE_NAMED_CID(NS_SOUND_CID);
 NS_DEFINE_NAMED_CID(NS_TRANSFERABLE_CID);
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 NS_DEFINE_NAMED_CID(NS_CLIPBOARD_CID);
 NS_DEFINE_NAMED_CID(NS_CLIPBOARDHELPER_CID);
-NS_DEFINE_NAMED_CID(NS_DRAGSERVICE_CID);
 #endif
+NS_DEFINE_NAMED_CID(NS_DRAGSERVICE_CID);
 NS_DEFINE_NAMED_CID(NS_HTMLFORMATCONVERTER_CID);
 NS_DEFINE_NAMED_CID(NS_BIDIKEYBOARD_CID);
 NS_DEFINE_NAMED_CID(NS_SCREENMANAGER_CID);
@@ -219,10 +219,10 @@ NS_DEFINE_NAMED_CID(NS_DEVICE_CONTEXT_SPEC_CID);
 NS_DEFINE_NAMED_CID(NS_PRINTDIALOGSERVICE_CID);
 #endif
 NS_DEFINE_NAMED_CID(NS_IMAGE_TO_PIXBUF_CID);
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
 NS_DEFINE_NAMED_CID(NS_IDLE_SERVICE_CID);
-NS_DEFINE_NAMED_CID(NS_GFXINFO_CID);
 #endif
+NS_DEFINE_NAMED_CID(NS_GFXINFO_CID);
 
 
 static const mozilla::Module::CIDEntry kWidgetCIDs[] = {
@@ -236,11 +236,11 @@ static const mozilla::Module::CIDEntry kWidgetCIDs[] = {
 #endif
     { &kNS_SOUND_CID, false, nullptr, nsSoundConstructor, Module::MAIN_PROCESS_ONLY },
     { &kNS_TRANSFERABLE_CID, false, nullptr, nsTransferableConstructor },
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     { &kNS_CLIPBOARD_CID, false, nullptr, nsClipboardConstructor, Module::MAIN_PROCESS_ONLY },
     { &kNS_CLIPBOARDHELPER_CID, false, nullptr, nsClipboardHelperConstructor },
-    { &kNS_DRAGSERVICE_CID, false, nullptr, nsDragServiceConstructor, Module::MAIN_PROCESS_ONLY },
 #endif
+    { &kNS_DRAGSERVICE_CID, false, nullptr, nsDragServiceConstructor, Module::MAIN_PROCESS_ONLY },
     { &kNS_HTMLFORMATCONVERTER_CID, false, nullptr, nsHTMLFormatConverterConstructor },
     { &kNS_BIDIKEYBOARD_CID, false, nullptr, nsBidiKeyboardConstructor },
     { &kNS_SCREENMANAGER_CID, false, nullptr, nsScreenManagerGtkConstructor,
@@ -254,10 +254,10 @@ static const mozilla::Module::CIDEntry kWidgetCIDs[] = {
     { &kNS_PRINTDIALOGSERVICE_CID, false, nullptr, nsPrintDialogServiceGTKConstructor },
 #endif
     { &kNS_IMAGE_TO_PIXBUF_CID, false, nullptr, nsImageToPixbufConstructor },
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
     { &kNS_IDLE_SERVICE_CID, false, nullptr, nsIdleServiceGTKConstructor },
-    { &kNS_GFXINFO_CID, false, nullptr, mozilla::widget::GfxInfoConstructor },
 #endif
+    { &kNS_GFXINFO_CID, false, nullptr, mozilla::widget::GfxInfoConstructor },
     { nullptr }
 };
 
@@ -272,11 +272,11 @@ static const mozilla::Module::ContractIDEntry kWidgetContracts[] = {
 #endif
     { "@mozilla.org/sound;1", &kNS_SOUND_CID, Module::MAIN_PROCESS_ONLY },
     { "@mozilla.org/widget/transferable;1", &kNS_TRANSFERABLE_CID },
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     { "@mozilla.org/widget/clipboard;1", &kNS_CLIPBOARD_CID, Module::MAIN_PROCESS_ONLY },
     { "@mozilla.org/widget/clipboardhelper;1", &kNS_CLIPBOARDHELPER_CID },
-    { "@mozilla.org/widget/dragservice;1", &kNS_DRAGSERVICE_CID, Module::MAIN_PROCESS_ONLY },
 #endif
+    { "@mozilla.org/widget/dragservice;1", &kNS_DRAGSERVICE_CID, Module::MAIN_PROCESS_ONLY },
     { "@mozilla.org/widget/htmlformatconverter;1", &kNS_HTMLFORMATCONVERTER_CID },
     { "@mozilla.org/widget/bidikeyboard;1", &kNS_BIDIKEYBOARD_CID,
       Module::MAIN_PROCESS_ONLY },
@@ -291,10 +291,10 @@ static const mozilla::Module::ContractIDEntry kWidgetContracts[] = {
     { NS_PRINTDIALOGSERVICE_CONTRACTID, &kNS_PRINTDIALOGSERVICE_CID },
 #endif
     { "@mozilla.org/widget/image-to-gdk-pixbuf;1", &kNS_IMAGE_TO_PIXBUF_CID },
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
     { "@mozilla.org/widget/idleservice;1", &kNS_IDLE_SERVICE_CID },
-    { "@mozilla.org/gfx/info;1", &kNS_GFXINFO_CID },
 #endif
+    { "@mozilla.org/gfx/info;1", &kNS_GFXINFO_CID },
     { nullptr }
 };
 
diff --git a/widget/gtk/nsWindow.cpp b/widget/gtk/nsWindow.cpp
index 7dad6eb..4aefa28 100644
--- a/widget/gtk/nsWindow.cpp
+++ b/widget/gtk/nsWindow.cpp
@@ -40,11 +40,12 @@
 #if (MOZ_WIDGET_GTK == 3)
 #include <gtk/gtkx.h>
 #endif
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <gdk/gdkx.h>
 #include <X11/Xatom.h>
 #include <X11/extensions/XShm.h>
 #include <X11/extensions/shape.h>
+#endif /* MOZ_X11 */
 #if (MOZ_WIDGET_GTK == 3)
 #include <gdk/gdkkeysyms-compat.h>
 #endif
@@ -52,7 +53,6 @@
 #if (MOZ_WIDGET_GTK == 2)
 #include "gtk2xtbin.h"
 #endif
-#endif /* MOZ_X11 */
 #include <gdk/gdkkeysyms.h>
 #if (MOZ_WIDGET_GTK == 2)
 #include <gtk/gtkprivate.h>
@@ -116,7 +116,7 @@ using namespace mozilla::widget;
 #include "mozilla/layers/CompositorBridgeParent.h"
 #include "mozilla/layers/CompositorThread.h"
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include "X11CompositorWidget.h"
 #include "gfxXlibSurface.h"
 #include "WindowSurfaceX11Image.h"
@@ -131,6 +131,7 @@ using namespace mozilla::widget;
 #include "NativeKeyBindings.h"
 
 #include <dlfcn.h>
+#include <sys/time.h>
 
 #include "mozilla/layers/APZCTreeManager.h"
 
@@ -238,7 +239,7 @@ static nsWindow* GetFirstNSWindowForGDKWindow (GdkWindow *aGdkWindow);
 #ifdef __cplusplus
 extern "C" {
 #endif /* __cplusplus */
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 static GdkFilterReturn popup_take_focus_filter (GdkXEvent *gdk_xevent,
                                                 GdkEvent *event,
                                                 gpointer data);
@@ -303,47 +304,20 @@ public:
 
     guint32 GetCurrentTime() const
     {
-        return gdk_x11_get_server_time(mWindow);
+        return g_get_monotonic_time()/1000;
     }
 
     void GetTimeAsyncForPossibleBackwardsSkew(const TimeStamp& aNow)
     {
-        // Check for in-flight request
-        if (!mAsyncUpdateStart.IsNull()) {
-            return;
-        }
-        mAsyncUpdateStart = aNow;
-
-        Display* xDisplay = GDK_WINDOW_XDISPLAY(mWindow);
-        Window xWindow = GDK_WINDOW_XID(mWindow);
-        unsigned char c = 'a';
-        Atom timeStampPropAtom = TimeStampPropAtom();
-        XChangeProperty(xDisplay, xWindow, timeStampPropAtom,
-                        timeStampPropAtom, 8, PropModeReplace, &c, 1);
-        XFlush(xDisplay);
     }
 
     gboolean PropertyNotifyHandler(GtkWidget* aWidget,
                                    GdkEventProperty* aEvent)
     {
-        if (aEvent->atom !=
-            gdk_x11_xatom_to_atom(TimeStampPropAtom())) {
-            return FALSE;
-        }
-
-        guint32 eventTime = aEvent->time;
-        TimeStamp lowerBound = mAsyncUpdateStart;
-
-        TimeConverter().CompensateForBackwardsSkew(eventTime, lowerBound);
-        mAsyncUpdateStart = TimeStamp();
-        return TRUE;
+        return FALSE;
     }
 
 private:
-    static Atom TimeStampPropAtom() {
-        return gdk_x11_get_xatom_by_name_for_display(
-            gdk_display_get_default(), "GDK_TIMESTAMP_PROP");
-    }
 
     // This is safe because this class is stored as a member of mWindow and
     // won't outlive it.
@@ -435,7 +409,7 @@ nsWindow::nsWindow()
     mHandleTouchEvent    = false;
 #endif
     mIsDragPopup         = false;
-    mIsX11Display        = GDK_IS_X11_DISPLAY(gdk_display_get_default());
+    mIsX11Display        = false;
 
     mContainer           = nullptr;
     mGdkWindow           = nullptr;
@@ -449,7 +423,7 @@ nsWindow::nsWindow()
     mLastSizeMode        = nsSizeMode_Normal;
     mSizeConstraints.mMaxSize = GetSafeWindowSize(mSizeConstraints.mMaxSize);
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     mOldFocusWindow      = 0;
 
     mXDisplay = nullptr;
@@ -727,7 +701,7 @@ nsWindow::Destroy()
     // destroys the the gl context attached to it).
     DestroyCompositor();
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // Ensure any resources assigned to the window get cleaned up first
     // to avoid double-freeing.
     mSurfaceProvider.CleanupResources();
@@ -1387,14 +1361,7 @@ nsWindow::GetLastUserInputTime()
     // drags, WM_DELETE_WINDOW delete events, but not usually mouse motion nor
     // button and key releases.  Therefore use the most recent of
     // gdk_x11_display_get_user_time and the last time that we have seen.
-    guint32 timestamp =
-            gdk_x11_display_get_user_time(gdk_display_get_default());
-    if (sLastUserInputTime != GDK_CURRENT_TIME &&
-        TimestampIsNewerThan(sLastUserInputTime, timestamp)) {
-        return sLastUserInputTime;
-    }
-
-    return timestamp;
+    return sLastUserInputTime;
 }
 
 nsresult
@@ -1537,6 +1504,7 @@ nsWindow::UpdateClientOffset()
 {
     PROFILER_LABEL("nsWindow", "UpdateClientOffset", js::ProfileEntry::Category::GRAPHICS);
 
+#ifdef MOZ_X11_no
     if (!mIsTopLevel || !mShell || !mGdkWindow || !mIsX11Display ||
         gtk_window_get_window_type(GTK_WINDOW(mShell)) == GTK_WINDOW_POPUP) {
         mClientOffset = nsIntPoint(0, 0);
@@ -1572,6 +1540,7 @@ nsWindow::UpdateClientOffset()
     g_free(frame_extents);
 
     mClientOffset = nsIntPoint(left, top);
+#endif
 }
 
 LayoutDeviceIntPoint
@@ -1729,7 +1698,7 @@ nsWindow::GetNativeData(uint32_t aDataType)
         return (void*)mPluginNativeWindow->window;
 
     case NS_NATIVE_DISPLAY: {
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
         GdkDisplay* gdkDisplay = gdk_display_get_default();
         if (GDK_IS_X11_DISPLAY(gdkDisplay)) {
           return GDK_DISPLAY_XDISPLAY(gdkDisplay);
@@ -1741,7 +1710,7 @@ nsWindow::GetNativeData(uint32_t aDataType)
         return GetToplevelWidget();
 
     case NS_NATIVE_SHAREABLE_WINDOW:
-        return (void *) GDK_WINDOW_XID(gdk_window_get_toplevel(mGdkWindow));
+        return (void *) NULL;
     case NS_NATIVE_PLUGIN_OBJECT_PTR:
         return (void *) mPluginNativeWindow;
     case NS_RAW_NATIVE_IME_CONTEXT: {
@@ -1957,7 +1926,7 @@ nsWindow::HasPendingInputEvent()
     // anything except expose events.  Reordering expose and others should be
     // ok, hopefully.
     bool haveEvent = false;
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     XEvent ev;
     if (mIsX11Display) {
         Display *display = GDK_DISPLAY_XDISPLAY(gdk_display_get_default());
@@ -1992,7 +1961,7 @@ nsWindow::HasPendingInputEvent()
 #define WANT_PAINT_FLASHING \
 (debug_WantPaintFlashing() && CAPS_LOCK_IS_ON)
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 static void
 gdk_window_flash(GdkWindow *    aGdkWindow,
                  unsigned int   aTimes,
@@ -2172,10 +2141,6 @@ nsWindow::OnExposeEvent(cairo_t *cr)
       clientLayers->SetNeedsComposite(false);
     }
 
-    LOGDRAW(("sending expose event [%p] %p 0x%lx (rects follow):\n",
-             (void *)this, (void *)mGdkWindow,
-             gdk_x11_window_get_xid(mGdkWindow)));
-
     // Our bounds may have changed after calling WillPaintWindow.  Clip
     // to the new bounds here.  The region is relative to this
     // window.
@@ -2497,7 +2462,7 @@ nsWindow::OnSizeAllocate(GtkAllocation *aAllocation)
 
     mBounds.SizeTo(size);
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // Notify the X11CompositorWidget of a ClientSizeChange
     if (mCompositorWidgetDelegate) {
       mCompositorWidgetDelegate->NotifyClientSizeChanged(GetClientSize());
@@ -2611,7 +2576,7 @@ nsWindow::OnMotionNotifyEvent(GdkEventMotion *aEvent)
     // XXXldb Why skip every other motion event when we have multiple,
     // but not more than that?
     bool synthEvent = false;
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     XEvent xevent;
 
     if (mIsX11Display) {
@@ -2647,7 +2612,7 @@ nsWindow::OnMotionNotifyEvent(GdkEventMotion *aEvent)
 
     guint modifierState;
     if (synthEvent) {
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
         event.mRefPoint.x = nscoord(xevent.xmotion.x);
         event.mRefPoint.y = nscoord(xevent.xmotion.y);
 
@@ -3703,7 +3668,7 @@ nsWindow::Create(nsIWidget* aParent,
                 // WM_HINTS input field is set to False to tell the window
                 // manager not to set input focus to this window ...
                 gtk_window_set_accept_focus(GTK_WINDOW(mShell), FALSE);
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
                 // ... but when the window manager offers focus through
                 // WM_TAKE_FOCUS, focus is requested on the parent window.
                 gtk_widget_realize(mShell);
@@ -3982,9 +3947,6 @@ nsWindow::Create(nsIWidget* aParent,
 
     LOG(("nsWindow [%p]\n", (void *)this));
     if (mShell) {
-        LOG(("\tmShell %p mContainer %p mGdkWindow %p 0x%lx\n",
-             mShell, mContainer, mGdkWindow,
-             gdk_x11_window_get_xid(mGdkWindow)));
     } else if (mContainer) {
         LOG(("\tmContainer %p mGdkWindow %p\n", mContainer, mGdkWindow));
     }
@@ -3997,7 +3959,7 @@ nsWindow::Create(nsIWidget* aParent,
     if (!mIsTopLevel)
         Resize(mBounds.x, mBounds.y, mBounds.width, mBounds.height, false);
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     if (mIsX11Display && mGdkWindow) {
       mXDisplay = GDK_WINDOW_XDISPLAY(mGdkWindow);
       mXWindow = gdk_x11_window_get_xid(mGdkWindow);
@@ -4046,7 +4008,7 @@ nsWindow::SetWindowClass(const nsAString &xulWinType)
 
   gdk_window_set_role(mGdkWindow, role);
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
   if (mIsX11Display) {
       XClassHint *class_hint = XAllocClassHint();
       if (!class_hint) {
@@ -4108,7 +4070,7 @@ nsWindow::NativeResize()
         gdk_window_resize(mGdkWindow, size.width, size.height);
     }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // Notify the X11CompositorWidget of a ClientSizeChange
     // This is different than OnSizeAllocate to catch initial sizing
     if (mCompositorWidgetDelegate) {
@@ -4164,7 +4126,7 @@ nsWindow::NativeMoveResize()
                                topLeft.x, topLeft.y, size.width, size.height);
     }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // Notify the X11CompositorWidget of a ClientSizeChange
     // This is different than OnSizeAllocate to catch initial sizing
     if (mCompositorWidgetDelegate) {
@@ -4555,7 +4517,7 @@ void UpdateMaskBits(gchar* aMaskBits, int32_t aMaskWidth, int32_t aMaskHeight,
 void
 nsWindow::ApplyTransparencyBitmap()
 {
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // We use X11 calls where possible, because GDK handles expose events
     // for shaped windows in a way that's incompatible with us (Bug 635903).
     // It doesn't occur when the shapes are set through X.
@@ -4613,7 +4575,7 @@ nsWindow::ClearTransparencyBitmap()
     if (!mShell)
         return;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     if (!mGdkWindow)
         return;
 
@@ -4778,31 +4740,7 @@ nsWindow::SetUrgencyHint(GtkWidget *top_window, bool state)
 void *
 nsWindow::SetupPluginPort(void)
 {
-    if (!mGdkWindow)
-        return nullptr;
-
-    if (gdk_window_is_destroyed(mGdkWindow) == TRUE)
-        return nullptr;
-
-    Window window = gdk_x11_window_get_xid(mGdkWindow);
-
-    // we have to flush the X queue here so that any plugins that
-    // might be running on separate X connections will be able to use
-    // this window in case it was just created
-#ifdef MOZ_X11
-    XWindowAttributes xattrs;
-    Display *display = GDK_DISPLAY_XDISPLAY(gdk_display_get_default());
-    XGetWindowAttributes(display, window, &xattrs);
-    XSelectInput (display, window,
-                  xattrs.your_event_mask |
-                  SubstructureNotifyMask);
-
-    gdk_window_add_filter(mGdkWindow, plugin_window_filter_func, this);
-
-    XSync(display, False);
-#endif /* MOZ_X11 */
-
-    return (void *)window;
+    return nullptr;
 }
 
 void
@@ -4817,66 +4755,10 @@ nsWindow::SetPluginType(PluginType aPluginType)
     mPluginType = aPluginType;
 }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 void
 nsWindow::SetNonXEmbedPluginFocus()
 {
-    if (gPluginFocusWindow == this || mPluginType!=PluginType_NONXEMBED) {
-        return;
-    }
-
-    if (gPluginFocusWindow) {
-        RefPtr<nsWindow> kungFuDeathGrip = gPluginFocusWindow;
-        gPluginFocusWindow->LoseNonXEmbedPluginFocus();
-    }
-
-    LOGFOCUS(("nsWindow::SetNonXEmbedPluginFocus\n"));
-
-    Window curFocusWindow;
-    int focusState;
-
-    GdkDisplay *gdkDisplay = gdk_window_get_display(mGdkWindow);
-    XGetInputFocus(gdk_x11_display_get_xdisplay(gdkDisplay),
-                   &curFocusWindow,
-                   &focusState);
-
-    LOGFOCUS(("\t curFocusWindow=%p\n", curFocusWindow));
-
-    GdkWindow* toplevel = gdk_window_get_toplevel(mGdkWindow);
-#if (MOZ_WIDGET_GTK == 2)
-    GdkWindow *gdkfocuswin = gdk_window_lookup(curFocusWindow);
-#else
-    GdkWindow *gdkfocuswin = gdk_x11_window_lookup_for_display(gdkDisplay,
-                                                               curFocusWindow);
-#endif
-
-    // lookup with the focus proxy window is supposed to get the
-    // same GdkWindow as toplevel. If the current focused window
-    // is not the focus proxy, we return without any change.
-    if (gdkfocuswin != toplevel) {
-        return;
-    }
-
-    // switch the focus from the focus proxy to the plugin window
-    mOldFocusWindow = curFocusWindow;
-    XRaiseWindow(GDK_WINDOW_XDISPLAY(mGdkWindow),
-                 gdk_x11_window_get_xid(mGdkWindow));
-    gdk_error_trap_push();
-    XSetInputFocus(GDK_WINDOW_XDISPLAY(mGdkWindow),
-                   gdk_x11_window_get_xid(mGdkWindow),
-                   RevertToNone,
-                   CurrentTime);
-    gdk_flush();
-#if (MOZ_WIDGET_GTK == 3)
-    gdk_error_trap_pop_ignored();
-#else
-    gdk_error_trap_pop();
-#endif
-    gPluginFocusWindow = this;
-    gdk_window_add_filter(nullptr, plugin_client_message_filter, this);
-
-    LOGFOCUS(("nsWindow::SetNonXEmbedPluginFocus oldfocus=%p new=%p\n",
-              mOldFocusWindow, gdk_x11_window_get_xid(mGdkWindow)));
 }
 
 void
@@ -4884,44 +4766,6 @@ nsWindow::LoseNonXEmbedPluginFocus()
 {
     LOGFOCUS(("nsWindow::LoseNonXEmbedPluginFocus\n"));
 
-    // This method is only for the nsWindow which contains a
-    // Non-XEmbed plugin, for example, JAVA plugin.
-    if (gPluginFocusWindow != this || mPluginType!=PluginType_NONXEMBED) {
-        return;
-    }
-
-    Window curFocusWindow;
-    int focusState;
-
-    XGetInputFocus(GDK_WINDOW_XDISPLAY(mGdkWindow),
-                   &curFocusWindow,
-                   &focusState);
-
-    // we only switch focus between plugin window and focus proxy. If the
-    // current focused window is not the plugin window, just removing the
-    // event filter that blocks the WM_TAKE_FOCUS is enough. WM and gtk2
-    // will take care of the focus later.
-    if (!curFocusWindow ||
-        curFocusWindow == gdk_x11_window_get_xid(mGdkWindow)) {
-
-        gdk_error_trap_push();
-        XRaiseWindow(GDK_WINDOW_XDISPLAY(mGdkWindow),
-                     mOldFocusWindow);
-        XSetInputFocus(GDK_WINDOW_XDISPLAY(mGdkWindow),
-                       mOldFocusWindow,
-                       RevertToParent,
-                       CurrentTime);
-        gdk_flush();
-#if (MOZ_WIDGET_GTK == 3)
-        gdk_error_trap_pop_ignored();
-#else
-        gdk_error_trap_pop();
-#endif
-    }
-    gPluginFocusWindow = nullptr;
-    mOldFocusWindow = 0;
-    gdk_window_remove_filter(nullptr, plugin_client_message_filter, this);
-
     LOGFOCUS(("nsWindow::LoseNonXEmbedPluginFocus end\n"));
 }
 #endif /* MOZ_X11 */
@@ -5074,7 +4918,7 @@ nsWindow::PerformFullscreenTransition(FullscreenTransitionStage aStage,
 static bool
 IsFullscreenSupported(GtkWidget* aShell)
 {
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     GdkScreen* screen = gtk_widget_get_screen(aShell);
     GdkAtom atom = gdk_atom_intern("_NET_WM_STATE_FULLSCREEN", FALSE);
     if (!gdk_x11_screen_supports_net_wm_hint(screen, atom)) {
@@ -5154,7 +4998,7 @@ nsWindow::HideWindowChrome(bool aShouldHide)
     // and flush the queue here so that we don't end up with a BadWindow
     // error later when this happens (when the persistence timer fires
     // and GetWindowPos is called)
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     XSync(GDK_DISPLAY_XDISPLAY(gdk_display_get_default()) , False);
 #else
     gdk_flush ();
@@ -5757,7 +5601,7 @@ focus_out_event_cb(GtkWidget *widget, GdkEventFocus *event)
     return FALSE;
 }
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 // For long-lived popup windows that don't really take focus themselves but
 // may have elements that accept keyboard input when the parent window is
 // active, focus is handled specially.  These windows include noautohide
@@ -5939,7 +5783,7 @@ key_press_event_cb(GtkWidget *widget, GdkEventKey *event)
 
     RefPtr<nsWindow> focusWindow = gFocusWindow ? gFocusWindow : window;
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     // Keyboard repeat can cause key press events to queue up when there are
     // slow event handlers (bug 301029).  Throttle these events by removing
     // consecutive pending duplicate KeyPress events to the same window.
@@ -6563,14 +6407,13 @@ nsWindow::GetDrawTargetForGdkDrawable(GdkDrawable* aDrawable,
 already_AddRefed<DrawTarget>
 nsWindow::StartRemoteDrawingInRegion(LayoutDeviceIntRegion& aInvalidRegion, BufferMode* aBufferMode)
 {
-  return mSurfaceProvider.StartRemoteDrawingInRegion(aInvalidRegion, aBufferMode);
+  return NULL;
 }
 
 void
 nsWindow::EndRemoteDrawingInRegion(DrawTarget* aDrawTarget,
                                    LayoutDeviceIntRegion& aInvalidRegion)
 {
-  mSurfaceProvider.EndRemoteDrawingInRegion(aDrawTarget, aInvalidRegion);
 }
 
 // Code shared begin BeginMoveDrag and BeginResizeDrag
@@ -7009,7 +6852,7 @@ nsWindow::RoundsWidgetCoordinatesTo()
 
 void nsWindow::GetCompositorWidgetInitData(mozilla::widget::CompositorWidgetInitData* aInitData)
 {
-  #ifdef MOZ_X11
+  #ifdef MOZ_X11_no
   *aInitData = mozilla::widget::CompositorWidgetInitData(
                                   mXWindow,
                                   nsCString(XDisplayString(mXDisplay)),
diff --git a/widget/gtk/nsWindow.h b/widget/gtk/nsWindow.h
index 4f61de3..ff66233 100644
--- a/widget/gtk/nsWindow.h
+++ b/widget/gtk/nsWindow.h
@@ -20,12 +20,12 @@
 #include <gdk/gdk.h>
 #include <gtk/gtk.h>
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <gdk/gdkx.h>
 #endif /* MOZ_X11 */
 
 #include "mozilla/widget/WindowSurface.h"
-#include "mozilla/widget/WindowSurfaceProvider.h"
+//#include "mozilla/widget/WindowSurfaceProvider.h"
 
 #ifdef ACCESSIBILITY
 #include "mozilla/a11y/Accessible.h"
@@ -243,7 +243,7 @@ public:
     };
 
     void               SetPluginType(PluginType aPluginType);
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     void               SetNonXEmbedPluginFocus(void);
     void               LoseNonXEmbedPluginFocus(void);
 #endif /* MOZ_X11 */
@@ -252,7 +252,7 @@ public:
     void               OnDPIChanged(void);
     void               OnCheckResize(void);
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     Window             mOldFocusWindow;
 #endif /* MOZ_X11 */
 
@@ -348,7 +348,7 @@ public:
                                                 nsIObserver* aObserver) override;
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     Display* XDisplay() { return mXDisplay; }
 #endif
     virtual void GetCompositorWidgetInitData(mozilla::widget::CompositorWidgetInitData* aInitData) override;
@@ -459,7 +459,7 @@ private:
     nsRefPtrHashtable<nsPtrHashKey<GdkEventSequence>, mozilla::dom::Touch> mTouches;
 #endif
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
     Display*            mXDisplay;
     Window              mXWindow;
     Visual*             mXVisual;
diff --git a/widget/moz.build b/widget/moz.build
index da62f78..856e483 100644
--- a/widget/moz.build
+++ b/widget/moz.build
@@ -209,10 +209,10 @@ if CONFIG['MOZ_X11']:
     UNIFIED_SOURCES += [
         'GfxInfoX11.cpp'
     ]
-    SOURCES += [
-        'nsShmImage.cpp',
-        'WindowSurfaceX11SHM.cpp',
-    ]
+    #SOURCES += [
+    #    'nsShmImage.cpp',
+    #    'WindowSurfaceX11SHM.cpp',
+    #]
 
 if toolkit in ('cocoa', 'windows'):
     UNIFIED_SOURCES += [
diff --git a/widget/nsShmImage.h b/widget/nsShmImage.h
index dae09c6..adfe56f 100644
--- a/widget/nsShmImage.h
+++ b/widget/nsShmImage.h
@@ -7,7 +7,7 @@
 #ifndef __mozilla_widget_nsShmImage_h__
 #define __mozilla_widget_nsShmImage_h__
 
-#if defined(MOZ_X11)
+#if defined(MOZ_X11_no)
 #  define MOZ_HAVE_SHMIMAGE
 #endif
 
diff --git a/widget/x11/keysym2ucs.h b/widget/x11/keysym2ucs.h
index d3c49a6..b3db16d 100644
--- a/widget/x11/keysym2ucs.h
+++ b/widget/x11/keysym2ucs.h
@@ -11,7 +11,7 @@
  * (UCS, Unicode) values.
  */
 
-#ifdef MOZ_X11
+#ifdef MOZ_X11_no
 #include <X11/X.h>
 #else
 #define KeySym unsigned int
